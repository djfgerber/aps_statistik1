# (PART) Zusammenhang zweier Merkmale {.unnumbered}

# Korrelation

Bislang wurde immer ein Merkmal separat betrachtet und manchmal wurden Untergruppen verglichen. Dabei ging es um die Frage, wo der Erwartungswert des Merkmals liegt und ob er einem gewissen Wert entspricht respektive für zwei Gruppen identisch ist. Wird jetzt noch ein zweites Merkmal beobachtet stellt sich die Frage, wie sich die Merkmale zueinander verhalten.

::: {#zahlungsbereitschaft .example name="Zahlungsbereitschaft"}
```{r exm-zahlungsbereitschaft}
gen_exm_zahlungsbereitschaft <- function(){
  set.seed(23)
  n <- 375

  file_name <- '08-exm-zahlungsbereitschaft.sav'
  dd <- tibble(
    Einkommen = rnorm(n, 80, 10),
    Alter = runif(n, 18, 50),
    Anzahl_spiele = rexp(n, 1/10),
    Preis = (Einkommen / 80) *10 - (Anzahl_spiele-10) *0.2 + rnorm(n, 10, 1)) %>% 
  write_sav(file_name)
  jmv_corr <- jmv::corrMatrix(dd)$matrix$asDF %>% 
    rename_with(~.x %>% str_replace_all("\\.|]", "") %>% str_replace_all("\\[","_"))
  jmv_pos <- jmv::corrMatrix(dd, hypothesis = "pos")$matrix$asDF %>% 
    rename_with(~.x %>% str_replace_all("\\.|]", "") %>% str_replace_all("\\[","_"))
  jmv_neg <- jmv::corrMatrix(dd, hypothesis = "neg")$matrix$asDF %>% 
    rename_with(~.x %>% str_replace_all("\\.|]", "") %>% str_replace_all("\\[","_"))
  corr_mat <- dd %>% cor()
  dd %>% ggplot()+geom_point(aes(y = Preis, x = Einkommen))
  scatterplot <- dd %>% 
    pivot_longer(cols = c(1:3), names_to = "Variable", values_to = "Wert") %>%
    ggplot()+
    geom_point(aes(y = Preis, x = Wert))+
    facet_wrap(~Variable,nrow = 1, scales = "free_x")+
    labs(x = "")+ 
    theme(aspect.ratio=1)
  # jmv_res <- dd 
  return(mget(ls()))
}
exm_zahlungsbereitschaft <- gen_exm_zahlungsbereitschaft()
```

Eine Firma will eine Kickstarteridee für ein Kinderspielzeug auf den Markt bringen. Dazu muss sie herausfinden wie viel die Konsumierenden bereit sind für das Spielzeug zu bezahlen. Es werden $`r exm_zahlungsbereitschaft$n`$ Konsumierende gefragt, wie viel sie für das Spielzeug zahlen würden. Zusätzlich wurde auch nach dem Jahreseinkommen in CHF und der Anzahl Spielzeuge im Haushalt gefragt.
:::

[Um den Zusammenhang zwischen zwei intervallskalierten Merkmalen aufzuzeigen wird ein sogenanntes **Streudiagramm** verwendet.]{#customdef-streudiagramm .customdef} Um den Zusammenhang zwischen zwei intervallskalierten Merkmalen aufzuzeigen wird ein sogenanntes Streudiagramm verwendet. Dabei wird ein Koordinatensystem erstellt mit einem Merkmal auf der x-Achse und dem anderen Merkmal auf der y-Achse. Danach wird für jede Beobachtung ein Punkt bei den entsprechenden Werten für die beiden betrachteten Merkmale in dieses Koordinatensystem eingezeichnet.

```{r exm-zahlungsbereitschaft-streudiagramm, fig.cap="Die drei Streudiagramme zeigen jeweils die Zahlungsbereitschaft (Preis in CHF) auf der y-Achse und das Alter in Jahren, die Anzahl Spiele im Haushalt und das Jahreseinkommen in 1'000 CHF respektive auf der x-Achse."}
exm_zahlungsbereitschaft$scatterplot
```

In Abbildung \@ref(fig:exm-zahlungsbereitschaft-streudiagramm) sind drei Streudiagramme aufgezeichnet. Sie setzen jeweils die Zahlungsbereitschaft (Preis) mit dem Alter in Jahren, der Anzahl vorhandener Spiele im Haushalt und dem Einkommen respektive in Bezug. Es kann beobachtet werden, dass die Zahlungsbereitschaft unabhängig vom Alter immer ungefähr ähnlich hoch ist. Es ist des Weiteren klar zu sehen, dass die Zahlungsbereitschaft mit der Anzahl im Haushalt vorhandener Spiele sinkt. Ein bisschen weniger klar ist die Beobachtung, dass die Zahlungsbereitschaft mit dem Jahreseinkommen ansteigt.

[Diese drei Beobachtungen können mit der sogenannten **Korrelation** digitalisiert werden.]{#customdef-korrelation .customdef} Die Korrelation ist eine Zahl zwischen $-1$ und $+1$. Negative Zahlen bedeuten, dass es einen gegenläufigen Zusammenhang gibt. [**Gegenläufig** bedeutet je mehr von Merkmal A, desto weniger von Merkmal B.]{#customdef-gegenlaeufig .customdef} Positive Zahlen bedeuten, dass es einen gleichläufigen Zusammenhang gibt. [**Gleichläufig** bedeutet je mehr von Merkmal A, desto mehr von Merkmal B.]{#customdef-gleichlaeufig .customdef} Eine Korrelation von $0$ schliesslich bedeutet, dass es keinen Zusammenhang zwischen den beiden Merkmalen gibt. Je weiter weg von $0$ die Korrelation liegt, desto eindeutiger ist ein Zusammenhang auf dem Streudiagramm erkennbar. Die Korrelationen für die in der Abbildung gezeigten Zusammenhänge liegen bei $-0.002$ für Alter und Zahlungsbereitschaft, $-0.770$ für die Anzahl Spiele im Haushalt und Zahlungsbereitschaft und $0.484$ für das Einkommen und die Zahlungsbereitschaft.

Die Korrelation erfasst nur lineare Zusammenhänge, also nur wenn Punkte entlang einer Linie streuen im Streudiagramm. Je weiter weg die Korrelation von $0$ ist, desto weniger streuen die Punkte entlang einer Linie, siehe erste und zweite Zeile der Abbildung \@ref(fig:correlation-examples). Die Korrelation sagt lediglich, ob die Linie steigt oder fällt, jedoch nicht wie stark. Nicht lineare Zusammenhänge wie in der dritten Zeile von Abbildung \@ref(fig:correlation-examples) können mit der Korrelation nicht richtig erfasst werden und gängige Korrelationsberechnungen geben zufällige Resultate.

```{r correlation-examples, out.width='100%', fig.cap='Streudiagramme und dazugehörige Korrelation.'}
knitr::include_graphics("figures/08-correlations-wikipedia.jpg")
```

Liegt eine Korrelation vor bedeutet dies, dass die Merkmale sich gemeinsam verändern. In Beispiel \@ref(exm:zahlungsbereitschaft) scheint intuitiv klar, dass das Einkommen und die Anzahl vorhandene Spiele pro Haushalt die Zahlungsbereitschaft beeinflussen. Das Einkommen und die Anzahl Spiele sind also ursächlich. Dass die Zahlungsbereitschaft ursächlich wäre und zum Beispiel das Einkommen beeinflusst ist eher unwahrscheinlich. Welches von zwei Merkmalen ursächlich ist, bzw. wie die Merkmale kausal zusammenhängen, lässt sich jedoch nicht immer einfach beantworten, wie das folgende Beispiel zeigt.

::: {#depression-alkohol-angst .example name="Depression, Angststörungen und Alkohol"}
```{r exm-depression-alkohol-angst}
gen_exm_depression_alkohol_angst <- function(){
  set.seed(23)
  n <- 375
  # alcoholism, Depression (0-63), Angst
  Sigma <- diag(3)
  diag(Sigma) <- c(4,5,7.8)
  Sigma[1,2] <- 1.3
  Sigma[2,3] <- 3.25
  Sigma[1,3] <- 0.3
  Sigma[lower.tri(Sigma)] <- Sigma[upper.tri(Sigma)]
  
  x = mvtnorm::rmvnorm(n, c(15, 19, 43.2), sigma = Sigma)
  colnames(x) <-  c("Alkohol", "Depression", "Angst")
  x <- x %>% as_tibble() 
  file_name <- '08-exm-depression-alkohol-angst.sav'
  dd <- x %>% 
    write_sav(file_name)
  file_name1 <- '08-exm-depressiondiagnose-alkohol-angst.sav'
  dd1 <- x %>% 
    mutate(depressionsdiagnose = ifelse(Depression >= 20, "schwer", "leicht")) %>% 
    write_sav(file_name1)
  desc_1gr <- (dd1 %>% 
                 jmv::descriptives())$descriptives$asDF %>% 
    rename_with(~.x %>% 
                  str_replace_all("\\.|]", "") %>% 
                  str_replace_all("\\[","_"))
  desc_2gr <- (dd1 %>% 
                 jmv::descriptives(splitBy = "depressionsdiagnose"))$descriptives$asDF %>% 
    rename_with(~.x %>% 
                  str_replace_all("\\.|]", "") %>% 
                  str_replace_all("\\[","_"))
  jmv_corr <- jmv::corrMatrix(dd)$matrix$asDF %>% 
    rename_with(~.x %>% str_replace_all("\\.|]", "") %>% str_replace_all("\\[","_"))
  jmv_partcorr <- (dd %>% 
    jmv::corrPart(vars = c('Angst', 'Alkohol'),controls = "Depression"))$matrix$asDF%>%
    rename_with(~.x %>% str_replace_all("\\.|]", "") %>% str_replace_all("\\[","_"))
  corr_mat <- dd %>% cor()
  scatter1 <- dd %>% ggplot()+geom_point(aes(y = Alkohol, x = Depression))
  scatter2 <- dd %>% ggplot()+geom_point(aes(y = Alkohol, x = Angst))
  scatter3 <- dd %>% ggplot()+geom_point(aes(y = Depression, x = Angst))
  
  return(mget(ls()))
}
exm_depression_alkohol_angst <- gen_exm_depression_alkohol_angst()
```

In der Psychotherapie ist aufgefallen, dass sich Alkoholabhängigkeit, Angststörungen und Depression in der Tendenz wechselwirkend positiv beeinflussen [@schuckit1996]. Dies soll mit den fiktiven Daten in `r inline_code(exm_depression_alkohol_angst$file_name)` illustriert werden. Für die Messung der Schwere der drei Merkmale Alkoholismus, Angststörung und Depression wurden die folgenden Messinstrumente verwendet: Das Beck Depression Inventory *BDI* für die Depression [@beck1988], das state trait anxiety inventory *STAI* für die Angststörungen [@spielberger1983manual] und das alcohol use inventory für den Alkoholismus [@skinner1982].
:::

Streudiagramme aller möglicher bivariaten Zusammenhänge sind in Abbildung \@ref(fig:exm-depression-alkohol-angst-scatter) dargestellt. Während der lineare Zusammenhang zwischen Alkoholismus und Angststörung kaum erkennbar ist, so kann zwischen Depression und Alkoholismus ein leichter und zwischen Depression und Angststörung ein deutlich gleichläufiger linearer Zusammenhang festgestellt werden. Die geschätzten Korrelationen sind $`r round(exm_depression_alkohol_angst$corr_mat['Alkohol', 'Depression'],2)`$ zwischen Alkoholismus und Depression, $`r round(exm_depression_alkohol_angst$corr_mat['Alkohol', 'Angst'],2)`$ zwischen Alkoholismus und Angststörung und $`r round(exm_depression_alkohol_angst$corr_mat['Depression', 'Angst'],2)`$ zwischen Depression und Angststörung.

```{r exm-depression-alkohol-angst-scatter, fig.cap="Wiederholte Stichprobenziehung bei gleichbleibender Population mit eher hohen Angst-Werten.", echo = FALSE}
plots <- with(exm_depression_alkohol_angst, 
              list(scatter1, scatter2, scatter3)) %>% 
  map(~ .x + theme(aspect.ratio=1))
do.call(grid.arrange, c(plots, ncol = 3))
```

In diesem Fall ist unklar, ob jemand mit Alkoholismus eher eine Angststörung entwickelt, oder jemand mit Angststörung eher eine Alkoholabhängigkeit entwickelt. Die Korrelation gibt nur einen Anhaltspunkt über die Art des Zusammenhangs, nicht aber über die Ursächlichkeit der Variablen. Es könnte auch sein, dass die beiden Merkmale eigentlich unabhängig voneinander sind, aber ein drittes Merkmal die beiden Merkmale beeinflusst. Dazu später mehr unter \@ref(stoerfaktor).

Für die genaue Berechnung der Korrelation gibt es verschiedene Möglichkeiten, wovon auf einige im Verlauf dieses Kapitels eingegangen wird.

## Wie stark ist der Zusammenhang zwischen zwei intervallskalierten und normalverteilten Variablen?

Wenn die beiden Merkmale je intervallskaliert sind und deren Beobachtungen $x_1, \ldots, x_n$ und $y_1,\ldots, y_n$ einer normalverteilten Population entstammen, dann ist wird Korrelation mit dem [**Korrelationskoeffizient nach Person**]{#customdef-pearson-korrelation .customdef}, auch [**Produkt-Moment-Korrelation**]{#customdef-podukt-moment-korrelation .customdef} genannt,

$$
r = \frac{\frac{1}{n-1} \sum_{i=1}^n (x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\frac{1}{n-1}\sum_{i=1}^n (x_i - \bar{x})^2}\cdot \sqrt{\frac{1}{n-1}\sum_{i=1}^n (y_i - \bar{y})^2}}
$$ 

geschätzt. Im Zähler steht dabei die sogenannte Kovarianz. Diese misst mit Wert der Summanden, wie stark ein Punkt vom Durchschnitt abweicht und mit dem Vorzeichen der Summanden, ob beide Merkmale in dieselbe Richtung vom Durchschnitt abweichen oder nicht. Der Wert der Kovarianz hängt von der Einheit der Merkmale ab. Um dies zu vermeiden wird die Korrelation durch das Produkt der Standardabweichungen der beiden Merkmale geteilt. So wird $-1<r<1$ erreicht.

Die oben in den Beispielen angegebenen Korrelationen wurden mit dem Korrelationskoeffizient nach Pearson basierende auf einer Zufallsstichprobe geschätzt. Der so berechnetet Wert gilt deshalb für die Stichprobe und ist die beste Schätzung für die Korrelation in der Population. Aufgrund der Überlegungen aus Kapitel \@ref(stichprobenziehung) ist diese Schätzung jedoch mit Unsicherheit behaftet. Diese Unsicherheit kann mit einem Konfidenzintervall abgeschätzt werden. Die genaue Berechnung davon wird hier nicht erläutert.

Wichtig für die Beurteilung der Korrelation ist die Frage, ob eine Korrelation besteht oder nicht. Die Korrelation in der Population wird mit $\rho$, sprich 'rho' bezeichnet. Es wird also gefragt, ob $H_1: \rho \neq 0$, $H_1: \rho > 0$ oder $H_1: \rho < 0$ ist. Diese Fragestellungen können mit einem zweiseitigen respektive einseitigen statistischen Test getestet werden. Da getestet wird, ob die Korrelation sich von $0$ unterscheidet wird dieser Test [**Absicherung gegen Null**]{#customdef-podukt-moment-absichern-null .customdef} genannt.

Die Teststatistik für die Absicherung gegen Null der Korrelation nach Pearson ist

\begin{equation}
t = r\cdot \sqrt{\frac{n-2}{1-r^2}}.
(\#eq:absichern-pearson)
\end{equation}

Wenn wiederholt Stichproben gezogen werden und immer wieder die Teststatistik berechnet wird, kann beobachtet werden, dass die Teststatistik $t$-verteilt bei $n-2$ Freiheitsgraden ist.

In `Jamovi` wird die Korrelation nach Pearson unter `Analysen > Regression > Korrelationsmatrix` und `Korrelationskoeffizienten: Pearson` geschätzt und mit der Zusatzoption `Zusätzliche Optionen: Signifikanzniveau` gegen Null abgesichert. Angenommen, es gäbe kein Vorwissen über die Richtung des Zusammenhangs zwischen den Merkmalen Alkoholismus, Depression und Angst. In diesem Fall werden zweiseitige Tests berechnet und wie folgt berichtet:

> Die zweiseitige Absicherung gegen Null des Korrelationskoeffizienten nach Pearson ergibt, dass sich die Korrelation zwischen Alkoholismus und Depression ($r = `r round(exm_depression_alkohol_angst$corr_mat['Alkohol', 'Depression'],2)`$) signifikant von $0$ unterscheidet, `r absichern_pearson(exm_depression_alkohol_angst$corr_mat['Alkohol', 'Depression'], exm_depression_alkohol_angst$n)`, $`r exm_depression_alkohol_angst$jmv_corr %>% filter(name_r == "Depression") %>% pull(Alkohol_rp) %>% as.numeric() %>% report_p(3)`$.
>
> Die zweiseitige Absicherung gegen Null des Korrelationskoeffizienten nach Pearson ergibt, dass sich die Korrelation zwischen Alkoholismus und Angststörung ($r = `r round(exm_depression_alkohol_angst$corr_mat['Alkohol', 'Angst'],2)`$) nicht signifikant von $0$ unterscheidet, `r absichern_pearson(exm_depression_alkohol_angst$corr_mat['Alkohol', 'Angst'], exm_depression_alkohol_angst$n)`, $`r exm_depression_alkohol_angst$jmv_corr %>% filter(name_r == "Angst") %>% pull(Alkohol_rp) %>% as.numeric() %>% report_p(3)`$.

Ist eine klare Hypothese über die Richtung des linearen Zusammenhangs vorhanden, zum Beispiel Leute mit mehr Geld kaufen mehr Geld für Spielzeuge ausgeben wollen, so kann auch einseitig getestet werden: $H_0: \rho \leq 0$ und $H_1: \rho > 0$ und

> Die einseitige Absicherung gegen Null des Korrelationskoeffizienten nach Pearson ergibt, dass die Korrelation zwischen Kaufbereitschaft und Einkommen ($r = `r round(exm_zahlungsbereitschaft$corr_mat['Preis', 'Einkommen'],2)`$) signifikant grösser ist als $0$, `r absichern_pearson(exm_zahlungsbereitschaft$corr_mat['Preis', 'Einkommen'], exm_zahlungsbereitschaft$n)`, $`r exm_zahlungsbereitschaft$jmv_pos %>% filter(name_r == "Preis") %>% pull(Einkommen_rp) %>% as.numeric() %>% report_p(3)`$.

Da die Teststatistik nicht von `Jamovi` direkt ausgegeben wird, muss diese händisch berechnet werden.

## Wie stark ist der Zusammenhang zwischen zwei mindestens ordinalskalierten Merkmalen?

Manchmal ist ein Merkmal oder beide Merkmale nicht intervallskaliert und normalverteilt. Sind die Daten beider Merkmale dennoch mindestens ordinalskaliert, so kann die [**Korrelation nach Spearman**]{#customdef-spearman-korrelation .customdef}, auch **Spearmans Korrelationskoeffizient** genannt, verwendet werden.

::: {#fb-life .example name="Facebook und Lebenszufriedenheit."}

```{r exm-fb-life}
gen_exm_fb_life <- function(){
  set.seed(23)
  n <- 73
  Sigma <- diag(2)
  Sigma[1,2] <- - 0.43
  Sigma[lower.tri(Sigma)] <- Sigma[upper.tri(Sigma)]
  
  x = mvtnorm::rmvnorm(n, c(0,0), sigma = Sigma)
  colnames(x) <-  c("life_satisfaction", "fb_intensity")
  x <- x %>% as_tibble() %>% 
    mutate(life_satisfaction = round((5+life_satisfaction * 2)),
           fb_intensity = fb_intensity + rexp(n,1/3),
           fb_intensity = case_when(fb_intensity > 7 ~ 7,
                                    fb_intensity < 1 ~ 1,
                                    TRUE ~fb_intensity) %>% round())
  
  file_name <- '08-exm-fb-life.sav'
  dd <- x %>% 
    write_sav(file_name)
  jmv_corr <- jmv::corrMatrix(dd, pearson = FALSE, spearman = TRUE)$matrix$asDF %>%
    rename_with(~.x %>% str_replace_all("\\.|]", "") %>% str_replace_all("\\[","_"))
  corr_mat <- dd %>% cor()
  # scatter1 <- dd %>% ggplot()+geom_point(aes(y = Alkohol, x = Depression))
  # scatter2 <- dd %>% ggplot()+geom_point(aes(y = Alkohol, x = Angst))
  # scatter3 <- dd %>% ggplot()+geom_point(aes(y = Depression, x = Angst))
  return(mget(ls()))
}
exm_fb_life <- gen_exm_fb_life()
```

Je intensiver Facebook konsumiert wird, desto tiefer ist die Lebenszufriedenheit [@blachnio2016]. Eine Studie will dieses Resultat reproduzieren. Die Facebook-Nutzungsintensität wurde dafür mit einer Skala von $1$ (keine) bis $7$ (sehr intensive Nutzung) und die Lebenszufriedenheit mit Punkten von $1$ (sehr unzufrieden) bis $10$ (sehr zufrieden) gemessen. Es wurden $`r exm_fb_life$n`$ Personen befragt. Ihre Antworten wurden bereinigt im Datensatz `r inline_code(exm_fb_life$file_name)` abgelegt. Nach der Erhebung wird festgestellt, dass die beiden Merkmale nicht normalverteilt sind.
:::

Wenn die Daten beider Merkmale mindestens ordinalskaliert sind, diese aber nicht die Voraussetzungen für die Korrelation nach Pearson erfüllen, kann die Korrelation nach Spearman angewendet werden. Diese wird berechnet indem den Beobachtungen jedes Merkmals aufsteigende sortiert und entsprechend der Reihenfolge Rangplätze vergeben werden. Die Differenz der Ränge der beiden Merkmale für Beobachtung $i$ wird mit $d_i$ bezeichnet. Die Korrelation nach Spearman ist 

$$r = 1 - \frac{6\cdot \sum_{i = 1}^n d_i^2}{n\cdot (n^2 -1)}.$$

::::{.caution data-latex=""}
::: {.remark}
Exploration der Definition der Spearman'schen Korrelation

1. Alle Punkte sind entlang einer aufsteigenden Linie: In diesem Fall entsprechen sich die Ränge der beiden Merkmale genau und $d_i = 0$ für alle Beobachtungen. Dies führt zu $d_i^2 = 0$ und demnach zu $r = 1$. 
2. $n= 5$ Punkte sind entlang einer absteigenden Linie: In diesem Fall entspricht der kleinste Rang des einen Merkmals dem grössten des anderen Merkmals, der zweitgrösste Rang dem zweitkleinsten, usw. Die Rangdifferenzen sind in dem Fall $d_1 = 5-1=4, d_2 = 4-2=2, d_3 = 3-3 = 0, d_4 = 2-4 = -2, d_5 = 1-5 = -4$. Dies führt zu 
$$r = 1 - \frac{6\cdot (4^2+2^2+0^2+(-2)^2+(-4)^2 )}{5\cdot (5^2 -1)} = 1 - \frac{240}{120} = 1-2 = -1.$$
Die Formel ist also so ausgestaltet, dass bei perfektem gegenläufigem Zusammenhang eine Korrelation von $-1$ erreicht wird.

:::
::::

Die Absicherung gegen Null der Korrelation nach Spearman erfolgt gleich wie bei der Korrelation nach Pearson. Die Teststatistik wird also auch mit Gleichung \@ref(eq:absichern-pearson) berechnet und ist ebenfalls $t$-verteilt bei $n-2$ Freiheitsgraden, wobei $n$ für die Anzahl Beobachtungspaare steht.

In `Jamovi` wird die Korrelation nach Spearman unter `Analysen > Regression > Korrelationsmatrix` und `Korrelationskoeffizienten: Spearman` geschätzt und mit der Zusatzoption `Zusätzliche Optionen: Signifikanzniveau` gegen Null abgesichert. Angenommen, es gäbe kein Vorwissen über die Richtung des Zusammenhangs zwischen den Merkmalen Facebook-Nutzungsintensität und Lebenszufriedenheit. In diesem Fall werden zweiseitige Tests berechnet und wie folgt berichtet:

> Die zweiseitige Absicherung gegen Null des Korrelationskoeffizienten nach Spearman ergibt, dass sich die Korrelation zwischen Facebook-Nutzungsintensität und Lebenszufriedenheit ($r = `r round(exm_fb_life$corr_mat['fb_intensity', 'life_satisfaction'],2)`$) signifikant von $0$ unterscheidet, `r absichern_pearson(exm_fb_life$corr_mat['fb_intensity', 'life_satisfaction'], exm_fb_life$n)`, $`r exm_fb_life$jmv_corr %>% filter(name_rho == "fb_intensity") %>% pull(life_satisfaction_rhop) %>% as.numeric() %>% report_p(3)`$.

## Wie stark ist der Zusammenhang zwischen einem intervallskalierten und normalverteilten Merkmal und einem dichotomen Merkmal?

Ein mit dem BDI gemessener Wert für Depression kann kategorisiert werden in leichte Depression ($1-19$) Punkte und schwere Depression ($20-63$) Punkte. Es folgt also eine neues dichotomes Merkmal Depressionsdiagnose mit Ausprägungen leichte und schwere Depression. Hier kann ebenfalls die Frage gestellt werden, wie stark der Zusammenhang zwischen Depressionsdiagnose und dem intervallskalierten Wert für den Alkoholismus.  [Die **punktbiseriale Korrelation** ist dazu geeignet den Zusammenhang zwischen einer dichotomen und einem intervallskalierten normalverteilten Merkmal zu messen.]{#customdef-punktbiseriale-korrelation .customdef} gemessen. Sie wird berechnet mit

$$ r = \frac{\bar{x}_1- \bar{x}_2}{(n_1+n_2)\cdot s}\sqrt{n_1\cdot n_2},$$
wobei $s$ die Standardabweichung des intervallskalierten Merkmals bezeichnet.

Die Berechnung der punktbiserialen Korrelation ist in Jamovi nicht implementiert. Die Kenngrössen für die Berechnung können jedoch aus der `Erforschung > Deskriptivstatistik` von `Jamovi` abgelesen werden. Dabei ist zu beachten, dass für $\bar{x}_1, n_1, \bar{x}_2, n_2$ die Option `Aufgeteilt nach` mit dem dichotomen Merkmal befüllt sein muss. Für die Berechnung von $s$ muss dieses Feld jedoch leer sein. Im Beispiel ist die punktbiseriale Korrelation

$$ r = \frac{\bar{x}_1- \bar{x}_2}{(n_1+n_2)\cdot s}\sqrt{n_1\cdot n_2}
= \frac{`r round(exm_depression_alkohol_angst$desc_2gr$Alkohol_meanschwer,2)`- `r round(exm_depression_alkohol_angst$desc_2gr$Alkohol_meanleicht,2)`}{(`r exm_depression_alkohol_angst$desc_2gr$Alkohol_nschwer`+`r exm_depression_alkohol_angst$desc_2gr$Alkohol_nleicht`)\cdot `r round(exm_depression_alkohol_angst$desc_1gr$Alkohol_sd,2)`}\sqrt{`r exm_depression_alkohol_angst$desc_2gr$Alkohol_nschwer`\cdot `r exm_depression_alkohol_angst$desc_2gr$Alkohol_nleicht`} = `r round(((round(exm_depression_alkohol_angst$desc_2gr$Alkohol_meanschwer,2) - round(exm_depression_alkohol_angst$desc_2gr$Alkohol_meanleicht,2))/(round(exm_depression_alkohol_angst$desc_1gr$Alkohol_sd,2)*(exm_depression_alkohol_angst$desc_2gr$Alkohol_nschwer+exm_depression_alkohol_angst$desc_2gr$Alkohol_nleicht)))*sqrt(exm_depression_alkohol_angst$desc_2gr$Alkohol_nschwer*exm_depression_alkohol_angst$desc_2gr$Alkohol_nleicht),2)`.$$

Da ein dichotomes Merkmal wie die Depressionsdiagnostik nur zwei Ausprägungen hat, funktioniert die übliche Interpretation dieses gleichläufigen Zusammenhangs mit "je mehr schwere Depression, desto höher der Alkoholismus-Wert" nicht mehr. Stattdessen kann die leicht angepasste Interpretation "je eher eine Person eine schwere Depression hat, desto höher der Alkoholismus-Wert" oder "je höher der Alkoholismus-Wert, desto eher hat eine Person eine schwere Depression" verwendet werden.

Eine genaue Betrachtung dieser Formel lässt eine Ähnlichkeit zur Effektstärke des Zweistichproben-$t$-Tests und Welch Tests erkennen. Tatsächlich kommt die punktbiseriale Korrelation in den gleichen Fällen zur Anwendung wie besagte Tests und ist äquivalent zu deren Effektstärken.

Die punktbiseriale Korrelation wird ähnlich wie die Korrelation nach Pearson abgesichert. Die Teststatistik ist

\begin{equation}
t = r\cdot \sqrt{\frac{n_1 + n_2 -2}{1-r^2}}.
\end{equation}

Sie folgt einer t-Verteilung bei $n_1 + n_2 -2$ Freiheitsgraden. Dieser Wert kann mit der entsprechenden $t$-Verteilung in Abbildung \@ref(fig:t-distribution) verglichen werden. Da die Absicherung nicht in `Jamovi` implementiert ist, wird die Absicherung gegen null der punktbiserialen Korrelation an der Prüfung nicht erwartet. Um die Zufälligkeit des gefundenen Zusammenhangs zu beurteilen, kann behelfsmässig auf das Resultat des Zweistichproben-$t$-Tests resp. Welch Test abgestellt werden.

## Wie stark ist der Zusammenhang zwischen einem mindestens ordinalskalierten Merkmal und einem dichotomen Merkmal?

Genau wie die vorherige Situation äquivalent zum Zweistichproben-$t$-Test und Welch Test war, ist die Situation mit einem mindestens ordinalskaliertem Merkmal und einem dichotomen Merkmal äquivalent zur Effektstärke des U-Tests nach Mann und Whitney. Für die Effektstärke des $U$-Test wurde tatsächlich bereits die biseriale Rangkorrelation definiert und in Abschnitt \@ref(u-test-effect) hinlänglich beschrieben. Für das Beispiel \@ref(exm:depression-alkohol-angst) mit Depressionsdiagnose kann die biseriale Rangkorrelation herausgefunden werden, indem ein $U$-Test und dessen Effektstärke berechnet wird, was $r = 0.357$ ergibt. 

Da auch die Absicherung gegen Null der biserialen Rangkorrelation nicht in `Jamovi` implementiert ist, wird dies an der Prüfung nicht erwartet. Um die Zufälligkeit des gefundenen Zusammenhangs zu beurteilen, kann behelfsmässig auf das Resultat des $U$-Tests abgestellt werden.

## Was ist eine Störfaktor und wie wird damit umgegangen? {#stoerfaktor}

Im Beispiel \@ref(exm:depression-alkohol-angst) wurde festgestellt, dass es einen Zusammenhang schwachen Zusammenhang zwischen Alkoholismus und Angststörung gibt. Je stärker der Alkoholismus ausgeprägt ist, desto höher ist auch der Wert für die Angststörung. Dies ist im oberen Teil der Abbildung  \@ref(fig:exm-depression-alkohol-angst-stoervardiagramm) abstrahiert dargestellt.

Es wurde jedoch auch festgestellt, dass die Merkmale Angst und Alkoholismus jeweils mit dem Merkmal Depression korrelieren. Es könnte also sein, dass der Zusammenhang zwischen Alkoholismus und Angststörung lediglich darauf beruht, dass Menschen mit schwerer Depression zu höherem Alkoholismus und ebenfalls zu mehr Angststörungen neigen. Die Angststörung und der Alkoholismus könnten schwächer korreliert oder gar unabhängig voneinander sein. Wenn ein drittes Merkmal den Zusammenhang zweier Merkmale auf irgendeine Weise verfälsch, wird dieses Merkmal [**Störfaktor**]{#customdef-stoerfaktor .customdef} oder **Störvariable** genannt.

Um den Einfluss einer Störvariable $X_3$ auf den Zusammenhang zweier Merkmale $X_1$ und $X_2$ zu beurteilen, kann die [**partielle Korrelation**]{#customdef-partielle-korrelation .customdef} 
$$r_{12.3} = \frac{r_{12}- r_{23}\cdot r_{13}}{\sqrt{(1-r_{23}^2)\cdot(1-r_{13}^2)}}$$
berechnet werden. Die $r$ stehen dabei für die Korrelation nach Pearson zwischen den zwei indexierten Merkmalen. 

::::{.caution data-latex=""}
::: {.remark}
Exploration der Formel der partiellen Korrelation: 

1. Das dritte Merkmal korreliert nicht mit den ersten beiden $r_{23} = r_{13} = 0$. In diesem Fall ist $r_{12.3} = r_{12}$.
2. Das dritte Merkmal korreliert sehr schwach mit den ersten beiden $r_{23} = r_{13} = 0.01$. In diesem Fall ist $r_{12.3} \approx r_{12}$.
:::
::::

Die partielle Korrelation kann in `Jamovi` unter `Analysen > Regression > Partielle Korrelation` berechnet werden und beträgt $r = -0.05$. Unter Berücksichtigung der Störvariable Depression, ist der Zusammenhang zwischen Alkoholismus und Angststörung also nicht nur kleiner geworden, sondern hat sich sogar in einen gegenläufigen Zusammenhang gewandelt. Dies ist abstrahiert im
unteren Teil der Abbildung \@ref(fig:exm-depression-alkohol-angst-stoervardiagramm)  dargestellt. Wird die partielle Korrelation unter Berücksichtigung einer Störvariable angegeben, spricht man auch von es wurde für die Störvariable **kontrolliert**.

```{r exm-depression-alkohol-angst-stoervardiagramm,fig.show = 'hold', out.height='50%', fig.cap="Zusammenhang zwischen Angst und Alkoholismus ohne (oben) und mit (unten) Berücksichtigung der Störvariable."}
grViz("
digraph G {
  rankdir=LR;
  node [shape=box, style=filled, fillcolor=lightblue, fontsize=18];

  Alkoholismus;
  Angst;
  
  Angst -> Alkoholismus [penwidth=2, dir=both, label = 'r = 0.10'];
}
")
grViz("
digraph G {
  rankdir=LR;
  node [shape=box, style=filled, fillcolor=lightblue, fontsize=18];

  Alkoholismus;
  Angst;
  Depression;

  Depression -> Angst [penwidth=2, label = 'r = 0.46'];
  Depression -> Alkoholismus [penwidth=2, label = 'r = 0.32'];
  Angst -> Alkoholismus [penwidth=2, dir=both, label = 'Partielle r = -0.05', color = red];
}
")
```


Die Absicherung gegen Null der partiellen Korrelation erfolgt ähnlich wie bei der Korrelation nach Pearson. Die Teststatistik wird mit

\begin{equation}
t = r\cdot \sqrt{\frac{n-3}{1-r^2}}.
(\#eq:absichern-partial)
\end{equation}

berechnet und ist $t$-verteilt bei $n-3$ Freiheitsgraden, wobei $n$ für die Anzahl Beobachtungstripel steht. Die Teststatistik wird von `Jamovi` nicht berechnet und muss händisch eruiert werden.

> Die zweiseitige Absicherung gegen Null der partiellen Korrelation ergibt, dass sich die Korrelation zwischen Alkoholismus und Angststörung unter Berücksichtigung der Depression als Störfaktor ($r = `r round(exm_depression_alkohol_angst$jmv_partcorr %>% filter(name_r == "Alkohol") %>% pull("Angst_r") %>% as.numeric(),2)`$) nicht signifikant von $0$ unterscheidet, `r absichern_partiell(exm_depression_alkohol_angst$jmv_partcorr %>% filter(name_r == "Alkohol") %>% pull("Angst_r") %>% as.numeric(), exm_depression_alkohol_angst$n)`, $`r exm_depression_alkohol_angst$jmv_partcorr %>% filter(name_r == "Alkohol") %>% pull(Angst_rp) %>% as.numeric() %>% report_p(3)`$. Die Korrelation ist als schwach einzustufen.

In diesem Beispiel wurde die Angst arbiträr als Störfaktor gehandelt. Die selben Überlegungen und Berechnungen wären aber auch zum Beispiel für den Alkoholismus als Störfaktor für den Zusammenhang zwischen Angst und Depression zulässig. Die Identifikation von Störvariablen muss also theoriegeleitet erfolgen.


## Übungen

```{=html}
<!-- 
Ziel: 
- Korrelation Lärm und Bluthochdruck
-->
```

::: {#depression-alkohol-angst-berichten .exercise}
```{=html}
<!-- 
Ziel: 
- Korrelation mit Jamovi berechnen und zweiseitig gegen 0 absichern.
-->
```

Sichern Sie die Korrelation nach Pearson zwischen Angststörung und Depression in Beispiel \@ref(exm:depression-alkohol-angst) mit dem Datensatz `r inline_code(exm_depression_alkohol_angst$file_name)` zweiseitig gegen Null ab, berichten Sie das Ergebnis und interpretieren Sie die Stärke des Zusammenhangs.
:::

::: solution
> Die zweiseitige Absicherung gegen Null des Korrelationskoeffizienten nach Pearson ergibt, dass sich die Korrelation zwischen Depression und Angststörung ($r = `r round(exm_depression_alkohol_angst$corr_mat['Depression', 'Angst'],2)`$) sich signifikant von $0$ unterscheidet, `r absichern_pearson(exm_depression_alkohol_angst$corr_mat['Depression', 'Angst'], exm_depression_alkohol_angst$n)`, $`r exm_depression_alkohol_angst$jmv_corr %>% filter(name_r == "Angst") %>% pull(Depression_rp) %>% as.numeric() %>% report_p(3)`$. Die Korrelation deutet auf einen starken Zusammenhang der Art je mehr Depression desto grösser die Angststörung hin.
:::

::: {#zahlungsbereitschaft-berichten .exercise}
```{=html}
<!-- 
Ziel: 
- Korrelation mit Jamovi berechnen und einseitig gegen 0 absichern.
-->
```

Testen Sie mit dem Datensatz `r inline_code(exm_zahlungsbereitschaft$file_name)` aus Beispiel \@ref(exm:zahlungsbereitschaft), ob die Korrelation nach Pearson zwischen der Zahlungsbereitschaft `Preis` und Alter positiv und ob die Korrelation zwischen der Zahlungsbereitschaft und der Anzahl Spiele im Haushalt negativ ist. Berichten Sie das Ergebnis und interpretieren Sie die Stärke des Zusammenhangs.
:::

::: solution
> Die einseitige Absicherung gegen Null des Korrelationskoeffizienten nach Pearson ergibt, dass die Korrelation zwischen Kaufbereitschaft und Alter ($r = `r round(exm_zahlungsbereitschaft$corr_mat['Preis', 'Alter'],2)`$) nicht signifikant grösser ist als $0$, `r absichern_pearson(exm_zahlungsbereitschaft$corr_mat['Preis', 'Alter'], exm_zahlungsbereitschaft$n)`, $`r exm_zahlungsbereitschaft$jmv_pos %>% filter(name_r == "Preis") %>% pull(Alter_rp) %>% as.numeric() %>% report_p(3)`$. Der Zusammenhang ist so schwach, dass keine Richtung des Zusammenhangs aus dem Korrelationskoeffizenten abgelesen werden kann.
>
> Die einseitige Absicherung gegen Null des Korrelationskoeffizienten nach Pearson ergibt, dass die Korrelation zwischen Kaufbereitschaft und Anzahl Spiele ($r = `r round(exm_zahlungsbereitschaft$corr_mat['Preis', 'Anzahl_spiele'],2)`$) signifikant kleiner ist als $0$,`r absichern_pearson(exm_zahlungsbereitschaft$corr_mat['Preis', 'Anzahl_spiele'], exm_zahlungsbereitschaft$n)`, $`r exm_zahlungsbereitschaft$jmv_neg %>% filter(name_r == "Preis") %>% pull(Anzahl_spiele_rp) %>% as.numeric() %>% report_p(3)`$. Der Zusammenhang der Art je höher die Kaufbereitschaft, desto tiefer die Anzahl Spiele im Haushalt, ist stark.
:::

::: {#big-five-cor .exercise}
```{=html}
<!-- 
Ziel: Psychologische Anwendung.
- 
-->
```

Im Rahmen einer Studie wurde die Big-5-Persönlichkeitszüge von $500$ psychologie Studierenden abgefragt [@dolan2009]. Der Datensatz ist unter `Jamovi > Öffnen > Datenbibliothek > Big 5 (Dolan, Oort, Stoel & Wicherts, 2009)` verfügbar. Die Merkmale Neuroticism, Extraversion, Openness, Agreeableness und Conscientiousness stehen für Neurotizismus, Extraversion, Offenheit, Verträglichkeit und Gewissenhaftikeit respektive.

a)  Berechnen Sie paarweise die Korrelation nach Pearson zwischen allen fünf Merkmalen. Erklären und interpretieren Sie die stärkste negative, die stärkste positive Korrelation und die schwächste Korrelation.
b)  Zeichnen Sie die Korrelationsmatrix als Diagramm, inklusive Variablendichte und Statistiken und erklären Sie, was für Diagrammtypen Sie sehen.
c)  Testen Sie, ob die Korrelationen von Null abweichen und berichten Sie das Ergebnis für die stärkste negative, die stärkste positive Korrelation und die schwächste Korrelation.
:::

::: solution
Zuerst wird der Datensatz mit `Jamovi` eingelesen und die Analyseparameter werden gesetzt, siehe Abbildung \@ref(fig:sol-big-five-cor-input).

```{r sol-big-five-cor-input, out.width='100%', fig.cap='Jamovi Eingabe.'}
knitr::include_graphics("figures/08-exr-big-five-cor-jmv-input.jpg")
```

Dies produziert das Analyseergebnis in Abbildungen \@ref(fig:sol-big-five-cor-output-koorelationsmatrix) und \@ref(fig:sol-big-five-cor-output-koorelationsmatrixdiagramm).

```{r sol-big-five-cor-output-koorelationsmatrix, out.width='100%', fig.cap='Jamovi Ausgabe.'}
knitr::include_graphics("figures/08-exr-big-five-cor-jmv-output-korrelationsmatrix.jpg")
```

```{r sol-big-five-cor-output-koorelationsmatrixdiagramm, out.width='100%', fig.cap='Jamovi Ausgabe.'}
knitr::include_graphics("figures/08-exr-big-five-cor-jmv-output-korrelationsmatrixdiagramm.jpg")
```

Damit können die Teilfragen beantwortet werden.

a)  Die Korrelationen können direkt aus Abbildung \@ref(fig:sol-big-five-cor-output-koorelationsmatrix) entnommen werden. Die stärkste positive Korrelation beschreibt den Zusammenhang zwischen Extraversion und Openness ($r = 0.267$). Diese Korrelation ist als mittel einzustufen und bedeutet je extravertierter eine Person ist desto höhere Werte hat sie tendenziell auch bei der Offenheit. Die stärkste negative Korrelation beschreibt den Zusammenhang zwischen Neuroticism und Conscientiousness ($r = -0.368$). Dies ist ebenfalls eine mittlere Korrelation. Sie bedeutet je neurotischer jemand ist, desto tiefere Werte für Conscientiousness hat die Person. Die schwächste Korrelation beschreibt den Zusammenhang zwischen Neuroticism und Openness ($r = -0.010$). Es handelt sich um einen schwachen Zusammenhang. Da die Korrelation quasi Null ist, bedeutet dies, dass Neuroticism und Openness unabhängig voneinander sind. Das Vorzeichen der Korrelation deutet darauf hin, dass je höhere Neuroticism-Werte jemand hat, desto tiefere Openness-Werte hat die Person tendenziell.
b)  Die Korrelationsmatrix als Diagramm in Abbildung \@ref(fig:sol-big-five-cor-output-koorelationsmatrixdiagramm) hat folgende Bestandteile: Auf der Diagonalen befinden sich die geschätzten Verteilungen der Merkmale. Je höher die Linie bei einem gewissen Wert, desto wahrscheinlicher ist eine Beobachtung an diesem Punkt. Im oberen Dreieck sind die paarweise Korrelationen abgetragen. Die Sterne stehen für den $p$-Wert der Absicherung gegen Null, wobei ein Stern einer Korrelation entspricht, welche bei Signifikanzniveau $5\%$ signifikant anders ist als Null. Im unteren Dreieck sind paarweise Streudiagramme aufgeführt und eine sogenannte Regressionsgerade, welche die Punkte am besten linear abbildet. Hier können Korrelationen grafisch erkannt werde und Anomalien wie zum Beispiel Aussreisser oder nicht lineare Zusammenhänge erkannt werden.
c) Die entsprechenden Zusammenhänge wurden bereits in a) identifiziert.
> Die zweiseitige Absicherung gegen Null des Korrelationskoeffizienten nach Pearson ergibt, dass sich die Korrelation zwischen Openness und Extraversion ($r = 0.267$) signifikant von $0$ unterscheidet, `r absichern_pearson(0.267, 500)`, $`r 0.000001 %>% report_p(3)`$.
> Die zweiseitige Absicherung gegen Null des Korrelationskoeffizienten nach Pearson ergibt, dass sich die Korrelation zwischen Neuroticism und Conscientiousness ($r = -0.368$) signifikant von $0$ unterscheidet, `r absichern_pearson(-0.368, 500)`, $`r 0.000001 %>% report_p(3)`$.
> Die zweiseitige Absicherung gegen Null des Korrelationskoeffizienten nach Pearson ergibt, dass sich die Korrelation zwischen Neuroticism und Openness ($r = -0.010$) nicht signifikant von $0$ unterscheidet, `r absichern_pearson(-0.010, 500)`, $`r 0.81686 %>% report_p(3)`$.
:::

::: {#hairloss-sex .exercise}
```{=html}
<!-- 
Ziel: 
- Starke Korrelation gegen Null absichern
-->
```

```{r exr-hairloss-sex}
gen_exr_hairloss_sex <- function(){
  n <- 375
  mu <- 
  sigma <- 
  Omega <- matrix(c(1, 0.2, 0.45,
                  0.2, 1, 0.5,
                  0.45, 0.5, 1), nrow = 3)
  
  dd = rcorrelated(n, 
                   mu = c(4,18,30),
                   sds = c(1.5,5,6),
                   Omega = Omega,
                   colnames = c("hns", "ases", "age"))
  dd <- dd %>% 
    mutate(hns = hns %>% round(),
           hns = case_when(hns > 7 ~7,
                           hns < 1 ~1,
                           TRUE~hns),
           ases = ases %>% round(1),
           ases = case_when(ases < 5 ~ 5,
                            ases > 30 ~ 30,
                            TRUE~ ases),
           age = age %>% round(1))
    
  file_name <- '08-exr-haarausfall-sex.sav'
  dd %>% write_sav(file_name)
  corr_mat_pearson <- dd %>% cor()
  corr_mat_spearman <- dd %>% cor(method = "spearman")
  jmv_corr <- jmv::corrMatrix(dd, spearman = TRUE)$matrix$asDF %>%
    rename_with(~.x %>% str_replace_all("\\.|]", "") %>% str_replace_all("\\[","_"))
  jmv_partcorr <- (dd %>% 
    jmv::corrPart(vars = c('hns', 'ases'),controls = "age"))$matrix$asDF%>%
    rename_with(~.x %>% str_replace_all("\\.|]", "") %>% str_replace_all("\\[","_"))
  return(mget(ls()))
}
exr_hairloss_sex <- gen_exr_hairloss_sex()
```

Mit einer Studie soll der Zusammenhang zwischen Haarausfall und erfülltem Sexualleben bei männlichen Patienten eruiert werden [@tas2018]. Die Schwere des Haarausfalls wird mit der Hamilton-Norwood-Schema HNS ganzzahlig von $1$ bis $7$ gemessen, wobei jede höhere Zahl für ein neues zunehmendes Haarausfallstadium steht[@hamilton1951]. Die Dysfunktionalität des Sexuallebens wird mit der Arizona Sexual Experience Scale ASES von $5$ bis $30$ Punkten gemessen, wobei höhere Zahlen auf eine sexuelle Dysfunktion hindeuten [@mcgahuey2016]. Bei diesem Instrument führen mehrere Likert-skalierte Items zum Endpunkteergebnis. Es wurden Daten erhoben, welche unter `r inline_code(exr_hairloss_sex$file_name)` verfügbar sind.

a) Welcher Korrelationskoeffizient ist hier am ehesten angebracht?
b) Berechnen Sie die Korrelation nach Spearman, sichern Sie diese zweiseitig gegen Null ab und interpretieren Sie die Stärke des Zusammenhangs.
c) Angenommen alle Merkmale wären intervallskaliert und normalverteilt. Berechnen Sie die partielle Korrelation zwischen Haarausfall und der Dysfunktionalität des Sexlebens unter Berücksichtigung des Störfaktor Alter, sichern sie diese gegen Null ab und interpretieren Sie die Stärke des Zusammenhangs vor und nach dem Herausrechnen des Störfaktors.
:::

::: solution
a) Die Messung mit der ASES ist intervallskaliert. Die Messung des Haarausfalls dagegen kann sowohl als ordinalskaliert oder intervallskaliert betrachtet werden. Einerseits entsprechen die Zahlen auf der HNS verschiedenen abgegrenzten und klassifizierten Stadien der Progression des Haarausfalls. Dies deutet auf eine ordinalskaliertes Merkmal hin. Andererseits braucht es hier keine grosse Vorstellungskraft, sich eine $3.23$ vorzustellen. Das wäre wie Stadium $3$ mit ein wenig zusätzlichem Haarausfall. Aufgrund dieser Überlegung wäre hier sowohl der Korrelationskoeffizient nach Pearson wie der nach Spearman angebracht. Für letzteren müsste noch die Normalverteilung überprüft werden, was hier nicht gemacht wird.
b) Zuerst wird der Datensatz mit `Jamovi` eingelesen und die Analyseparameter werden gesetzt, siehe Abbildung \@ref(fig:sol-hairloss-sex-input-spearman).

```{r sol-hairloss-sex-input-spearman, out.width='100%', fig.cap='Jamovi Eingabe.'}
knitr::include_graphics("figures/08-exr-hairloss-sex-jmv-input-spearman.jpg")
```

Dies produziert das Analyseergebnis in Abbildung \@ref(fig:sol-hairloss-sex-output-spearman)

```{r sol-hairloss-sex-output-spearman, out.width='50%', fig.cap='Jamovi Ausgabe.'}
knitr::include_graphics("figures/08-exr-hairloss-sex-jmv-output-spearman.jpg")
```

> Die zweiseitige Absicherung gegen Null des Korrelationskoeffizienten nach Spearman ergibt, dass sich die Korrelation zwischen Haarausfall und Dysfunktion der Sexualität ($r = `r round(exr_hairloss_sex$corr_mat_spearman['hns', 'ases'],2)`$) signifikant von $0$ unterscheidet, `r absichern_pearson(exr_hairloss_sex$corr_mat_spearman['hns', 'ases'], exr_hairloss_sex$n)`, $`r exr_hairloss_sex$jmv_corr %>% filter(name_rho == "ases") %>% pull(hns_rhop) %>% as.numeric() %>% report_p(3)`$. Die Korrelation ist als mittel einzustufen.

c) Zuerst wird der Datensatz mit `Jamovi` eingelesen und die Analyseparameter werden gesetzt, siehe Abbildung \@ref(fig:sol-hairloss-sex-input-partiell).

```{r sol-hairloss-sex-input-partiell, out.width='100%', fig.cap='Jamovi Eingabe.'}
knitr::include_graphics("figures/08-exr-hairloss-sex-jmv-input-partiell.jpg")
```

Dies produziert das Analyseergebnis in Abbildung \@ref(fig:sol-hairloss-sex-output-partiell)

```{r sol-hairloss-sex-output-partiell, out.width='50%', fig.cap='Jamovi Ausgabe.'}
knitr::include_graphics("figures/08-exr-hairloss-sex-jmv-output-partiell.jpg")
```

> Die zweiseitige Absicherung gegen Null der partiellen Korrelation ergibt, dass sich die Korrelation zwischen Haarausfall und Dysfunktion der Sexualität unter Berücksichtigung des Alters als Störfaktor ($r = `r round(exr_hairloss_sex$jmv_partcorr %>% filter(name_r == "ases") %>% pull("hns_r") %>% as.numeric(),2)`$) nicht signifikant von $0$ unterscheidet, `r absichern_partiell(exr_hairloss_sex$jmv_partcorr %>% filter(name_r == "ases") %>% pull("hns_r") %>% as.numeric(), exr_hairloss_sex$n)`, $`r exr_hairloss_sex$jmv_partcorr %>% filter(name_r == "ases") %>% pull(hns_rp) %>% as.numeric() %>% report_p(3)`$. Die Korrelation ist als schwach einzustufen.
:::


::: {#ehe-burnout-correlation .exercise}
```{=html}
<!-- 
Ziel: 
- 
-->
```

Berechnen Sie (a) Punktbiseriale Korrelation und (b) die biserielle Rangkorrelation für die Übung \@ref(exr:ehe-burnout), wo das Burnout-Risiko von verheirateten und unverheirateten Ärztinnen analysiert wird und interpretieren Sie die Werte.
:::

:::{.solution}

a) Zuerst wird der Datensatz mit `Jamovi` eingelesen und die Analyseparameter werden gesetzt, siehe Abbildung \@ref(fig:sol-ehe-burnout-pointcorrelation-input).

```{r sol-ehe-burnout-pointcorrelation-input, fig.show = 'hold', out.height='50%', fig.cap='Jamovi Eingabe.'}
knitr::include_graphics("figures/08-exr-ehe-burnout-pointcorrelation-jmv-input1.jpg")
knitr::include_graphics("figures/08-exr-ehe-burnout-pointcorrelation-jmv-input2.jpg")
```

Dies produziert das Analyseergebnis in Abbildung \@ref(fig:sol-ehe-burnout-pointcorrelation-output)

```{r sol-ehe-burnout-pointcorrelation-output, fig.show = 'hold', out.height='50%', fig.cap='Jamovi Ausgabe.'}
knitr::include_graphics("figures/08-exr-ehe-burnout-pointcorrelation-jmv-output1.jpg")
knitr::include_graphics("figures/08-exr-ehe-burnout-pointcorrelation-jmv-output2.jpg")
```

Daraus ergibt sich
$$ r = \frac{10.99- 10.15}{(51+61)\cdot 2.01}\sqrt{51\cdot 61} = `r round( (10.99-10.15)/((51+61)*2.01)*sqrt(51*61),2)`.$$
Hier wurden die Zwischenresultate mit zwei Nachkommastellen aus `Jamovi` gezogen. Je eher eine Ärztin unverheiratet ist, desto höher ist der Burnout-Wert. Der Zusammenhang ist als mittel einzustufen.

b) Die Analyseparameter in `Jamovi` werden nun geändert, siehe Abbildung \@ref(fig:sol-ehe-burnout-rankcorrelation-input).

```{r sol-ehe-burnout-rankcorrelation-input, fig.cap='Jamovi Eingabe.'}
knitr::include_graphics("figures/08-exr-ehe-burnout-pointcorrelation-jmv-input3.jpg")
```

Dies produziert das Analyseergebnis in Abbildung \@ref(fig:sol-ehe-burnout-rankcorrelation-output)

```{r sol-ehe-burnout-rankcorrelation-output, fig.cap='Jamovi Ausgabe.'}
knitr::include_graphics("figures/08-exr-ehe-burnout-pointcorrelation-jmv-output3.jpg")
```

Die biseriale Rangkorrelation ist also $r = -0.212$. Je eher eine Ärztin verheiratet ist, desto tiefer ist der Burnout-Wert. Der Zusammenhang ist als mittel einzustufen. Achtung das Vorzeichen der biserialen Rangkorrelation hängt einzig davon ab, welche Gruppe (verheiratet/unverheiratet) als erste Gruppe in `Jamovi` hinterlegt ist. In diesem Datensatz ist dies, sofern nichts geändert wird die unverheiratete Gruppe.
:::


::: {.exercise  #test-preparation}
<!-- 
Ziel: 
- 
-->

```{r exr-test-preparation}
gen_exr_test_preparation <- function(){
  n <- 170
  Omega <- matrix(c(1, -0.23, -0.27,
                  -0.23, 1, 0.41,
                  -0.27, 0.41, 1), nrow = 3)
  
  dd = rcorrelated(n, 
                   mu = c(47.9, 72.1, 5),
                   sds = c(10, 10, 2),
                   Omega = Omega,
                   colnames = c("Prüfungsangst", "Prüfungsresultat", "Vorbereitung"))
  dd <- dd %>%
    mutate(Prüfungsangst = Prüfungsangst %>% round(),
           Prüfungsangst = case_when(Prüfungsangst > 75 ~75,
                           Prüfungsangst < 1 ~1,
                           TRUE~Prüfungsangst),
           Prüfungsresultat = Prüfungsresultat %>% round(1),
           Prüfungsresultat = case_when(Prüfungsresultat > 100 ~100,
                           Prüfungsangst < 1 ~1,
                           TRUE~Prüfungsresultat),
           Vorbereitung = case_when(Vorbereitung < 0 ~ 0,
                            Vorbereitung > 10 ~ 10,
                            TRUE~ Vorbereitung),
           Vorbereitung = Vorbereitung %>% round())
    
  file_name <- '08-exr-test-preparation.sav'
  dd %>% write_sav(file_name)
  corr_mat_pearson <- dd %>% cor()
  jmv_corr <- jmv::corrMatrix(dd, spearman = FALSE)$matrix$asDF %>%
    rename_with(~.x %>% str_replace_all("\\.|]", "") %>% str_replace_all("\\[","_"))
  jmv_partcorr <- (dd %>%
    jmv::corrPart(vars = c('Prüfungsangst', 'Prüfungsresultat'),controls = "Vorbereitung"))$matrix$asDF%>%
    rename_with(~.x %>% str_replace_all("\\.|]", "") %>% str_replace_all("\\[","_"))
  return(mget(ls()))
}
exr_test_preparation <- gen_exr_test_preparation()
```


Es ist bekannt, dass Prüfungsangst zu schlechterern Prüfungsergebnissen führt. In einer Studie soll herausgefunden werden, wie dieser Zusammenhang durch die Vorbereitung beeinflusst wird [@yusefzadeh2019]. Dafür wurde die Prüfungsangst mit dem test anxiety inventory TAI (von $0-75$), das Prüfungsergebnis (von $0-100$ Punkte) und die Vorbereitung (von $0-10$) gemessen. Letztere beruhte darauf, wie viele Prüfungsvorbereitungsgelegenheiten wahrgenommen wurde.

a) Berechnen Sie die Korrelation zwischen Prüfungsangst und Prüfungsergebnis und sichern Sie diese zweiseitig gegen Null ab. Berichten Sie das Ergebnis.
b) Berechnen Sie die partielle Korrelation indem Sie für die Vorbereitung kontrollieren und sichern Sie diese zweiseitig gegen Null ab. Berichten Sie das Ergebnis.
:::

:::{.solution}
Die Analyseparameter in `Jamovi` werden nun geändert, siehe Abbildung \@ref(fig:sol-test-preparation-input).

```{r sol-test-preparation-input, fig.cap='Jamovi Eingabe.', fig.show='hold', out.width='50%'}
knitr::include_graphics("figures/08-exr-test-preparation-jmv-input1.jpg")
knitr::include_graphics("figures/08-exr-test-preparation-jmv-input2.jpg")
```

Dies produziert das Analyseergebnis in Abbildung \@ref(fig:sol-test-preparation-output)

```{r sol-test-preparation-output, fig.cap='Jamovi Ausgabe.', fig.show='hold', out.width='50%'}
knitr::include_graphics("figures/08-exr-test-preparation-jmv-output1.jpg")
knitr::include_graphics("figures/08-exr-test-preparation-jmv-output2.jpg")
```

a) 
> Die zweiseitige Absicherung gegen Null des Korrelationskoeffizienten nach Pearson ergibt, dass sich die Korrelation zwischen Prüfungsangst und Prüfungsresultat ($r = `r round(exr_test_preparation$corr_mat['Prüfungsangst', 'Prüfungsresultat'],2)`$) signifikant von $0$ unterscheidet, `r absichern_pearson(exr_test_preparation$corr_mat['Prüfungsangst', 'Prüfungsresultat'], exr_test_preparation$n)`, $`r exr_test_preparation$jmv_corr %>% filter(name_r == "Prüfungsresultat") %>% pull(Prüfungsangst_rp) %>% as.numeric() %>% report_p(3)`$. Die Korrelation deutet auf einen schwachen Zusammenhang der Art je mehr Prüfungsangst desto schlechter das Prüfungsresultat.

b)
> Die zweiseitige Absicherung gegen Null der partiellen Korrelation ergibt, dass sich die Korrelation zwischen Prüfungsangst und Prüfungsresultat unter Berücksichtigung der Vorbereitung als Störfaktor ($r = `r round(exr_test_preparation$jmv_partcorr %>% filter(name_r == "Prüfungsresultat") %>% pull("Prüfungsangst_r") %>% as.numeric(),2)`$) nicht signifikant von $0$ unterscheidet, `r absichern_partiell(exr_test_preparation$jmv_partcorr %>% filter(name_r == "Prüfungsresultat") %>% pull("Prüfungsangst_r") %>% as.numeric(), exr_test_preparation$n)`, $`r exr_test_preparation$jmv_partcorr %>% filter(name_r == "Prüfungsresultat") %>% pull(Prüfungsangst_rp) %>% as.numeric() %>% report_p(3)`$. Die partielle Korrelation deutet auf einen schwachen Zusammenhang der Art je mehr Prüfungsangst desto schlechter das Prüfungsresultat.

:::




## Test

::: {.exercise  #test-theorie-korrelation}
Welche der folgenden Aussagen zum Zusammenhang zwischen zwei Merkmalen sind wahr, welche falsch?

a) Eine Korrelation von $r = -0.23$ deutet auf einen mittleren Zusammenhang der Art je mehr desto weniger hin.
b) Ein Grund für eine Korrelation von $r=0$ kann sein, dass der Zusammenhang nicht linear ist.
c) Je weiter die Korrelation von $0$ weg ist, desto eher ist der Zusammenhang von der Stichprobe auf die Grundgesamtheit übertragbar, gegeben dass die Stichprobengrösse gleich bleibt.
d) Eine Korrelation von $r = 0.2$ bedeutet, dass das erste Merkmal ursächlich für den Zusammenhang ist.
:::

:::{.solution}
a) Richtig
b) Richtig
c) Richtig
d) Falsch
:::

::: {.exercise  #test-theorie-korrelation1}
Welche der folgenden Aussagen zum Zusammenhang zwischen zwei Merkmalen sind wahr, welche falsch?

a) Um den Zusammenhang zwischen Gästezufriedenheit (Likert $1$ bis $5$) und der Zimmerart (basic oder superior) zu ermitteln, kann die Korrelation nach Spearman verwendet werden.
b) Um den Zusammenhang zwischen Anzahl Konflikten um Wasserrechte (intervallskaliert, nicht normalverteilt) und dem Wohlstand der beiden Gemeinden (intervallskaliert, normalverteilt) zu ermitteln, kann die Korrelation nach Pearson verwendet werden.
c) Um den Zusammenhang zwischen Alphabetisierungsrate (intervallskaliert,  normalverteilt) und Bruttoinslansprodukt (intervallskaliert, normalverteilt) von Ländern zu ermitteln, kann die Korrelation nach Pearson verwendet werden.
d) Die partielle Korrelation ist immer weniger oder gleich stark, als die direkt gemessene Korrelation.
:::

:::{.solution}
a) Falsch
b) Falsch
c) Richtig
d) Falsch
:::

::: {#test-spearman .exercise}
```{=html}
<!-- 
Ziel: 
- Starke Korrelation gegen Null absichern
-->
```

```{r exr-test-spearman}
gen_exr_test_spearman <- function(){
  n <- 122
  dd <- tibble(wartezeit = rexp(n, 1/10),
         wartezeit_jittered = wartezeit + rnorm(n, 1, 3),
         zufriedenheit = case_when(
           wartezeit_jittered > 2 ~ 4,
           wartezeit_jittered > 5 ~ 3,
           wartezeit_jittered > 10 ~ 2,
           wartezeit_jittered > 15 ~ 1,
           TRUE~5))
    
  file_name <- 'tests/08-test-spearman.sav'
  dd %>% write_sav(file_name)
  return(mget(ls()))
}
exr_test_spearman <- gen_exr_test_spearman()
```

Im folgenden wird eine Korrelation zwischen der Wartezeit am Flughafen und der Gästezufriedenheit berechnet. Dabei wird festgestellt, dass beide Merkmale intervallskaliert aber nicht normalverteilt sind. `Jamovi` liefert die Ausgabe in Abbildung \@ref(fig:sol-test-spearman-output).


```{r sol-test-spearman-output, fig.cap='Jamovi Eingabe.', fig.show='hold', out.width='50%'}
knitr::include_graphics("figures/08-exr-test-spearman-jmv-output.jpg")
```

Welche der folgenden Aussagen sind wahr welche falsch?

a) Es ist richtig die Korrelation hier mit dem Korrelationskoeffiizienten nach Pearson zu berechnen.
b) Die Korrelation sagt aus, dass die Gäste mit höherer Zufriedenheit weniger lange warten.
c) Der Zusammenhang ist schwach.
d) Es wurden $120$ Personen befragt.
e) Die Nullhypothese, dass die Korrelation in der Population bei $-0.302$ liegt, kann aufgrund des vorliegenden Testreultats abgelehnt werden.
f) Die Korrelation unterscheidet sich signifikant von $0$.
:::


:::{.solution}
a) Falsch
b) Richtig
c) Falsch
d) Falsch
e) Falsch
f) Richtig

:::