---
title: "Statistik 1"
author: "Daniel J. F. Gerber"
date: "`r format(Sys.time(), '%d %B, %Y')`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
---


# Vorwort {-#vorwort}

Dieses Buch ist im Rahmen meiner Lehrtätigkeit an der FHNW entstanden und frei verfügbar.

```{r load_packages, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(gridExtra)
library(jmv)
library(kableExtra)
source('src/r/bag_sampling.R')
source('src/r/plots.R')

options(scipen=999)

knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown', 'jmv'
), 'packages.bib')

combine_words <- function(x){
  knitr::combine_words(x, and = " und ", oxford_comma = FALSE)
}
inline_code <- function(x) {
  paste0("``", x, "``")
}

path_data <- 'data/'
write_sav <- function(x, file_name){
  x %>% 
    haven::write_sav(paste0(path_data, file_name))
}

crop <- function(x, x_min, x_max){
    x[which(x < x_min)] <- x_min
    x[which(x > x_max)] <- x_max
    return(x)
}
```

<!--chapter:end:index.Rmd-->

# Einleitung {#einleitung}

## Worum geht es?

## Inhaltlicher Aufbau {#inhaltlicher-aufbau}

Dieses Buch umfasst die untenstehenden Inhalte. Die Inhalte wurden hier nach Zwecken sortiert angeordnet:

Stichprobe beschreiben (__deskriptive Statistik__):

-	Arithmetisches Mittel
-	Median
-	Quantile
-	Anteil
-	Odds Ratio
-	Relatives Risiko

Population beschreiben (__Wahrscheinlichkeitslehre__):

-	Zufallsvariable
-	Erwartungswert
-	Standardabweichung
-	Varianz
-	Wahrscheinlichkeitsdichte
-	Wahrscheinlichkeitsverteilung
-	Verteilungen

Populationsparameter aus Stichproben schätzen (__Konfidenzintervalle__ + Stichprobengrösse):

-	Mittelwert
-	Standardabweichung
-	Anteil
-	Berichten
-	Darstellen


Aussagen auf die Population aufgrund von Stichproben machen (Test-Theorie):

-	Effektstärke
-	Berichten
-	T-Test (1 Stichprobe)
-	T-Test (2 Stichproben), Welch-Test
-	Welch Test
-	U-Test
-	Korrelation absichern gegen 0
-	Vierfelder/Mehrfeldertest

Zusammenhänge beschreiben (Zusammenhangsmasse):

-	Pearsons r
-	Spearmans rho
-	Vierfelderkorrelation / Phi
-	Punktbiseriale Korrelation
-	Kontingenzkoeffizient
-	Cramérs V

Die Inhalte nach Zweck zu gruppieren ist eine Option, die andere ist die Verfahren der Skalierung der Variablen folgend aufzubauen. Bei dieser Gruppierung ist der Zweck nicht direkt ersichtlich, dafür ist einfacher zu begreifen welches Verfahren für welche Ausgangslage geeignet ist. Diese Gruppierung wurde für die Präsentation der Inhalte in diesem Buch gewählt.

## Wie soll ich dieses Buch lesen? {#buch-lesen}

Dieses Buch enthält zu jedem Thema eine kurze Beschreibung der Theorie, Beispiele und Übungen. Das selbstständige Lösen der Übungen ist unerlässlich für das Verständnis und die Emanzipation im korrekten Umgang mit Daten. Ohne Übungen fehlt die Auseinandersetzung mit dem Unterrichtsstoff und ohne diese fällt es den allermeisten schwer sogar einfachste Zusammenhänge zu begreifen. Es wird deshalb empfohlen, dass die Übungen zum jeweiligen Thema zeitnah zur Theorie gelöst werden. Damit überprüft werden kann, ob die Übungen richtig gelöst wurden, ist zu jeder Übung eine kurze Lösung hinterlegt. Wer beim ersten selbstständigen Versuch der Übungslösung scheitert - was garantiert den meisten Lesenden hier ein oder mehrmals passieren wird -, kann die Übung mit Hilfe der Lösung lösen und zu einem späteren Zeitpunkt die Übung selbstständig nochmal machen ohne Lösung. Für die Statistik ist es also *nicht* genug den Stoff einmal auswendig zu lernen, Übung ist unerlässlich.

## Formeln, Symbole und Zahlen {#formeln}

Die Statistik bedient sich der universellen Sprache der Formeln. Es ist deshalb unerlässlich einige Formeln zu verstehen. Das Verständnis von Formeln ist für ungeübte Lesende verwirrend und schwierig. Deshalb wird dieses Verständnis in diesem Buch nach und nach aufgebaut. Dazu werden Teilformeln isoliert und erklärt und die Einflüsse der verschiedenen Kenngrössen in der Formel exploriert. 

Es gibt eine vielzahl von Möglichkeiten Formeln und Zahlen in einem Manuskript niederzuschreiben. Um die Formeln, Symbole und Zahlen verständlich und vergleichbar zu halten wurden verschiedene Standards definiert. In diesem Buch wird der Standard Richtlinien zur Manuskriptgestaltung der Deutschen Gesellschaft für Psychologie verwendet [@dgp2019]. Dieser ist wiederum stark an den Standard der American psychological assiciation angelehnt.   

## Software {#software}

Für die Lösung der Übungen wird oft die freie Software Jamovi verwendet. Dem Leser wird deshalb empfohlen diese Software zu installieren. Für die Erstellung dieses Buches wurden ferner die folgenden Softwareprodukte verwendet:

- Jamovi software (Version 2.3.21.0)
- Jamovi R-package [@R-jmv]
- R [@R-base]
- Tidyverse [@tidyverse2019]
- Bookdown [@bookdown2016]




<!--chapter:end:src/01-einleitung.Rmd-->

# (PART) Eine intervallskaliertes Merkmal {-}

# Intervallskalierte Merkmale {#intervallskalierte-merkmale}

## Was ist ein intervallskaliertes Merkmal? {#intervallskalierte-merkmale-definition}

[Ein Merkmal ist dann **intervallskaliert**, wenn die einzelnen Beobachtungen in eine natürliche Reihenfolge gebracht werden können und zwischen dem tiefsten und höchsten möglichen Wert, alle erdenklichen Zwischenwerte möglich sind.]{.customdef #customdef-intervallskaliert} 

:::{.example #humtemp name="Körpertemperatur"}
Ein Beispiel für ein intervallskaliertes Merkmal ist die Körpertemperatur. Beobachtungen der Körpertemperatur einer lebenden Person sind Werte zwischen ungefähr 10°C und 42°C. Es ist möglich zu sagen, dass eine Person mit 40°C Körpertemperatur eine höhere Temperatur hat als eine mit 38°C Körpertemperatur. Ausserdem sind alle erdenklichen Zwischenwerte möglich, so auch dass bei einer Person eine Körpertemperatur von 37.821239°C gemessen wird. 
:::

:::{.example #iq name="Intelligenzquotient"}
Ein weiteres Beispiel für ein intervallskaliertes Merkmal ist der Intelligenzquotient _IQ_. Der IQ bewegt sich normalerweise zwischen 50 und 150, eine Person mit einem IQ von 105 hat einen höheren IQ als eine Person mit einem IQ von 103. Ausserdem sind IQ-Werte von 103.12 oder 118.9182 durchaus möglich.
:::

<details>
  <summary>Klicke hier, falls dir verhältnisskalierte Merkmale bekannt sind</summary>
    Die folgende Diskussion ist auch auf verhältnisskalierte Merkmale anwendbar. Letztere sind intervallskalierte Merkmale, welche einen absoluten Nullpunkt aufweisen.
</details> 


## Wie kann ein intervallskaliertes Merkmal beschrieben werden? {#intervallskalierte-merkmale-beschreibung}


```{r exm-ducktemp, echo=FALSE}
gen_exm_ducktemp <- function(){
  set.seed(11242)
  n <- 40
  x <- round(rnorm(n, 41.1+(42.2-41.1)/2, (42.2-41.1)/4), 2)
  sorted_x <- sort(x)
  tab <- tibble(temperatur = x)
  file_name <- '02-exm-ducktemp.sav'
  tab %>% 
    haven::write_sav(paste0(path_data, file_name))
  
  hist <- tab %>% 
    ggplot()+
    geom_histogram(aes(x=temperatur, colour = 'blue'),
                   binwidth=0.2)+
    labs(title = "Histogramm Körpertemperatur Enten", 
         y= "Häufigkeit", 
         x = "Temperatur")+
    theme(legend.position = "none")+
    scale_y_continuous(breaks=c(0:17))
  
  counts_x <- table(x)
  mode_x <- counts_x[counts_x == max(counts_x)]
  return(mget(ls()))
}

exm_ducktemp <- gen_exm_ducktemp()
```

:::{.example #ducktemp name="Körpertemperatur Enten"}
Eine Veterinärin möchte herausfinden, welche Körpertemperatur Enten aufweisen. Dazu untersucht sie `r exm_ducktemp$n` Enten und misst die Körpertemperaturen `r combine_words(exm_ducktemp$x)`.
:::

Für einen Menschen ist es schwierig direkt aus der Sichtung dieser Zahlen zu begreifen, welche Körpertemperatur Enten haben. Ein Mensch kann sich jedoch helfen, indem er die Zahlen zusammenfasst.

### Verteilung {#verteilung}

Um die Zahlen zusammenzufassen, kann die Veterinärin zum Beispiel Temperaturabschnitte von $0.2$°C betrachten und zählen wie viele Beobachtungen sie in den jeweiligen Abschnitten gemacht hat. Diese Zähldaten können tabellarisch oder grafisch mit einem Balkendiagramm dargestellt werden. Letzteres wird ein __Histogramm__ genannt.

```{r enten_histogramm}
exm_ducktemp$hist
```

Aufgrund dieser Darstellung kann die Veterinärin nun sehen, wie häufig welche Körpertemperaturen sind. Dies wird die __Verteilung__ des Merkmals genannt. Sie bemerkt zum Beispiel, dass Beobachtungen der Körpertemperatur rund um 41.6°C am häufigsten sind und tiefere und höhere Temperaturen seltener vorkommen. Auf einen Blick sieht sie auch, dass die Temperatur aller Enten zwischen 41°C und 42.2°C war.

Die Verteilung eines Merkmals zu kennen ist hilfreich, jedoch in vielen Situationen (z. B. in der Kommunikation) noch zu komplex. Einfacher ist es die Komplexität einer Verteilung auf zwei Faktoren herunterzubrechen: Die Zentralität und die Variabilität eines Merkmals. 

### Zentralität {#zentralitaet}

Mit der Zentralität ist ein Wert gemeint, welcher die zentrale Tendenz des Merkmals abbildet. Um die Zentralität zu messen, gibt es drei Möglichkeiten:

- [Der __Modus__ ist der am häufigsten vorkommende Wert.]{.customdef #customdef-modus} Im Beispiel ist das der Wert `r names(exm_ducktemp$mode_x)`, welcher `r unname(exm_ducktemp$mode_x)` mal und damit am häufigsten vorkommt. In Jamovi wird der Modus mit `Modalwert` bezeichnet.
- [Wenn die Werte des Merkmals aufsteigend sortiert werden und der Wert betrachtet wird, welcher die Beobachtungen in eine tiefere und eine höhere Hälfte teilt, dann wird dieser Wert als __Median__ (abgekürzt _Mdn_, Symbol $\tilde{x}$) bezeichnet.]{.customdef #customdef-median} Bei einer geraden Anzahl Beobachtungen, wird in der Regel der Durchschnittswert der beiden mittigsten Beobachtungen verwendet. Im Beispiel haben wir `r exm_ducktemp[['n']]` Beobachtungen. Der Median entspricht also dem Durchschnittswert zwischen dem 20. und dem 21. der aufsteigend sortierten Werte `r combine_words(exm_ducktemp$sorted_x)`, also `r median(exm_ducktemp$x)`. In Jamovi wird der Median mit `Median` bezeichnet.
- [Das __arithmetische Mittel__ (abgekürzt _M_, Symbol $\bar{x}$) bezeichnet, was gemeinhin mit Durchschnitt gemeint ist.]{.customdef #customdef-arithmetisches-mittel} Wenn wir die erste von insgesamt $n$ Beobachtung mit $x_1$ und die letzte Beobachtung mit $x_n$ bezeichnen, so ist das arithmetische Mittel
\begin{equation}
\bar{x} = \frac{1}{n}\sum^n_{i=1} x_i
(\#eq:mean)
\end{equation}
Im Beispiel ist das arithmetische Mittel der Körpertemperaturen `r mean(exm_ducktemp$x)`. In Jamovi wird das arithmetische Mittel als `Mittelwert` bezeichnet.

:::: {.caution  data-latex=""}

::: {.remark}

_Erklärung der Formel_: Hier wird zum ersten Mal eine Formel verwendet. $\sum$ steht für die Summe von allen Beobachtungen $x_i$, wenn der Index $i$ in $1$-Schritten von der Zahl unter dem Summenzeichen $i=1$ bis zu der Zahl oben am Summenzeichen $i=n$ läuft. In unserem Beispiel ist $n=`r exm_ducktemp[['n']]`$, also ist $i = 1, 2, 3, 4, \ldots, `r exm_ducktemp[['n']]-1`, `r exm_ducktemp[['n']]`$. Der Teil $\sum^n_{i=1} x_i$ bedeutet also nichts anderes als $x_1 + x_2 + \ldots + x_{`r exm_ducktemp[['n']]-1`} + x_{`r exm_ducktemp[['n']]`}$, also die Summe aller Beobachtungen. $\frac{1}{n}$ bedeutet, dass wir diese Summe jetzt noch durch die Anzahl Beobachtungen teilen. 

_Welchen Einfluss haben die verschiedenen Einflussgrössen_: Dies wird in Übung \@ref(exr:theorie-mdn-mean) erklärt.
:::

::::

Jedes dieser Masse für die Zentralität hat Vor- und Nachteile und sie werden dementsprechend in unterschiedlichen Situationen eingesetzt, siehe Übungen.

### Variabilität {#variabilitaet}


- [Die __Spannweite__ (abgekürzt $R$ aus dem englisch _range_) ist der höchste beobachtete Wert minus der kleinste beobachtete Wert]{.customdef #customdef-spannweite}. Im Beispiel ist der höchste beobachtet Wert $`r max(exm_ducktemp$x)`° C$ und der kleinste Beobachtete Wert $`r min(exm_ducktemp$x)`° C$. Also ist die Spannweite $`r max(exm_ducktemp$x)` - `r min(exm_ducktemp$x)` = `r max(exm_ducktemp$x) - min(exm_ducktemp$x)`° C$. Die Spannweite wird in Jamovi mit `Wertebereich` bezeichnet. 
- [Wenn die Werte des Merkmals aufsteigend sortiert werden und der Wert betrachtet wird, welcher die Beobachtungen in eine $P\%$ tiefere und $(100\% - P\%)$ höhere Hälfte teilt, dann wird dieser Wert als __Perzentil__ bezeichnet.]{.customdef #customdef-perzentil} Das $5\%$-Perzentil zum Beispiel teilt die beobachteten Werte in $5\%$ kleinere und $95\%$ grössere Werte. Im Beispiel haben wir `r exm_ducktemp[['n']]` Beobachtungen. $5\%$ davon sind demnach $2$ Beobachtungen die tiefer sind als das $5\%$ Perzentil und $95\%$ also $38$ Beobachtungen die höher sind als das $5\%$ Perzentil. Das $5\%$ Perzentil liegt also zwischen $`r exm_ducktemp$sorted_x[2]`° C$ und $`r exm_ducktemp$sorted_x[3]`° C$. In diesem Fall wird ein Mittelwert der beiden nächsten Werte verwendet, hier $(`r exm_ducktemp$sorted_x[2]` + `r exm_ducktemp$sorted_x[3]`)/2=`r round((exm_ducktemp$sorted_x[2] + exm_ducktemp$sorted_x[3])/2,2)`° C$. Das $P\%$-Perzentil kann in Jamovi bei `Perzentil` gefolgt von der Zahl `P` ermittelt werden. Ein Perzentil alleine gibt jedoch noch keinen Hinweis auf die Streuung der Werte. Werden aber zwei Perzentile zusammen betrachtet, z. B. das $5\%$ und das $95\%$ Perzentil, dann geben diese Werte und der Abstand dazwischen einen Hinweis auf die Streuung der Beobachtungen. Im Beispiel ist das $5\%$ Perzentil bei $`r round((exm_ducktemp$sorted_x[2] + exm_ducktemp$sorted_x[3])/2,2)`° C$ und das $95\%$-Perzentil bei $`r round((exm_ducktemp$sorted_x[38] + exm_ducktemp$sorted_x[39])/2,2)`° C$. Hier befinden sich also $90\%$ aller Beobachtungen zwischen diesen Werten. Mehrere Perzentile können in Jamovi  gleichzeitig angezeigt werden indem die Perzentil-Werte mit Komma getrennt werden, für die Perzentile hier im Beispiel `0.05, 0.95`. [Weitere beliebte Werte sind das $25\%$ und das $75\%$-Perzentil (auch __Quartile__ genannt, da sie die beobachteten Werte vierteln), im Beispiel bei $`r round((exm_ducktemp$sorted_x[10] + exm_ducktemp$sorted_x[11])/2,2)`° C$ und $`r round((exm_ducktemp$sorted_x[30] + exm_ducktemp$sorted_x[31])/2,2)`° C$ respektive.]{.customdef #customdef-quartile} [Die Differenz dieser Perzentile wird als __Interquartilabstand__ (abkürzung IQR von interquartile range) bezeichnet und ist im Beispiel $`r round((exm_ducktemp$sorted_x[30] + exm_ducktemp$sorted_x[31])/2,2) - round((exm_ducktemp$sorted_x[10] + exm_ducktemp$sorted_x[11])/2,2)`° C$.]{.customdef #customdef-iqr}. Der Interquartilabstand wird in Jamovi mit `IQR` bezeichnet. 
- [Die __Standardabweichung__ (abgekürzt _SD_, Symbol $s$) ist die durchschnittliche Abweichung jeder Beobachtung vom arithmetischen Mittel.]{.customdef #customdef-std} Wenn wir die erste von insgesamt $n$ Beobachtung mit $x_1$ und die letzte Beobachtung mit $x_n$ bezeichnen, so ist die Standardabweichung
\begin{equation}
s = \sqrt{\frac{1}{n-1}\sum^n_{i=1} (x_i-\bar{x})^2}
(\#eq:sd)
\end{equation}
Im Beispiel ist die Standardabweichung der Körpertemperaturen $`r round(sd(exm_ducktemp$x),3)`° C$. In Jamovi wird die Standardabweichung mit `Std.-abweichung` bezeichnet.

::::{.caution data-latex=""}
::: {.remark}

_Erklärung der Formel_: $(x_i-\bar{x})$ bezeichnet den Abstand von jeder Beobachtung zum arithmetischen Mittel. Dieser Abstand kann positiv (wenn $x_i$ grösser ist als $\bar{x}$) oder negativ (wenn $x_i$ kleiner ist als $\bar{x}$) ausfallen. Damit diese positiven  und negativen Abstände sich in der Summe nicht ausgleichen und eine Standardabweichung von 0 entsteht, werden diese Abstände quadriert $(x_i-\bar{x})^2$ bevor sie summiert werden. Anschliessend wird diese Summe durch $n-1$ geteilt, um den durchschnittlichen Abstand pro Beobachtung zu ermitteln. Intuitiv würde man hier durch $n$ teilen. Statistiker:innen haben jedoch herausgefunden, dass es einige Vorteile hat, wenn durch $n-1$ statt $n$ geteilt wird. Das Quadrat wird nach der Aufsummierung wieder aufgehoben indem die Quadratwurzel gezogen wird.
:::
::::

## Übungen  {#intervallskaliertes-merkmal-uebungen}

::: {.exercise  #enten-hist-mean-sd}
<!-- 
Ziel: 
- Erste Berechnung
- Jamovi funktioniert
-->
Mit den Daten `r inline_code(exm_ducktemp$file_name)` aus Beispiel \@ref(exm:ducktemp):

  (a) Erstellen Sie selbst ein Histogramm  mit Jamovi und begründen Sie, weshalb es nicht gleich aussieht wie das Histogramm oben. 
  (b) Berechnen Sie zusätzlich Modus, Median, arithmetisches Mittel, IQR, 25%- und 75%-Perzentil, sowie 2.5%- und 97.5%-Perzentil, sowie die Spannweite und die Standardabweichung der Körpertemperaturen der Enten mit Jamovi.
:::

:::{.solution}
  ```{r enten-hist-mean-sd1, echo=FALSE, fig.cap="Links: Jamovi-Anleitung zur Erstellung des Histogramms; rechts: Histogramm der Temperatur.", fig.show="hold", out.width="50%"}
  knitr::include_graphics("figures/Enten_n40_instr_histogramm.jpg")
  knitr::include_graphics("figures/Enten_n40.png")
  ```
  (a) Das Histogramm, siehe Abbildung \@ref(fig:enten-hist-mean-sd1) sieht nicht gleich aus, da Jamovi die Temperaturabschnitte kürzer gewählt hat nämlich bei 0.125°C statt 0.2°C wie oben im Text. In Jamovi gibt es aktuell keine Möglichkeit die Abschnittsweite anzupassen. Ein Histogramm sieht immer anders aus je nach ausgewählter Abschnittsweite. 
  
```{r enten-hist-mean-sd2, echo=FALSE, fig.cap="Links: Jamovi-Anleitung zur Berechnung der gewünschten Parameter; rechts: Parameterwerte.", fig.show="hold", out.width="50%"}
  knitr::include_graphics("figures/02-exr-enten-hist-mean-sd-input.jpg")
  knitr::include_graphics("figures/02-exr-enten-hist-mean-sd-output.jpg")
```
  
  (b) Eine Anleitung zur Berechnung in Jamovi sowie die berechneten Werte können in Abbildung \@ref(fig:enten-hist-mean-sd2) abgelesen werden.
:::

::: {.exercise #temptag_pvai8hwv}
<!-- 
Ziel: 
- Berechnung mit Jamovi festigen
- Output-interpretation
-->
TODO: Exercise body
:::

:::{.solution}
TODO: solution body
:::



::: {.exercise #theorie-mdn-mean}
<!-- 
Ziel: 
- Computeranweisung mit Verfahrensberechnung verknüpfen.
- Vor/Nachteile Mean/median kennen.
-->
In einem psychologischen Test machen $5$ Probandinnen die Werte $18, 21, 20, 19, 22$. Um mit einer Zahl zu sagen, wo die Testresultate liegen, wird ein zentraler Wert berechnet.

  (a) Wie gross ist das arithmetische Mittel und der Median dieser Werte?
  (b) Nehme an, der Testleiter hat den Wert der ersten Probandin falsch in seine Tabelle übertragen - statt $18$ hat er $81$ geschrieben. Wie gross ist das arithmetische Mittel und der Median dieser Werte in diesem Fall?
  (c) Was sagt dies über den Median und das arithmetische Mittel aus?
:::

:::{.solution}
Die Aufgabe kann im Kopf gelöst werden, oder mithilfe eines Taschenrechners, oder indem die Zahlen manuell bei Jamovi eingegeben werden.

  (a) Wir haben hier $n=5$ Beobachtungen, nämlich $x_1 = 18, x_2 = 21, x_3 = 20, x_4 = 19, x_5=22$. Wird dies in die Formel \@ref(eq:mean) eingesetzt, so gibt dies das arithmetische Mittel
  $$\bar{x} = \frac{1}{n}\sum^n_{i=1} x_i = \frac{1}{n}(x_1 + x_2 + x_3 + x_4 + x_5) =  \frac{1}{5}(18+ 21+ 20+ 19+ 22) = 20.$$
 Um den Median zu berechnen, werden die Werte zuerst aufsteigend sortiert $18, 19, 20, 21, 22$. Der Wert, welcher die Werte in eine grössere und eine kleinere Hälfte teilt, ist hier $20$, was dem Median entspricht.
  (b) Die Beobachtungen sind jetzt $x_1 = 81, x_2 = 21, x_3 = 20, x_4 = 19, x_5=22$. Analog wie in (a) kann demnach das arithmetische Mittel als $\bar{x} = `r mean(c(81, 19, 20, 21, 22))`$ bestimmt werden. Die aufsteigend sortierten Beobachtungen sind nun $19, 20, 21, 22, 81$. Der Median ist also $21$.
  (c) Durch die fälschliche Übertragung eines Wertes, ist das arithmetische Mittel sehr stark und der Median fast gar nicht beeinflusst worden. Wenn die Daten wenige fehlerhafte Beobachtungen enthalten, ist der Median das bessere Mass für den zentralen Wert als das arithmetische Mittel. Wenn die Daten keine Fehler enthalten, ist das arithmetische Mittel gleich gut geeignet wie der Median.

:::

::: {.exercise #temptag_poiane}
<!-- 
Ziel: 
- Berechnung mit Jamovi festigen
- Output-interpretation
- Berichten
-->
TODO: Exercise body
:::

:::{.solution}
TODO: solution body
:::



:::{.exercise #diverse-distrib}
<!-- 
Ziel: 
- Berechnung mit Jamovi festigen
- Vernetzung: Output-interpretation mit verschieden verteilten Merkmalen vergleichen
-->
```{r exr-diverse-distrib}
gen_exr_diverse_distrib <- function() {
  n <-  500
  set.seed(1298)
  file_name <- '02-exr-diverse-distrib.sav'
  tab <- tibble(
    IQ = rnorm(n, 100, 15),
    Aufgeschlossenheit = round(rnorm(n, 4, 1),1),
    Wartezeit_min = rexp(n, 1/5),
    Wartezeit_std = Wartezeit_min / 60,
    Geburtzeit_std_ab_mitternacht = runif(n, 0, 24),
    Geburtzeit_std_ab_mittag = (Geburtzeit_std_ab_mitternacht - 12) %%
      24,
    Punkte = rbinom(n, 20, 0.9) 
  ) %>% 
    mutate(Aufgeschlossenheit = case_when(Aufgeschlossenheit> 7 ~7,
                                          Aufgeschlossenheit <1 ~1,
                                          TRUE~ Aufgeschlossenheit))
  tab %>%
    write_sav(file_name)
  jmv_output <- tab %>%
    descriptives(vars = vars(IQ, 
                             Aufgeschlossenheit,
                             Wartezeit_std,
                             Wartezeit_min,
                             Geburtzeit_std_ab_mitternacht,
                             Geburtzeit_std_ab_mittag,
                             Punkte),
                 desc = "rows",
                 hist = TRUE,
                 mode = TRUE)
  return(mget(ls()))
}
exr_diverse_distrib <- gen_exr_diverse_distrib()
```

Für eine Studie werden Studierende gebeten eine Aufgabe zu lösen, bei welcher Sie eine gewisse Anzahl `Punkte` erzielen. Über jede Proband:in sind ausserdem folgende Eigenschaften bekannt:

- `IQ`: Intelligenzquotient
- `Aufgeschlossenheit`: Likert von 1-7
- `Wartezeit_min`: Wartezeit vor beginn des Experiments in Minuten
- `Wartezeit_std`: Wartezeit vor beginn des Experiments in Stunden
- `Geburtzeit_std_ab_mitternacht`: Geburtszeit in Stunden ab Mitternacht. Wenn jemand um 13h30 auf die Welt kam, ist dieser Wert 13.5.
- `Geburtzeit_std_ab_mittag`: Geburtszeit in Stunden ab Mittag. Wenn jemand um 13h30 auf die Welt kam, ist dieser Wert 1.5.

Die Daten sind in Jamovi unter `r inline_code(exr_diverse_distrib$file_name)` verfügbar.

Analysieren Sie alle erhobenen Merkmale indem Sie ein Histogramm erstellen und die zentralen Tendenzen sowie die Variabilität analysieren.

a. Wie viele Personen nahmen an der Studie teil?
b. Vergleichen Sie Ihre Ergebnisse für die Merkmale IQ und Aufgeschlossenheit. Was für Zusammenhänge fallen auf?
c. Vergleichen Sie Ihre Ergebnisse für die Wartezeiten Merkmale. Was für Zusammenhänge fallen auf?
d. Vergleichen Sie Ihre Ergebnisse für die Merkmale Punkte und Wartezeiten. Was für Zusammenhänge fallen auf?
e. Geburtszeit. TODO.
:::

:::{.solution}
```{r sol-diverse-distrib1, out.width='100%', fig.cap='Jamovi Eingabe.', fig.show='hold'}
knitr::include_graphics("figures/02-exr-diverse-distrib-input.jpg")
```

```{r sol-diverse-distrib2, out.width='100%', fig.cap='Deskriptive Statistiken.', fig.show='hold'}
knitr::include_graphics("figures/02-exr-diverse-distrib-output.jpg")
```            

```{r sol-diverse-distrib3, out.width='33%', fig.cap='Histogramme.', fig.show='hold'}
exr_diverse_distrib$jmv_output$plots
```

Die Merkmale werden mit den Befehlen in Abbildung \@ref(fig:sol-diverse-distrib1) analysiert.

a. Es gibt gemäss \@ref(fig:sol-diverse-distrib2) genau $500$ Studienteilnehmende (siehe $N$).
b. Die Histogramme für den IQ und die Aufgeschlossenheit weisen eine ähliche Form auf. Viele Beobachtungen sind um eine Mitte zentriert. Je weiter weg von der Mitte, desto seltener sind die Beobachtungen. Das Histogram des IQ zeigt, dass die Verteilung rund um 100 zentriert ist und ca von 60 bis 140 reicht. Je weiter entfernt von 100, desto weniger Beobachtungen wurden gemacht. Das Histogram der Aufgeschlossenheit stellt dar, dass diese rund um 4 zentriert ist mit Werten von 1 bis 7. Je weiter die Werte von 4 entfernt sind, desto weniger häufig sind die Beobachtungen. Der vom Histogram abgeleitete vorher genannte zentrale Wert entspricht ungefähr dem Mittelwert und dem Median für beide Merkmale. Für die Aufgeschlossenheit hat der Modalwert ebenfalls einen ähnlichen Wert. Der Modus für den IQ ist nicht belastbar, da die Fussnote besagt, dass mehrere Werte als Modus in Frage kommen. Eine genauere Durchsicht der IQ-Werte lässt folgern, dass aufgrund der vielen Nachkommastellen jeder IQ-Wert nur genau einmal vorkommt. Der angebene Modalwert des IQs entspricht also einfach einer zufälligen Beobachtung. Die Kennwerte für die Variabilität lassen ebenfalls auf Unterschiede zwischen den beiden Merkmalen schliessen. Die höheren Werte Standardabweichung, IQR und Wertebereich des IQ im Vergleich zur Aufgeschlossenheit legen nahe, dass die Streuung der Werte für den IQ viel grösser ist. Zum Beispiel ist eine durchschnittliche IQ-Beobachtung 15.5 IQ-Werte weg vom durchschnittlichen IQ und eine durchschnittliche Aufgeschlossenheits-Beobachtung nur 1.3 Aufgeschlossenheits-Werte weg von der duchschnittlichen Aufgeschlossenheit. Dies ist auf dem Histogramm zu erkennen, wenn die Skala der horizontalen Achse betrachtet wird. Für den IQ reicht diese von 50 bis 125 und für die Aufgeschlossenheit von 2 bis 6.
c. Die Wartezeiten wurden einmal in Minuten und einmal in Stunden abgespeichtert. Die resultierenden Histogramme sind deshalb genau identisch bis auf die Werte der horizontalen Achse, welche von 0 bis 0.6 Stunden und von 0 bis 40 Minuten reicht. Im Vergleich zu den Histogrammen des IQ und der Aufmerksamkeit kann für die Wartezeit und eine asymetrische Verteilung beobachtet werden. Kurze Wartezeiten werden demnach häufiger beobachtet als längere Wartezeiten. Die meisten Wartezeiten liegen unter 10 Minuten, sehr selten kommt es zu Wartezeiten über 20 Minuten. Die Kennzahlen für die Wartezeit in Stunden können aus den Kennzahlen der Wartezeit in Stunden hergeleitet werden indem die Werte durch $60$ geteilt werden. Es reicht deshalb die Kennzahlen für die Wartezeit in Minuten zu betrachten. Die durchscnittliche Wartezeit liegt bei $M=5.07, Mdn = 3.97$ Minuten. Der Modalwert ist wiederum nicht interpretierbar aus demselben Grund wie oben. Der Median bedeutet, dass $50\%$ der Wartezeiten kleiner und $50\%$ der Wartezeiten grösser waren als $3.97$ Minuten. Das arithmetische Mittel ist höher als der Median. Die einigen wenigen Beobachtungen mit sehr langen Wartezeiten haben also das arithmetische Mittel im Vergleich zum Median stärker beeinflusst.
d. TODO.
e. TODO: Zentraler Wert hier nicht identifiziertbar, streuung auch nicht.
:::

<!--chapter:end:src/02-1-was_ist_eine_intervallskalierte_variable.Rmd-->

# Stichprobenziehung {#stichprobenziehung}

:::{.example #angst name="Angst"}

```{r exm-angst, include=FALSE}
gen_exm_angst <- function(){
  set.seed(12452)
  n <- 30
  x_mean <- 43.2
  x_sd <- 7.8
  x <- rnorm(n, x_mean, x_sd)
  
  set.seed(1928)
  n_samples <- 1000
  x_means <- map_dbl(1:n_samples, ~ mean(rnorm(n, x_mean, x_sd)))
  x_sds <- map_dbl(1:n_samples, ~ sd(rnorm(n, x_mean, x_sd)))
  lb_means_emp <- round(unname(quantile(x_means, 0.025)), 1)
  ub_means_emp <- round(unname(quantile(x_means, 0.975)), 1)
  
  m_means <- mean(x)
  s_means <- sqrt(sd(x) / n)
  lb_means_t <- m_means - qt(0.975, n - 1) * s_means
  ub_means_t <- m_means + qt(0.975, n - 1) * s_means
  
  return(mget(ls()))
}
exm_angst <- gen_exm_angst()
```

Forschende haben ein Messinstrument State-Trait Anxiety Inentory _STAI_, welches Angst misst [@spielberger1983manual]. Sie unterscheiden dabei zwischen Zustandesangst und dem Persönlichkeitszug Ängslichkeit. Hier interessiert uns nur die Zustandesangst, welche fortan Angst genannt wird und misst wie grosse Angst man aktuell empfindet. Die so gemessene Angst enstpricht einem Wert zwischen $20$ und $80$. A priori haben die Forschenden keine Ahnung, wie viel Angst eine Person im Durchschnitt hat und ob die ganze Skala der Werte genutzt wird. Die Forschenden machen deshalb eine kleine Befragung mit $n =`r exm_angst$n`$ zufällig ausgewählten Studierenden. Die Forschenden finden die zusammenfassenden Werte $M=`r round(mean(exm_angst$x), 2)`, s = `r round(sd(exm_angst$x),2)`, n = `r exm_angst$n`$ für die Angst in ihren Beobachtungen.
:::

[Zufällig ausgewählte Beobachtungen eines Merkmals werden als __Stichprobe__ bezeichnet.]{.customdef #customdef-stichprobe} [Nach der Auswahl der Stichprobe ist die __Stichprobenziehung__.]{.customdef #customdef-stichprobenziehung} Ist mit diesen Beobachtungen die Aussage beschränkt auf die Stichprobe oder kann damit auch eine Aussage zur Angst für alle Personen getroffen werden? [Alle Personen, oder generell alle möglichen Beobachtungen eines Merkmals, werden als __Population__]{.customdef #customdef-population} [oder __Grundgesamtheit__ bezeichnet]{.customdef #customdef-grundgesamtheit}. [Eine Stichprobe ist für viele Analyseverfahren repräsentativ für eine Population, wenn sie zufällig aus dieser Population gezogen. Ist dies gegeben, wird die Stichprobe auch als __Zufallsstichprobe__ bezeichnet.]{.customdef #customdef-zufallsstichprobe} 

::::{.caution}

:::{.remark}
Viele Studien basieren auf Testresultaten von Studierenden, weil diese nahe am Forschungsbetrieb sind und damit über Studien informiert sind oder für wenig Geld oder Bildungsanerkennung an Studien teilnehmen. Einige dieser Studien generalisieren ihre Forschungsresultate nachher auf alle Personen. Dies ist in der Regel falsch, da Studierende nicht repräsentativ für die Gesamtbevölkerung sind (Altersstruktur, Geschlechtsverteilung, Vermögen, usw.). Die Frage, wie eine repräsentative Stichprobe würde den Rahmen dieses Buches sprengen.
:::

::::

## Was ist das Problem der Stichprobenziehung? {#stichprobenziehung-problem}

Es wird angenommen, dass sich alle Personen der Population in einem Zimmer befinden. In Abbildung \@ref(fig:srs-intervall-nocol) ist dieses Zimmer aus der Vogelperspektive dargestellt, wobei jeder Punkt im schwarzen Kasten einer Person der Population. Die Personen im Zimmer, respektive die Beobachtungen in der Population sind normalerweise nicht sichtbar. Aus diesem Zimmer wurden also `r exm_angst$n` Personen geholt und befragt also sichtbar gemacht, was der Zufallsstichprobe entspricht. Die Zufallsstichprobe ist gekennzeichnet durch die Punkte über dem Zimmer, oberhalb des Pfeils. Die Farben der Punkte sind jetzt bekannt und entsprechen der jeweiligen Zustandesangst der beobachteten Personen.


```{r srs-intervall-nocol, echo = FALSE, fig.cap="Population mit unbekannter Angst."}
plot_ball_bag(
  scores_bag = c(20, 80, rnorm(198, exm_angst$x_mean, exm_angst$x_sd)),
  scores_hover = exm_angst$x,
  score_name = "Angst",
  bag_color = "grey90",
  seed = 123,
  color_bag_balls = FALSE
)
```

Da die Stichprobe nun eben zufällig gezogen wurde, das heisst zufällig Personen aus dem Zimmer geholt wurden, kann es nun sein, dass die Stichprobe einer Population wie in Abbildung \@ref(fig:srs-intervall-high-p) entstammt.


```{r srs-intervall-high-p, fig.cap="Population mit ähnlichen Angst-Werten wie in der Stichprobe.", echo = FALSE}
scores_bag_high_p <- c(20, 80, rnorm(198,  exm_angst$x_mean, exm_angst$x_sd))
plot_ball_bag(
  scores_bag = scores_bag_high_p,
  scores_hover = exm_angst$x,
  score_name = "Angst",
  seed = 123
)
```

Es könnte aber auch sein, dass die Stichprobe einer Population mit viel höherer Zusatandsangst, wie in Abbildung \@ref(fig:srs-intervall-low-p) dargestellt, entstammt. Dies wird zwar weniger häufig vorkommen als der Fall oben, aber ist trotzdem möglich.

```{r srs-intervall-low-p, fig.cap="Population mit höheren Angst-Werten als in der Stichprobe.", echo = FALSE}
scores_bag_low_p <-  c(20, 80, rnorm(198, 52, exm_angst$x_sd))
plot_ball_bag(
  scores_bag = scores_bag_low_p,
  scores_hover = exm_angst$x,
  score_name = "Angst",
  seed = 123
)
```

Das Problem der zufälligen Stichprobenziehung ist also, dass nie ganz klar ist, wie die darunterliegende Population aussieht. Sind die Werte der Stichprobe tief, weil zufällig gerade Studierende mit tiefer Angst beobachtet wurden, oder haben tatsächlich die meisten Studierenden eine tiefe Angst?

## Wie kann man Aussagen über die Grundgesamtheit machen? {#stichprobenziehung-loesung}

Die Lösung dieses Problems funktioniert intuitiv wie folgt: Man stellt sich vor, die Stichprobenziehung würde erneut gemacht, und dann nochmal und dann nochmal. So oft, bis man einen guten Eindruck davon hat, wie häufig eine Stichprobe mit eher tiefen Angst-Werten wie bei der Stichprobe im Beispiel vorkommt. Im Szenario, in welchem in der Population tatsächlich tiefe Werte häufig vorkommen, kann dies aussehen wie in Abbildung \@ref(fig:srs-intervall-high-p-many). Stichproben mit eher tiefen Angst-Werten kommen hier häufig vor.

```{r srs-intervall-high-p-many, fig.cap="TODO.", echo = FALSE}
plots <- list()
for (i in 1:6) {
  set.seed(i * 5 + 789)
  scores_hover <- rnorm(exm_angst$n,  exm_angst$x_mean, exm_angst$x_sd)
  plots[[i]] <- plot_ball_bag(
    scores_bag = scores_bag_high_p,
    scores_hover = scores_hover,
    score_name = "Angst",
    seed = 123,
    no_legend = TRUE
  )
}
do.call(grid.arrange, c(plots, ncol = 3))
```

Im Szenario, in welchem in der Population tatsächlich höhere Werte häufig vorkommen, kann dies aussehen wie in Abbildung \@ref(fig:srs-intervall-low-p-many). Stichproben mit eher tiefen Angst-Werten kommen hier selten oder gar nicht vor.

```{r srs-intervall-low-p-many, fig.cap="TODO.", echo = FALSE}
plots <- list()
for(i in 1:6){
  set.seed(i*5+789)
  scores_hover <- rnorm(exm_angst$n, 52, exm_angst$x_sd)
  plots[[i]] <-plot_ball_bag(
  scores_bag = scores_bag_low_p,
  scores_hover = scores_hover,
  score_name = "Angst",
  seed = 123, 
  no_legend = TRUE)
}
do.call(grid.arrange, c(plots, ncol = 3))
```

Es kann also zusammenfassend gesagt werden, dass die gezogene Stichprobe wohl eher aus einer Population mit tiefen Angst-Werten gezogen wurde als aus einer Population mit eher höheren Angst-Werten. Ganz sicher kann man jedoch nie sein, da die Werte in der Population eigentlich unbekannt sind. Eine genaue Quantifizierung dieser Unsicherheit kann mit Hilfe der Statistik erreicht werden und wird in den folgenden Kapiteln dieses Buches erläutert.

## Übungen

::: {.exercise  #tagname_alskfdieu}
<!-- 
Ziel: 
- Begriffsklärung Stichprobe / Population / Grundgesamtheit / Zufallsstichprobe
-->
TODO: Exercise body
:::

:::{.solution}
TODO: solution body
:::

::: {.exercise  #tagname_apwioev}
<!-- 
Ziel: 
- Verständnis Problem/chance der zufallsstichprobe
-->
TODO: Exercise body
:::

:::{.solution}
TODO: solution body
:::






<!--chapter:end:src/03-1-stichprobenziehung.Rmd-->

# Durchschnitt und Standardabweichung schätzen

```{r 4-prep_example, include=FALSE}
m <- 1000L
a <- 1
b <- 7
n1 <- 100
x1 <- runif(n1, a, b)
means1 <- map_dbl(1:m, ~ mean(runif(n1, a, b)))
sds1 <- map_dbl(1:m, ~ sd(runif(n1, a, b)))
lb1 <- round(unname(quantile(means1, 0.025)), 1)
ub1 <- round(unname(quantile(means1, 0.975)), 1)
m_means1 <- a+(b - a) / 2
s_means1 <- sqrt(((b - a) ^ 2 / 12) / n1)
lb1_t <- m_means1 - qt(0.975, n1 - 1) * s_means1
ub1_t <- m_means1 + qt(0.975, n1 - 1) * s_means1
```

Wie die in Abschnitt \@ref(stichprobenziehung-loesung) skizzierte Lösung für das Problem der zufälligen Stichprobe konkret umgesetzt wird, hängt von der Problemstellung ab. Im folgenden wird ein Verfahren zur Generalisierung der Schätzung der zentralen Tendenz 
<!-- und eines für die Schätzung der Variabilität  -->
basierend auf einer Stichprobe präsentiert.

## Wo liegt der Durchschnitt der Grundgesamtheit?

Ein Parameter über welchen wir gerne eine Aussage treffen würden ist die zentrale Tendenz in der Grundgesamtheit. [Diese wird **Erwartungswert** (Symbol $\mu$ [gr.: mü]) genannt.]{.customdef #customdef-erwartungswert} Wenn das arithmetische Mittel der Stichprobe berechnet wird, ergibt dies auch ein Schätzwert für besagten Erwartungswert. Aufgrund der zufälligen Stichprobenziehung ist jedoch auch klar, dass dieser Schätzwert nie genau dem wahren Erwartungswert entspricht. 

In Beispiel \@ref(exm:angst) liegt das arithmetische Mittel in der Stichprobe der Studierenden bei $M=`r exm_angst$x_mean`$. Dieser Wert entspricht nun auch der Schätzung des Erwartungswertes, also der geschätzten durchschnittlichen Angst aller Menschen. Die Folgefrage ist also wie genau unsere Schätzung ist. Um dies zu quantifizieren, wiederholen wir die Stichprobenziehung und berechnen das arithmetische Mittel dieser zweiten Stichprobe. Dann wiederholen wir diesen Prozess, zum Beispiel $`r exm_angst$n_samples`$ mal.

```{r exm-angst-hist-means, echo = FALSE, fig.cap = paste("Verteilung der arithmetischen Mittel von", exm_angst$n_samples, "zufällig gezogenen Stichproben der Angst.")}
tibble(x = exm_angst$x_means) %>% 
  ggplot(aes(x=x))+
  geom_histogram(binwidth = 0.5)+
  labs(y = 'Häufigkeit', x = 'Angst')
```

Die Häufigkeitsverteilung der berechneten arithmetischen Mittel in Abbildung \@ref(fig:exm-angst-hist-means) lässt nun Aussage über die Häufigkeit und damit über die Wahrscheinlichkeit von gewissen Werten als Erwartungswert zu. Ein Durchschnittswert der Zustandesangst um die 30 ist hier am wahrscheinlichsten und ein Wert tiefer als $27$ oder höher $33$ eher selten. Um diese Aussage präziser zu gestalten, werden konventionell die $95$% häufigsten Werte (die höchsten Balken im Histogramm) als wahrscheinlich betrachtet. Die $5$% verbleibenden Werte, verteilt auf das untere und obere Extrem, werden als unwahrscheinlich betrachtet. Das $2.5$% Perzentil trennt die $2.5$% tiefsten arithmetischen Mittel ab und liegt im Beispiel bei $`r  exm_angst$lb_means_emp`$. Das $97.5$%-Perzentil trennt die höchsten $2.5$% (oder eben die tiefsten $97.5$%) arthmetischen Mittel ab und liegt bei $`r exm_angst$ub_means_emp`$. Dies ist in Abbildung \@ref(fig:exm-angst-hist-means-emp-ci) ersichtlich.


```{r exm-angst-hist-means-emp-ci, fig.cap = paste0("Verteilung der arithmetischen Mittel von ",exm_angst$n_samples," zufällig gezogenen Stichproben der Angst.")}
plot_hist_means(exm_angst$x_means, exm_angst$lb_means_emp,  exm_angst$ub_means_emp, 0.5, 'Angst')
```

:::{.example #agreableness name="Verträglichkeit"}
Einer der Big-5 Persönlichkeitszüge ist die Verträglichkeit. Eine einfache Art die Big-5 zu messen ist mit den 10 Fragen aus dem ten-item personality inventory _TIPI_ [@gosling2003]. Für die Verträglichkeit müssen zwei Items (Item 1: Critical, quarrelsome; Item 2: Sympathetic, warm) auf einer Likert-Skala von 1 bis 7 eingeordnet werden. Anschliessend werden die Antworten gemittelt. Ein Student möchte herausfinden, ob mit diesem Messinstrument die durchschnittliche Verträglichkeit aller Menschen mittig also bei $4$ liegt. Dafür befragt er $n = `r n1`$ Personen und findet die Werte $M=`r round(mean(x1), 2)`, s = `r round(sd(x1),2)`$.
:::

```{r exm-agreableness-hist, fig.cap = paste("Verteilung der", n1, "beobachteten Verträglichkeitswerte einer zufällig gezogenen Stichprobe.")}
tibble(x = x1) %>% 
  ggplot(aes(x=x))+
  geom_histogram(binwidth = 0.5)+
  labs(y = 'Häufigkeit', x = 'Verträglichkeit')
```

Die Verteilung der Beobachtungen, siehe Abbildung \@ref(fig:exm-agreableness-hist), zeigt, dass alle Werte zwischen $1$ und $7$ vorkommen, aber keine zentrale Tendenz greifbar ist. Um herauszufinden wie zutreffend die Schätzung des Erwartungswertes der Verträglichkeit von $M=`r round(mean(x1), 2)`$ ist, stelle man sich wieder vor, dass der Student $`r m`$-mal die Stichprobenziehung wiederholt und jedes mal das arithmetische Mittel $M$ von neuem berechnet. Die Verteilung der arithmetischen Mittel dieser Stichproben ist in Abbildung \@ref(fig:exm-agreableness-hist-means) dargestellt. Bei dieser Verteilung kann erneut links und rechts $2.5\%$ der Werte abgeschnitten werden, um zum Schluss zu gelangen, dass das arithmetische Mittel in $95\%$ der Fälle zwischen $`r lb1`$ und $`r ub1`$ zu liegen kommt.

```{r exm-agreableness-hist-means, fig.cap = paste0("Verteilung der arithmetischen Mittel von ",m," zufällig gezogenen Stichproben der Verträglichkeit.")}
plot_hist_means(means1, lb1, ub1, 0.05, "Verträglichkeit")
```

Das Problem mit diesem Vorgehen ist, dass es aus finanziellen oder technischen Gründen selten möglich ist mehrere Stichproben aus derselben Population zu ziehen. Glücklicherweise haben Statistiker:innen herausgefunden, dass die Häufigkeitsverteilungen wie in Abbildungen \@ref(fig:exm-angst-hist-means-emp-ci) und \@ref(fig:exm-agreableness-hist-means) immer dieselbe Verteilung haben und dies unabhängig davon wie die ursprüngliche Verteilung des Merkmals aussah. [Diese Verteilung ist eine sogenannte **Normalverteilung**]{.customdef #customdef-normalverteilung}. 

Die Normalverteilung sieht eine Glocke ähnlich. Deshalb wird sie auch Gausssche Glockenkurve nach Carl F. Gauss (1777-1855) benannt. Die Normalverteilung kann mit nur zwei Parametern beschrieben werden. 

- $\mu_g$ gibt an, wo auf der x-Achse der höchste Punkt der Glocke liegt
- $\sigma_g$ gibt an, wie flach die Glockenform ist (ein grosser Wert entspricht einer flachen Glockenform, ein tiefer Wert einer steilen Glockenform).

Auf [seeing-theory.brown.edu > Continuous > Normal](https://seeing-theory.brown.edu/probability-distributions/index.html#section2) kann der Einfluss von $\mu$ und $\sigma$ auf die Normalverteilung erfahren werden. 

[Diese Tatsache, dass die Durchschnitte aller Merkmale normalverteilt sind, ist so zentral für die Statistik, dass sie **Zentraler Grenzwertsatz** genannt wurde.]{.customdef #customdef-zentraler-grenzwertsatz} Der zentrale Grenzwertsatz besagt geneauer, dass bei einem Merkmal mit Erwartungswert $\mu$ und Standardabweichung $\sigma$, der Durchschnitt aller Stichprobenwerte einer Normalverteilung mit $\mu_g = \mu$ und $\sigma_g = \frac{\sigma}{\sqrt{n}}$ entspricht, wobei $n$ die Stichprobengrösse bezeichnet.

::::{.caution data-latex=""}
:::{.remark}

- $\mu_g = \mu$ bedeutet, dass der Wert, welcher unter der normalverteilung am wahrscheinlichsten ist, genau dem Erwartungswert des untersuchten Merkmales entspricht.
- $\sigma_g = \frac{\sigma}{\sqrt{n}}$ hat zwei Implikationen:
  - je grösser die Streuung des Merkmals (grosses $\sigma$) desto breiter ist auch die Streuung der arithmetischen Mittel (grosses $\sigma_g$). Dies bedeutet, je weniger Streuung das Merkmal aufweist, desto genauer ist die Bestimmung des Erwartungswertes des Merkmales.
  - je grösser die Anzahl Beobachtungen $n$, desto kleiner die Streuung der arithmetischen Mittel (kleines $\sigma_g$). Dies bedeutet, je grösser die Stichprobe ist, desto genauer ist die Bestimmung des Erwartungswertes des Merkmales.
:::
::::

Die Abbildungen \@ref(fig:exm-angst-normal-approx) und \@ref(fig:exm-agreableness-normal-approx) illustrieren den zentralen Grenzwertsatz für Beispiel \@ref(exm:angst) und \@ref(exm:agreableness) respektive, wobei die Normalverteilung der roten Linie entspricht. Dabei wird einstweilen angenommen, dass $\mu$ und $\sigma$ bekannt sind. Diese Annahme wird später aufgelöst und dient hier lediglich der Illustration.

```{r exm-angst-normal-approx, fig.cap = paste0("Die arithmetischen Mittel sind Normalverteilt mit Parametern $\\mu_g = ",round(mean(exm_angst$x),2),"$ und $\\sigma_g = ",round(sd(exm_angst$x),2)," / \\sqrt{",exm_angst$n,"}$.")}
plot_hist_denstiy_expected_value(exm_angst$x_means, exm_angst$x_mean, exm_angst$x_sd, exm_angst$n, "Angst", 0.5)
```

```{r exm-agreableness-normal-approx, fig.cap = paste0("Die arithmetischen Mittel sind Normalverteilt mit Parametern $\\mu_g = ",round(mean(x1),2),"$ und $\\sigma_g = ",round(sd(x1),2)," / \\sqrt{",n1,"}$.")}
plot_hist_denstiy_expected_value(means1, 4, sqrt((b - a) ^ 2 / 12), n1, "Verträglichkeit", 0.05)
```

Die Erkenntnis des zentralen Grenzwertsatz macht also das wiederholte ziehen von Stichproben unnötig. Die Normalverteilung ist theoretisch konstruiert und ihr $2.5\%$- und $97.5\%$-Perzentil können theoretisch hergeleitet werden. Tabelle \@ref(tab:quantiles-norm) wird kann beobachtet werden, dass für unsere zwei Beispiele die Perzentile der Stichprobe und der Normalverteilung sehr ähnlich, wenn auch nicht exakt gleich sind. Die Ungenauigkeit rührt daher, dass der zentrale Grenzwertsatz nur dann exakt funktioniert, wenn die Anzahl Beobachtungen (unendlich) gross ist.


```{r quantiles-norm}
(tibble(
  Beispiel = c("Angst", "Vertraeglichkeit"),
  "2.5%-Perzentil (sample)" = c(exm_angst$lb_means_emp, lb1),
  "97.5%-Perzentil  (sample)" = c(exm_angst$ub_means_emp, ub1),
  "2.5%-Perzentil norm" = c(qnorm(0.025, exm_angst$m_means, exm_angst$s_means), 
                            qnorm(0.025, m_means1, s_means1)),
  "97.5%-Perzentil norm" = c(qnorm(0.975, exm_angst$m_means, exm_angst$s_means), 
                               qnorm(0.975, m_means1, s_means1)),
  "2.5%-Perzentil t" = c(exm_angst$lb_means_t, lb1_t),
  "97.5%-Perzentil t" = c(exm_angst$ub_means_t, ub1_t)
) %>%
  kableExtra::kbl(
    booktabs = TRUE,
    col.names = c("Beispiel","2.5%", "97.5%", "2.5%", "97.5%", "2.5%", "97.5%"),
    digits = 2,
    align = c("c", "r", "r", "r", "r"),
    caption = "Vergleich Perzentile der Stichprobe und der theoretischen Verteilung."
  )) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE
  ) %>% 
  add_header_above(c(" " = 1, 
                     "Stichprobe" = 2, 
                     "Normalverteilung" = 2, 
                     "t-Verteilung" = 2))

```


Einstweilen wurde hier angenommen, dass die Streuung des Merkmals $\sigma$ bekannt ist. Dies ist in der Realität nie der Fall und eine weitere, wenn auch weniger grosse Ungenauigkeitsquelle. [Wenn $\sigma$ also auch aus der Stichprobe geschätzt werden muss, ist die Ännäherung der Verteilung der arithmetischen Mittel besser gegeben mit einer **Student-$t$-Verteilung** oder kurz $t$-Verteilung.]{.customdef #customdef-student-verteilung} Die grüne gestrichtelte Linie in den Abbildungen \@ref(fig:exm-angst-normal-approx) und \@ref(fig:exm-agreableness-normal-approx) entspricht der $t$-Verteilung im jeweiligen Beispiel. 

Der Unterschied zwischen der Normalverteilung und der $t$-Verteilung ist nur sichtbar, wenn $n$ klein ist. In Beispiel \@ref(exm:angst) mit $n = `r exm_angst$n`$ ist ein kleiner Unterschied, in Beispiel \@ref(exm:agreableness) mit $n = `r n1`$ ist kein Unterschied zwischen der Normalverteilung und der $t$-Verteilung sichtbar. [Tatsächlich wird die $t$-Verteilung mit einem Parameter charaktisiert, welcher __Freiheitsgrade__ (eng. degrees of freedom, $df$) genannt wird.]{.customdef #customdef-freiheitsgrade} In Abbildung \@ref(fig:t-distribution) wird die $t$-Verteilung mit verschiedenen Freiheitsgraden mit der Normalverteilung verglichen. Bei der $t$-Verteilung mit den kleinsten Freiheitsgraden sind extremere Werte wahrscheinlicher als $t$-Verteilungen mit grösseren Freiheitsgraden. 

```{r t-distribution, fig.cap="Student-t-Verteilungen mit 1, 4 und 9 Freiheitsgraden im Vergleich zu der Normalverteilung."}
tibble(x = seq(-4, 4, by = 0.1),
       Normalverteilung = dnorm(x),
       t_1 = dt(x, 2-1),
       t_4 = dt(x, 5-1),
       t_9 = dt(x, 10-1)) %>%
  pivot_longer(cols = 2:5, names_to = "Verteilung", values_to="Wahrscheinlichkeitsdichte") %>% 
  ggplot(aes(x=x))+
  geom_line(aes(y=Wahrscheinlichkeitsdichte, color = Verteilung))+
  labs(x="")
```

Die Freiheitsgrade der $t$-Verteilung in der Annäherung oben entsprechen der Anzahl Beobachtungen minus 1, also $df = n-1$. Die höhere Wahrscheinlichkeit von extremeren Werten bei kleinen Freiheitsgraden spiegelt die grössere Unsicherheit der Schätzung des Erwartungswertes wieder, wenn die Standardabweichung unbekannt und damit auch geschätzt werden muss. Je kleiner $n$ ist, desto stärker fällt diese Unsicherheit aus.

Die arithmetischen Mittel bei unbekannter Standardabweichung sind bei wiederholter Stichprobenziehung genau $t$-verteilt. Um die Genauigkeit der Schätzung des Erwartungswertes zu bestimmen genügt es folglich, das 2.5% und das 97.5% Perzentil der $t$-Verteilung mit $n-1$ Freiheitsgraden zu bestimmen. Diese Perzentile können mit 

$$ \bar{x} - \frac{s}{\sqrt{n}} \cdot t_{97.5\%, n-1} < \mu < \bar{x} + \frac{s}{\sqrt{n}} \cdot t_{97.5\%, n-1}$$

berechnet werden, wobei $\bar{x}$ das arithmetische Mittel, $s$ die Standardabweichung und $t_{97.5\%, n-1}$ dem Wert des 97.5%-Perzentil einer auf 0 zentrierten $t$-Verteilung mit $n-1$ Freiheitsgraden entspricht. Letzere Perzentile der $t$-Verteilung können bei Bedarf in entsprechenden Tabellen nachgeschlagen werden. Als Gedankenstütze kann für $t_{97.5\%, n-1}$ immer $2$ gedacht werden, da dies ungefähr dem wahren Wert entspricht, wenn $n$ grösser als $50$ ist.

Das $2.5\%$ und das $97.5\%$ Perzentil der Verteilung der arithmetischen Mittel ergeben nun die untere respektive obere Schranke eines [**Intervalles**. Ein Intervall bezeichnet durch die Symbolik $[$untere Schranke, obere Schranke$]$ beinhaltet alle Zahlen zwischen der unteren und der oberen Schranke.]{.customdef #customdef-interval} [Ein Intervall mit den oben beschriebenen Perzentilen als Schranken wurde so berechnet, dass bei wiederhohlter Stichprobenziehung der wahre Erwarungswert in $95\%$ der Fälle umschlossen wird. Grob übersetzt bedeutet dies, dass wir zu $95\%$ sicher oder _konfident_ sind, dass der Erwarungswert in diesem Intervall liegt. Dieses Intervall wird deshalb als $95\%$-**Konfidenzintervall** (symbol KI) bezeichnet.]{.customdef #customdef-confidence-interval}

In Beispiel \@ref(exm:angst), kann aus der Tabelle \@ref(tab:quantiles-norm) entnommen werden, dass die Angst in der Population bei $M = `r round(mean(exm_angst$x),2)`$ $95\%$ KI $[`r round(exm_angst$lb_means_t,2)`,`r round(exm_angst$ub_means_t,2)`]$ liegt. In Beispiel \@ref(exm:agreableness), kann aus der Tabelle \@ref(tab:quantiles-norm) entnommen werden, dass die Verträglichkeit in der Population bei $M = `r round(mean(x1), 2)`$ $95\%$ KI $[`r round(lb1_t,2)`,`r round(ub1_t,2)`]$ liegt. Wann immer eine Schätzung eines zentralen Wertes berichtet wird, soll dies ab jetzt in der soeben gezeigten Darstellung inklusive Angabe des Konfidenzintervalls erfolgen. Damit wird der Leserin aufgezeigt, wo der Schätzwert der zentralen Tendenz liegt und gleichzeigtig wird intuitiv vermittelt wie genau die Schätzung ist.

Es ist nun spannend zu explorieren, wie sich die Stichprobengrösse $n$ oder die geschätzte Standardabweichung $s$ auf die Länge des Konfidenzintervalls auswirkt. Dies kann in den Übungen \@ref(exr:ki-mean-n-vary) und \@ref(exr:ki-mean-s-vary) selbst erforscht werden.

<!-- ## Wo liegt die Standardabweichung? -->


<!-- This is probably wrong. Skip the chapter? -->
<!-- ```{r} -->

<!-- x_range <- seq(min(sds^2), max(sds^2), by = 0.1) -->
<!-- chisq_curve = tibble( -->
<!--   x = x_range, -->
<!--   y = dchisq(x/((ex_angst_sd^2)/(n-1)), n - 1) * (m) -->
<!-- ) -->

<!-- tibble(x = sds^2) %>% -->
<!--   ggplot(aes(x = x))+ -->
<!--   geom_histogram(binwidth = 2) + -->
<!--   geom_line( -->
<!--       data = chisq_curve, -->
<!--       aes(x = x, y = y), -->
<!--       colour = "#f12489", -->
<!--       linewidth = 1 -->
<!--     ) -->
<!-- ``` -->

<!-- ```{r} -->
<!-- x_range <- seq(min(sds1^2), max(sds1^2), by = 0.05) -->
<!-- ex_agreableness_sd <- sqrt((b-a)^2 / 12) -->

<!-- chisq_curve = tibble( -->
<!--   x = x_range, -->
<!--   y = dchisq(x * (n1-1) / (ex_agreableness_sd^2), n1 - 1) * (n1-1) / (ex_agreableness_sd^2) -->
<!-- ) -->

<!-- tibble(x = sds1^2) %>% -->
<!--   ggplot(aes(x = x))+ -->
<!--   geom_histogram(binwidth = bw, aes(y = after_stat(density))) + -->
<!--   geom_line( -->
<!--       data = chisq_curve, -->
<!--       aes(x = x, y = y), -->
<!--       colour = "#f12489", -->
<!--       linewidth = 1 -->
<!--     ) -->
<!-- ``` -->

## Übungen

::: {.exercise #interpret-report1}
<!-- 
Ziel: 
- 
-->
```{r exr-interpret-report1}
print('hi')
```

:::

:::{.solution}
TODO
:::

::: {.exercise #interpret-report2}
<!-- 
Ziel: 
- 
-->
```{r exr-interpret-report2}
print('hi')
```

:::

:::{.solution}
TODO
:::


::: {.exercise #ki-approx-normal}
<!-- 
Ziel: 
- 
-->

```{r ki-approx-normal}
gen_exr_ki_approx_normal <- function(n){
  seed <- 1928
  set.seed(1928)
  m <- 10000
  lambda <- 7
  x <- rpois(n, lambda)
  x_samples <- map(1:m, ~ rpois(n, lambda))
  means <- x_samples %>% map_dbl(mean)
  sds <- x_samples %>% map_dbl(sd)
  lb <- unname(quantile(means, 0.025))
  ub <- unname(quantile(means, 0.975))
  m_means <- mean(x)
  s_means <- sqrt(sd(x) / n)
  lb_t <- lambda - qt(0.975, n - 1) * s_means
  ub_t <- lambda + qt(0.975, n - 1) * s_means
  return(mget(ls()))
}

ns <- c(10, 40, 100)
list_experiments <- map(ns, ~ gen_exr_ki_approx_normal(.x))
tibble(!!!setNames(
    map(list_experiments,~c(.x$means)),
    paste0("n_", ns)
)) %>%
    haven::write_sav('data/04-exr-zentraler-grenzwertsatz.sav')
```

Für ein Experiment werden in drei Runden jeweils $`r list_experiments[[1]]$m`$ Zufallsstichproben erhoben mit respektive $10$, $40$ und $100$ Beobachtungen pro Zufallsstichprobe. Die Verteilung der jeweils ersten Zufallsstichprobe für eine Stichprobengrösse ist in Abbildung \@ref(fig:ki-approx-normal1) dargestellt. Die Daten sind nicht normalverteilt, weil keine Glockenkurve wie oben beschrieben das Histogramm gut abdecken würde.

```{r ki-approx-normal1, fig.cap="TODO."}
map_dfr(c(1:3),
        ~tibble(x = list_experiments[[.x]]$x_samples[[1]],
       n = list_experiments[[.x]]$n)) %>% 
  ggplot() +
  geom_histogram(aes(x=x), binwidth = 1)+
  facet_wrap(~n,labeller = label_both)+
  labs(x="Wert", y = 'Häufigkeit')
```

Die arithmetischen Mittel der 10'000 Stichproben sind im Datensatz `04-exr-zentraler-grenzwertsatz.sav` festgehalten. In der Spalte `n_10` zum Beispiel steht jede Zeile für das arithmetische Mittel eine Zufallstichprobe mit 10 Beobachtungen. Der zentrale Grenzwertsatz besagt, dass diese arithmetischen Mittel normalverteilt sind mit zunehmender Stichprobengrösse $n$. Erstellen Sie ein Histogramm mit der Erweiterung `JJStatsPlot` und zeichnen Sie eine Normalverteilung darüber. Interpretieren Sie das Resultat.

:::

:::{.solution}

Die Übereinanderlegung des jeweiligen Histograms und der Wahrscheinlichkeitsdichte der Normalverteilung wird in Abbildung \@ref(fig:sol-ki-approx-normal) gezeigt. Es ist deutlich zu sehen, dass die Linie nur bei $n=100$ die Häufigkeitsverteilung der arithmetischen Mittel gut nachbilden kann. Bei $n=10$ und $n=50$ ist ein grosser Unterschied zwischen Häufigkeitsverteilung und Linie sichtbar. Das genaue $n$ ab welchem eine Häufigkeitsverteilung gut durch die Normalverteilung angenähert wird hängt von der ursprünglichen Verteilung der Daten ab, d.h. der Verteilung in Abbildung \@ref(fig:ki-approx-normal1). Es kann deshalb nicht generell gesagt werden, dass ab $n=100$ die Annäherung immer gut sei, so wie in diesem Beispiel. Der zentrale Grenzwertsatz besagt demnach auch lediglich, dass man immer ein grosses $n$ wählen kann, so dass die Annäherung gut ist. Er besagt nichts darüber, wie gross $n$ sein muss.

```{r sol-ki-approx-normal, fig.cap="TODO", fig.show="hold", out.width="50%"}
knitr::include_graphics("figures/04-exr-ki-approx-normal-jmv-input.jpg")
knitr::include_graphics("figures/04-exr-ki-approx-normal-jmv-output1.jpg")
knitr::include_graphics("figures/04-exr-ki-approx-normal-jmv-output2.jpg")
knitr::include_graphics("figures/04-exr-ki-approx-normal-jmv-output3.jpg")
```

:::

::: {.exercise #ki-mean-n-vary}
<!-- 
Ziel: 
- 
-->

```{r exr-ki-mean-n-vary}
gen_exr_ki_mean_n_vary <- function(){
  seed <- 1029
  set.seed(seed)
  sample_sizes <- c(5, 20, 50, 100, 1000)
  samples <- sample_sizes %>%
    map(~rexp(.x,4))
  ki_table <- tibble(x = samples,
         n = sample_sizes) %>%
    mutate(
      means = x %>% map_dbl(mean),
           sds = x %>% map_dbl(sd),
           lb = means - qt(0.975, n-1) * sds / sqrt(n),
           ub = means + qt(0.975, n-1) * sds / sqrt(n),
           il = ub - lb)
  tibble(!!!setNames(
      map(ki_table$x, ~c(.x, rep(NA, 1000 - length(.x)))),
      paste0("col_", seq_along(ki_table$x))
  )) %>%
    haven::write_sav('data/04-exr-stichprobengroesse.sav')
  return(mget(ls()))
}

exr_ki_mean_n_vary <- gen_exr_ki_mean_n_vary()
```

Eine Mensa will herausfinden, wie lange die Leute um 12h durchschnittlich anstehen müssen. Dazu befragt sie `r exr_ki_mean_n_vary$ki_table$n[1]` Kund:innen. Das Resultat der Untersuchung ist, dass die Kund:innen im Durchschnitt $0.4$ Stunden anstehen müssen. Leider ist das Konfidenzintervall sehr gross. Da die Mensa nicht weiss, wie viele Leute befragt werden müssen, um ein kleineres Konfidenzintervall zu erhalten befragt sie in 4 weiteren Runden jeweils `r knitr::combine_words(exr_ki_mean_n_vary$ki_table$n[-c(1)], and = " und ", oxford_comma = FALSE)` Kund:innen. Die Daten aller 5 Untersuchungen sind unter `04-exr-stichprobengroesse.sav` abgelegt. Für jede der 5 Stichproben:

  a. Was ist die Schätzung des Erwartungswertes der Wartezeit?
  b. Wie gross ist die Standardabweichung der Wartezeit?
  c. Wie gross ist die Standardabweichung der arithmetischen Mittel?
  d. Bestimmen Sie die 95%-Konfidenzintervalle.
  e. Berechnen Sie die Länge jedes Konfidenzintervalls.

Vergleichen Sie die Resultate der Berechnungen für jede Stichprobe:

  f. Weshalb ist die Schätzung für den Erwartungswert für jede Stichprobe unterschiedlich?
  g. Was lässt sich über den Zusammenhang zwischen Stichprobengrösse und der Länge des Konfidenzintervalls sagen?

:::

:::{.solution}

Abbildung \@ref(fig:sol-ki-mean-n-vary) zeigt die Berechnunganweisungen für Jamovi und die resultierende Tabelle daraus.

```{r sol-ki-mean-n-vary, fig.cap="Links: Jamovi-Anleitung zur Erstellung der Tabelle mit den relevanten Kenngrössen; rechts: Tabelle mit relevanten Kenngrössen.", fig.show="hold", out.width="50%"}
  knitr::include_graphics("figures/04-exr-stichprobengroesse-jmv-input.jpg")
  knitr::include_graphics("figures/04-exr-stichprobengroesse-jmv-output.jpg")
```

  a. Der Erwartungswert der Wartezeiten (das heisst der Populationmittelwerte der Wartezeiten) wird mit dem arithmetischen Mittel der Stichprobe geschätzt und kann in der Tabelle bei `Mittelwert` abgelesen werden. Der Erwartungswert der Wartezeiten beträgt bei allen Stichproben ausser bei der ersten ungefähr 0.22 Stunden, also ein bisschen weniger als eine Viertelstunde.
  b. Der Standardabweichung der Wartezeiten der Stichprobe sind in der Tabelle bei `Std.-abw.` abzulesen. Die Standardabweichungen sind für alle Stichproben ausser der ersten ungefähr bei 0.23.
  c. Die Standardabweichung der arithmetischen Mittel liegt bei $s/\sqrt{n}$. Für die erste Stichprobe ist dies $0.157 / \sqrt{5} = `r 0.157/sqrt(5)`$. Diese Werte werden auch als Standardfehler bezeichnet und sind in der Tabelle bei `Std.-fehler` ablesbar.
  d. Die untere und obere Schranke der 95%-Konfidenzintervalle sind bei `Untere` und `Obere` respektive abzulesen.  
  e. Die Länge des Konfidenzintervalls entspricht jeweils dem höheren Wert minus dem tieferen Wert. Für die erste Stichprobe ist dies 0.597 - 0.208 = `r (0.597 - 0.208)`, für die anderen `r knitr::combine_words(map_dbl(exr_ki_mean_n_vary$ki_table$il[-c(1)], ~ round(.x, 2)), and = " und ", oxford_comma = FALSE)`.
  f. Die Schätzung des Erwartungswertes ist das arithmetische Mittel der Stichprobe. Da jedesmal eine neue Zufallsstichprobe gezogen wurde und diese nicht dieselben Beobachtungen enthalten, ergeben sich auch jedesmal andere Stichprobenmittelewerte.
  g. Je grösser $n$, desto kleiner ist das Konfidenzintervall. Wenn man also ein kleines Konfidenzintervall erreichen will, braucht man eine grössere Stichprobe.
:::



::: {.exercise #ki-mean-s-vary}
<!-- 
Ziel: 
- 
-->
```{r exr-ki-mean-s-vary}
print('hi')
```

:::

:::{.solution}
TODO
:::



<!--chapter:end:src/04-1-durchschnitt_und_standardabweichung_schaetzen.Rmd-->

# Zentrale Tendenz testen {#zentrale-tendenz-testen}

Eine andere Fragestellung, die mit Daten oft beantwortet wird ist, ob eine gewisse Aussage wahr ist oder falsch. [Eine solche Aussage wird **Hypothese** (Symbol: $H$) genannt.]{.customdef #customdef-hypothese} Eine Hypothese könnte zum Beispiel sein: 

> $H:$ Es regnet. 

Ist die Hypothese einmal gefunden, können Daten gesammelt werden, um diese Hypothese zu bestätigen oder zu falsifizieren. Man geht nach draussen und spürt Regen auf der Haut bedeutet $H$ ist wahr, spürt man keinen Regen, so ist $H$ falsch.

Wenn eine Hypothese wahr ist, dann ist das Gegenteil der Hypothese falsch. Weil oft über die Hypothese und ihr Gegenteil debattiert wird, ist es nützlich die beiden auch terminologisch auseinanderhalten zu können. [Die Hypothese, welche den bisherigen Informationsstand reflektiert wird **Nullhypothese** (Symbol $H_0$) genannt.]{.customdef #customdef-nullhypothese} War es draussen bei der letzten Messung vor einer Stunde schönes Wetter, dann ist die Nullhypothese

> $H_0:$ Es regnet nicht. 

[Das Gegenteil der Nullhypothese wird **Alternativhypothese** (Symbol $H_1$) genannt.]{.customdef #customdef-alternativhypothese} Im Beispiel ist die Alternativhypothese 

> $H_1:$ Es regnet.

## Entspricht der Erwartungswert einem gewissen Wert?

Um eine Hypothese mit Daten überprüfbar zu machen, muss diese in eine Form gebracht werden, welche Daten einbezieht. Eine einfache Form einer solchen überprüfbaren Hypothese ist 

> $H:$ Das durchschnittliche Vermögen einer in der Schweiz lebenden Person beträgt $100'000$ CHF. 

Wenn die Population alle in der Schweiz lebenden Personen sind, dann entspricht dies also der Nullhypothese

> $H_0:\mu = 100'000$. 

Abstrahiert, soll bei dieser Problemstellung herausgefunden werden, ob der Erwartungswert einer Population einem gewissen Wert entspricht. Das Gegenteil dieser Nullhypothese ist die Alternativhypothese 

> $H_1: \mu \neq 100'000$. 

Dies bedeutet, dass das Vermögen der Population nicht bei $100'000$ CHF liegt. [Weil die Alternativhypothese hier zwei Ausgänge zulässt, nämlich kleiner oder grösser als $100'000$ CHF wird diese Art **zweiseitige Hypothese** bezeichnet.]{.customdef #customdef-zweiseitige-hypothese}

Eine weitere Form der Hypothese wäre 

> $H:$ Das durchschnittliche Vermögen einer in der Schweiz lebenden Person beträgt weniger als oder genau $100'000$ CHF. 

In Formelsprache übersetzt entspricht dies 

> $H_0: \mu \leq 100'000$. 

Das Gegenteil davon ist, wenn das durchschnittliche Vermögen grösser und ungleich 100'000 CHF ist, also 

> $H_1: \mu > 100'000$. 

::::{.caution data-latex=""}
::: {.remark}
Die verwendeten Zeichen in den Formeln sind

- $=$: Gleichheit, sprich "gleich". Beispiele: 
    - $3 = 3$ ($3$ gleich $3$) ist eine wahre Aussage. 
    - $3 = 4$ ($3$ gleich $4$) ist eine falsche Aussage.
- $\neq$: Ungleichheit, sprich "ungleich" oder "nicht gleich". Beispiele: 
    - $3 \neq 3$ ($3$ ist nicht gleich $3$) ist eine falsche Aussage. 
    - $3 \neq 4$ ($3$ ist nicht gleich $4$) ist eine wahre Aussage.
- $<$: Kleiner, sprich "kleiner". Beispiele: 
    - $4 < 3$ ($4$ ist kleiner als $3$) ist eine falsche Aussage. 
    - $3 < 3$ ($3$ ist kleiner als $3$) ist eine falsche Aussage. 
    - $3 < 4$ ($3$ ist kleiner als $4$) ist eine wahre Aussage.
- $\leq$: Kleiner gleich, sprich "kleiner gleich". Beispiele: 
    - $4 \leq 3$ ($4$ ist kleiner oder gleich wie $3$) ist eine falsche Aussage.
    - $3 \leq 3$ ($3$ ist kleiner oder gleich wie $3$) ist eine wahre Aussage. 
    - $3 \leq 4$ ($3$ ist kleiner oder gleich wie $4$) ist eine wahre Aussage.
- $>$: Grösser, sprich "grösser". Beispiele: 
    - $4 > 3$ ($4$ ist grösser als $3$) ist eine wahre Aussage. 
    - $3 > 3$ ($3$ ist grösser als $3$) ist eine falsche Aussage. 
    - $3 > 4$ ($3$ ist grösser als $4$) ist eine falsche Aussage.
- $\geq$: Grösser gleich, sprich "grösser gleich". Beispiele: 
    - $4 \geq 3$ ($4$ ist grösser oder gleich wie $3$) ist eine wahre Aussage. 
    - $3 \geq 3$ ($3$ ist grösser oder gleich wie $3$) ist eine wahre Aussage. 
    - $3 \geq 4$ ($3$ ist grösser oder gleich wie $4$) ist eine falsche Aussage.
    
:::
::::


:::{.example #vermoegen name="Vermögen"}

```{r exm-vermoegen}
gen_exm_vermoegen <- function(){
  # x ~ chisq(df)
  # a * x ~ a chisq(df)
  # E(a*x) ~ a E(chisq(df)) = a df
  # Var(a*x) ~ a^2 Var(x) = a^2 2k / n
  df <- 3L
  mu0 <- 100000
  scale_factor <- mu0/df
  
  n <- 20L
  set.seed(61)
  x <- scale_factor * rchisq(n, df)
  scores_hover <- x / 1000 # hovering with K CHF in scale
  x_mean <- x %>% mean()
  x_sd <- x %>% sd()
  t_emp <- (x_mean - mu0)/(x_sd/sqrt(n))
  p_value_the <- 1-pt((x_mean - 100000)/ (x_sd / sqrt(n)), n-1)
  effect_size <- (x_mean - mu0) / x_sd

  
  file_name <- '05-exm-vermoegen.sav'
  tibble(vermoegen = x) %>% write_sav(file_name)
  
  # distribution if H_0 were true
  n_samples <- 3000L
  x_means <- 1:n_samples %>% 
    map_dbl(~ mean(scale_factor*rchisq(n, df)))
  q95_x_means <- x_means %>% quantile(c(0.95)) %>% unlist() %>% unname()
  p_value_emp <- mean(x_means > x_mean)
  
  # plot sampling bag
  n_bag <- 200L
  scores_bag <- list(40*rchisq(n_bag,df),
                   60*rchisq(n_bag,df))
  plots <- list()
  for (i in 1:length(scores_bag)) {
    plots[[i]] <- plot_ball_bag(
      scores_bag = scores_bag[[i]],
      scores_hover = scores_hover,
      score_name = "1000 CHF",
      seed = 123+i,
      no_legend = c(TRUE, FALSE)[i],
      limit_scores = c(0, 800)
    )
  }
  
  # plot histogram of sample means
  plot_hist_density <- plot_hist_denstiy_expected_value(
    x_means, 
    scale_factor*df, 
    sqrt((scale_factor)^2*2*df), 
    n,
    "Vermögen CHF",
    5000)
  
  line_xlim <- xlim(c(40000, 180000))
  sigma_g <- x_sd / sqrt(n)
  x_range <- seq(mu0-3*sigma_g, mu0+3*sigma_g, length.out = 1000)
  
  # Function to create text data
  create_text_data <- function(labels, y_value, plot_type) {
    tibble(
      label = labels,
      x = c(60000, 160000),
      y = rep(y_value, 2),
      color = c("red", "green"),
      plot_type = plot_type
    )
  }
  
  
  add_colors <- function(x, type){
    x %>% 
      mutate(
      color = case_when(
        plot_type == type %>% str_c(" p-Wert") & x > x_mean ~ "green",
        plot_type == type %>% str_c(" p-Wert") & x <= x_mean ~ "red",
        plot_type == type %>% str_c(" Ablehnungsbereich") & x > q95_x_means ~ "green",
        plot_type == type %>% str_c(" Ablehnungsbereich") & x <= q95_x_means ~ "red"
      )
    )
  }
  # Create data for histograms
  histogram_data <- tibble(
    x = rep(x_means, 2),
    plot_type = rep(c("Histogram p-Wert", 
                      "Histogram Ablehnungsbereich"), 
                    each = length(x_means))
  ) %>%
    add_colors("Histogram")
  
  # Create data for density plots
  density_data <- tibble(
    x = rep(x_range, 2),
    y = dt((x - mu0) / sigma_g, n - 1) / sigma_g,
    plot_type = rep(c("Verteilung p-Wert", 
                      "Verteilung Ablehnungsbereich"), 
                    each = length(x_range))
  ) %>%
    add_colors("Verteilung")
  
  # Create text data for all plots
  text_pval <- str_c(round(100 * c(1 - p_value_emp, p_value_emp), 1), '%')
  text_sign <- c('95%', '5%')
  text_data_all <- bind_rows(
    create_text_data(
      text_pval,
      200,
      "Histogram p-Wert"
    ),
    create_text_data(
      text_sign, 
      200,
      "Histogram Ablehnungsbereich"
    ),
    create_text_data(
      round(100 *c(1-p_value_the,p_value_the),1) %>% 
        str_c('%'),
      0.000015, 
      "Verteilung p-Wert"
    ),
    create_text_data(
      text_sign, 
      0.000015,
      "Verteilung Ablehnungsbereich"
    )
  )
  
  custom_labeller <- as_labeller(c(
    "Histogram p-Wert" = "p-Wert",
    "Histogram Ablehnungsbereich" = "Ablehnungsbereich",
    "Verteilung p-Wert" = "p-Wert",
    "Verteilung Ablehnungsbereich" = "Ablehnungsbereich"
  ))
  
  plot_hist_curve_pval_reja <- ggplot() +
    geom_histogram(data = histogram_data,
                   aes(x = x, fill = color),
                   binwidth = 4300) +
    geom_line(data = density_data,
              aes(x = x, y = y, colour = color)) +
    geom_area(data = density_data,
              aes(x = x, y = y, fill = color)) +
    geom_vline(xintercept = x_mean) +
    geom_text(data = text_data_all,
              mapping = aes(x = x, y = y, label = label, colour = color)) +
    facet_wrap(~ plot_type, nrow = 2, scales = "free_y", 
               strip.position = "top",
               labeller = custom_labeller) +
    line_xlim +
    theme(
      axis.text.y = element_text(),
      axis.ticks.y = element_line(),
      axis.title.y = element_text(),
      strip.placement = "outside",
      legend.position = "none"
    ) +
    labs(x = "Vermögen", y = "W.-dichte                              Häufigkeit")

  return(mget(ls()))
}
exm_vermoegen <- gen_exm_vermoegen()
```

<!-- ```{r} -->
<!-- 1-pnorm(mean(exm_vermoegen$x), 100000, sd(exm_vermoegen$x_means)) -->
<!-- 1-pnorm(mean(exm_vermoegen$x), 100000, sd(exm_vermoegen$x) / sqrt(exm_vermoegen$n)) -->

<!-- 1-pt((mean(exm_vermoegen$x) - 100000)/ sd(exm_vermoegen$x_means), exm_vermoegen$n-1) -->
<!-- 1-pt((mean(exm_vermoegen$x) - 100000)/ (sd(exm_vermoegen$x) / sqrt(exm_vermoegen$n)), exm_vermoegen$n-1) -->
<!-- ``` -->

Eine Sozialpolitikberatungsfirma will herausfinden, ob das durchschnittliche Vermögen der in der Schweiz lebenden Personen im letzten Jahr gestiegen ist. Sie stellen dazu basierend auf dem aktuellen Wissensstand die Nullhypothese auf, dass das durchschnittliche Vermögen nicht gestiegen ist, und die Alternativhypothese, dass das durchschnittliche Vermögen gestiegen ist:

> $H_0: \mu \leq 100'000$ CHF

> $H_1: \mu > 100'000$ CHF

Um die Hypothesen auf einer Datengrundlage zu evaluieren, erfragt es das Vermögen von $n=`r exm_vermoegen$n`$ zufällig ausgewählten Personen und findet ein durchschnittliches Vermögen von $M=`r round(mean(exm_vermoegen$x))`$ CHF.

:::

Es kann nun schnell gesagt werden, dass das durchschnittliche Vermögen in der Population gestiegen ist, weil $193'000$ CHF grösser ist als $100'000$ CHF. Dies so zu behaupten wäre jedoch falsch, weil nicht alle Personen in der Population befragt wurden, sondern lediglich eine Zufallsstichprobe. Wie in Kapitel \@ref(stichprobenziehung) muss hier für eine Generalisierung der Stichprobe auf die Population der Effekt der zufälligen Stichprobenziehung miteinbezogen werden. 

Aufgrund der Zufallsstichprobe ist es unmöglich zu sagen, ob unsere Stichprobe eine eher seltene Stichprobenziehung aus einer Population mit unverändertem durchschnittlichen Vermögen von $100'000$ CHF ist (Abbildung \@ref(fig:exm-vermoegen-sampling-plot) links) oder ob es eine eher häufig vorkommende Stichprobenziehung aus einer Population mit höherem durchschnittlichen Vermögen ist (Abbildung \@ref(fig:exm-vermoegen-sampling-plot) rechts). 

```{r exm-vermoegen-sampling-plot, fig.cap="Vorgestellte Zufallsstichprobenziehung. Links: Nullhypothese ist wahr. Rechts: Nullhypothese ist falsch.", echo = FALSE}
do.call(grid.arrange, c(exm_vermoegen$plots, ncol = 2))
```

Es kann jedoch ausgesagt werden, mit welcher Wahrscheinlichkeit der gefundene Stichprobenmittelwert realisiert wird, gegeben dass die Nullhypothese wahr ist. Hier wird also angenommen, dass eine Population mit Erwartungswert $\mu = 100'000$ CHF vorliegt und dass anschliessend zum Beispiel $`r exm_vermoegen$n_samples`$ Stichproben an je $`r exm_vermoegen$n`$ Beobachtungen pro Stichprobe gezogen werden. Von jeder dieser Stichproben wird das arithmetische Mittel berechnet. In der Verteilung dieser Mittelwerte, siehe Abbildung \@ref(fig:exm-vermoegen-histogram-plot), wird nun der tatsächliche Mittelwert der Stichprobe $\bar{x} = `r round(exm_vermoegen$x %>% mean())`$ verortet. 

```{r exm-vermoegen-histogram-plot, fig.cap="TODO.", echo = FALSE}
exm_vermoegen$plot_hist_density + 
  geom_vline(xintercept = exm_vermoegen$x %>% mean())+
  scale_x_continuous(n.breaks = 10)
```

Der beobachtete Mittelwert ist zwar nicht genau bei $100'000$ CHF, aber trotzdem noch einigermassen plausibel, wenn die Nullhypothese stimmt. Um diesen Gedanken zu formalisieren, gibt es zwei Denkweisen, welche nun vorgestellt werden.

Die eine von Ronald Fisher Denkweise ist die Frage nach der Wahrscheinlichkeit, dass der beobachtete Wert oder ein noch extremerer Wert in Richtung der Alternativhypothese resultiert. Im Beispiel entspricht dies der Wahrscheinlichkeit den Wert $`r round(exm_vermoegen$x %>% mean())`$ oder einen grösseren Wert zu beobachten, wenn der Erwartungswert tatsächlich bei $100'000$ CHF liegt. Um diese Wahrscheinlichkeit zu bestimmen, kann einfach gezählt werden, welcher Anteil der Stichprobenmittel werte grösser oder gleich $`r round(exm_vermoegen$x %>% mean())`$ CHF ist. Im Beispiel sind dies $`r round(exm_vermoegen$p_value_emp,3)` = `r round(exm_vermoegen$p_value_emp*100,1)`\%$. [Dieser Wert wird, abgeleitet vom englischen _probability_ auch __p-Wert__ (Symbol: $p$) genannt. Beim Berichten des p-Werts wird normalerweise die führende $0$ nicht geschrieben, also $p = `r round(exm_vermoegen$p_value_emp,3) %>% str_sub(2)`$.]{.customdef #customdef-pwert} 

[Bei der anderen Denkweise muss noch vor der Datenerhebung ein sogenanntes **Signifikanzniveau** (Symbol $\alpha$, sprich 'alpha')  bestimmt werden. Dieser Wert entspricht der Wahrscheinlichkeit, dass der statistische Test die Nullhypothese verwirft, obwohl diese wahr gewesen wäre. Normalerweise wird $\alpha = 5\%$ gesetzt.]{.customdef #customdef-signifikanzniveau} Es wird also akzeptiert, dass ein statistischer Test in $5\%$ der Fälle gegen die Nullhypothese entscheidet, obwohl diese wahr wäre. [In einem zweiten Schritt wird bestimmt, welches die $5\%$ unwahrscheinlichsten Werte sind, wenn die Nullhypothese wahr ist. Diese Werte werden **Ablehnungsbereich** genannt.]{.customdef #customdef-ablehnungsbereich} Im Beispiel sind dies die $5\%$ höchsten Werte, nämlich Vermögen von $`r round(exm_vermoegen$q95_x_means)`$ CHF und grössere Vermögen. Nun wird bestimmt, ob der tatsächliche beobachtete Wert im Ablehnungsbereich liegt oder nicht. [Im Beispiel liegt der Stichprobenmittelwert $`r round(exm_vermoegen$x_mean)`$ CHF nicht im Ablehnungsbereich. In diesem Fall wird die Nullhypothese nicht verworfen und das Testresultat erhält das Prädikat **nicht signifikant**. Läge der Stichprobenmittelwert im Ablehnungsbereich, so wäre das Testresultat als **signifikant** einzustufen.]{.customdef #customdef-signifikanz}

::::{.caution data-latex=""}
::: {.remark}
Ein signifikanter Unterschied bedeutet im allgemeinen Sprachgebrauch ein _bedeutsamer, substanzieller_ Unterschied. Im statistischen Kontext bedeutet ein _signifikanter Unterschied_, wie oben beschrieben, dass ein Unterschied bis auf eine gewisse Irrtumswahrscheinlichkeit (angegeben durch das Signifikanzniveau) _nicht zufällig_ zustande gekommen ist. Ein _nicht signifikanter Unterschied_ bedeutet dagegen, dass die Beobachtung _zufällig_ zustande gekommen sein könnte. Für letzteres gibt es zwei Erklärungen: (1) $H_0$ ist tatsächlich wahr. (2) $H_0$ ist zwar falsch, aber die Stichprobenziehung hat zufällig zu einem ähnlichen Resultat geführt, wie wenn $H_0$ wahr wäre. Ist ein Testresultat nicht signifikant, so kann also nicht genau gesagt werden, ob $H_0$ wahr ist oder nicht. Ist das Testresultat signifikant, so ist $H_0$ eher unwahrscheinlich.

In manchen Texten werden allgemeine und auch statistische Fragen bearbeitet. Hier empfiehlt sich für den allgemeinen Sprachgebrauch _substanziell_ und für die statischen Aussagen _statistisch signifikant_ zu verwenden.

Es wird ausserdem empfohlen, das Wort signifikant immer nur als Prädikat für eine Qualifizierung der Nullhypothese zu verwenden. Im Beispiel war $H_0: \mu \leq 100'000$CHF. Korrekte Aussage sind: 
- Das durchschnittliche Vermögen ist im letzten Jahr nicht signifikant gewachsen.
- Das durchschnittliche Vermögen ist in diesem Jahr nicht signifikant grösser als $100'000$ CHF.

:::
::::

Die beiden Denkarten entsprechen sich insofern, als ein $p$-Wert kleiner als $5\%$ ein signifikantes Resultat bei Signifikanzniveau $\alpha = 5\%$ bedeutet. In der Praxis werden beide Methoden verwendet. Im Beispiel liegt der $p$-Wert bei $p = `r round(exm_vermoegen$p_value_emp,3) %>% str_sub(2)`$. Dies bedeutet, dass die Wahrscheinlichkeit zufällig den realisierten Stichprobenmittelwert zu kommen, gegeben, dass die Nullhypothese stimmt, grösser als $5\%$ ist und demnach auch der Unterschied nicht signifikant ist.

Ein noch zu lösendes Problem ist, dass normalerweise Geld, Zeit und Nerven fehlen, um eine Stichprobenziehung $`r exm_vermoegen$n_samples`$ mal zu wiederholen. Hier hilft es wieder zu beobachten, dass die Verteilung der Werte des Histogramms in Abbildung \@ref(fig:exm-vermoegen-histogram-plot) wieder mit zunehmender Stichprobengrösse immer genauer einer Normalverteilung folgen. Tatsächlich trifft es aufgrund des [zentralen Grenzwertsatzes](#customdef-zentraler-grenzwertsatz) immer zu, dass wenn ein Merkmal mit $N$ Beobachtungen, Erwartungswert $\mu$ und Standardabweichung $\sigma$ hat, der Wert

$$z = \frac{\bar{x}-\mu}{\frac{\sigma}{\sqrt{n}}}$$
normalverteilt ist, wobei $\mu$ hier dem Wert der Nullhypothese entspricht, also $100'000$ CHF. Dies entspricht der roten Linie in Abbildung \@ref(fig:exm-vermoegen-histogram-plot). Ist die Standardabweichung des Merkmals unbekannt, so wird diese mit $s$ geschätzt. Diese zusätzliche Unsicherheit führt dazu, dass
\begin{equation}
t = \frac{\bar{x}-\mu}{\frac{s}{\sqrt{n}}}
(\#eq:t-emp-onesample)
\end{equation}
<!-- TODO: Discuss: I don't give the numerical values for t because they do not correspond to the distribution in the figure below because of the scaling and would therefore confuse the reader. -->
nicht mehr normal-, sondern $t$-verteilt ist bei $n-1$ Freiheitsgraden (grüne Linie, Abbildung \@ref(fig:exm-vermoegen-histogram-plot)). Die $t$-Verteilung mit allen Freiheitsgraden ist in `Jamovi` hinterlegt und es kann der Software überlassen werden den $p$-Wert und den Ablehnungsbereich genau zu bestimmen. In Abbildung \@ref(fig:exm-vermoegen-plots-sampling-theorie) wurde nochmal illustriert, dass es bei vielen Beobachtungen der theoretische $p$-Wert (Kurve) mit dem empirischen $p$-Wert der Simulationen (Histogramm) übereinstimmt respektive der Ablehnungsbereich der $t$-Verteilung (Kurve) gleich ist, wie der simulierte Ablehnungsbereich (Histogramm).

<!-- TODO: Discuss  -->
<!-- - why p-Wert does not correspond exactly to empirical p-Wert? -->
<!-- - what is that uncertainty w.r.t. the rejection area? -->

```{r exm-vermoegen-plots-sampling-theorie, fig.cap="Oben: Histogramm der simulierten Verteilung; unten: theoretische t-Verteilung; links: Illustration p-Wert; rechts: Illustration Ablehnungsbereich. Die Linie entspricht dem beobachteten Stichprobenmittelwert."}
exm_vermoegen$plot_hist_curve_pval_reja
```

[Die Berechnung des für den Test relevanten Wertes, hier des $t$-Wertes wird **Teststatistik** (oder auch _Prüfgrösse_ oder nur _Statistik_) genannt.]{.customdef #customdef-teststatistik} Eine Teststatistik hat normalerweise eine bekannte theoretische Verteilung, welcher die Teststatistik folgt, wenn die Nullhypothese wahr ist. [Aufgrund der theoretischen $t$-Verteilung der Statistik wird dieser Test **$t$-Test** genannt.]{.customdef #customdef-t-test}

Das oben gefundene Resultat wird in der folgenden Form berichtet:

> Das durchschnittliche Vermögen ($M = `r round(exm_vermoegen$x_mean)`$ CHF, $SD = `r round(exm_vermoegen$x_sd)`$, $N = `r round(exm_vermoegen$n)`$) ist in diesem Jahr nicht signifikant grösser als $100'000$ CHF, $t(`r round(exm_vermoegen$n-1)`) = `r round(exm_vermoegen$t_emp,3)`$, $p = `r round(exm_vermoegen$p_value_the,3) %>% str_sub(start = 2L)`$.

::::{.caution data-latex=""}
::: {.remark}
Folgende Begriffe und Zahlen werden dabei verwendet:

- Das _durchschnittliche_ Vermögen (fehlt durchschnittlich ist die Aussage falsch).
- $M$, $SD$, $N$ entsprechen dem arithmetischen Mittel, der geschätzten Standardabweichung und der Anzahl Beobachtungen in der Stichprobe. Die Einheit muss nicht wiederholt werden.
- Signifikanz (siehe letzter Hinweis)
- grösser als $100'000$ CHF ist die Referenz zur Alternativhypothese
- $t(`r round(exm_vermoegen$n-1)`)$ bedeutet, dass die Teststatistik $t$-verteilt ist mit $`r round(exm_vermoegen$n-1)`$ Freiheitsgraden.
- $`r round(exm_vermoegen$t_emp,3)`$ ist der Wert der Teststatistik berechnet mit Formel \@ref(eq:t-emp-onesample) aus der Stichprobe. Dieser Wert ist skaliert und muss im Kontext der standardisierten $t$-Verteilung wie in Abbildung \@ref(fig:t-distribution) interpretiert werden.
- $p = `r round(exm_vermoegen$p_value_the,3) %>% str_sub(start = 2L)`$ entspricht dem $p$-Wert. Es wird normalerweise die führende $0$ weggelassen (also nicht $`r round(exm_vermoegen$p_value_the,3)`)$, da es sich um eine Zahl handelt, welche nie kleiner als $0$ oder grösser als $1$ sein kann.
:::
::::


:::{.example #alexithymie name="Alexithymie"}

```{r exm-alexithymie}
gen_exm_alexithymie <- function(){
  set.seed(1982)
  mu0 <- 100
  x_min <- 37
  x_max <- 185
  n <- 391
  
  x <- rnorm(n, 96, 25) 
  x <- crop(x, x_min, x_max)
  x[which(x < x_min)] <- x_min
  x[which(x > x_max)] <- x_max
  # x %>% summary()
  # x %>% t.test(alternative = 'two.sided',
  #              mu = 100)
  x_mean <- x %>% mean()
  x_mean_sym <- mu0 + (mu0 - x_mean)
  x_sd <- x %>% sd()
  t_emp <- (x_mean - mu0)/(x_sd/sqrt(n))
  p_value_the <- 2*pt((x_mean - mu0)/ (x_sd / sqrt(n)), n-1)
  effect_size <- (x_mean - mu0) / x_sd
  
  file_name <- '05-exm-alexithymie.sav'
  tibble(alexithymie = x) %>% write_sav(file_name)
  
  # distribution if H_0 were true
  n_samples <- 4000L
  x_means <- 1:n_samples %>% 
    map_dbl(~ mean(rnorm(n, mu0, 25)))
  q975_x_means <- x_means %>% quantile(c(0.975)) %>% unlist() %>% unname()
  q025_x_means <- x_means %>% quantile(c(0.025)) %>% unlist() %>% unname()
  p_value_emp <- mean(x_means < x_mean | x_means > mu0 + (mu0 - x_mean))
  
  # plot histogram of sample means
  plot_hist_density <- plot_hist_denstiy_expected_value(
    x_means, 
    mu0, 
    x_sd, 
    n,
    "Alexithymie CHF",
    0.25)
  
  line_xlim <- xlim(c(95, 105))
  sigma_g <- x_sd / sqrt(n)
  x_range <- seq(mu0-3*sigma_g, mu0+3*sigma_g, length.out = 1000)
  
  # Function to create text data
  create_text_data <- function(labels, y_value, plot_type) {
    tibble(
      label = labels,
      x = c(98, 102),
      y = rep(y_value, 2),
      color = c("red", "green"),
      plot_type = plot_type
    )
  }
  
  
  add_colors <- function(x, type){
    if(type == "Histogram"){
      x %>% 
      mutate(
      color = case_when(
        plot_type == type %>% str_c(" p-Wert") & x > x_mean & x < mu0 + (mu0 - x_mean) ~ "red",
        plot_type == type %>% str_c(" p-Wert") & (x <= x_mean | x >= mu0 + (mu0 - x_mean)) ~ "green",
        (plot_type == type %>% str_c(" Ablehnungsbereich")) & 
          (x > q975_x_means | x < q025_x_means)~ "green",
        (plot_type == type %>% str_c(" Ablehnungsbereich")) & 
          (x <= q975_x_means & x >= q025_x_means) ~ "red"
      )
    )
    }else{
      x %>% 
        mutate(
        color = case_when(
          plot_type == type %>% str_c(" p-Wert") & x > x_mean & x < mu0 + (mu0 - x_mean) ~ "red",
          plot_type == type %>% str_c(" p-Wert") & (x <= x_mean | x >= mu0 + (mu0 - x_mean)) ~ "green",
          (plot_type == type %>% str_c(" Ablehnungsbereich")) & 
            (x > mu0 + qt(0.975, n-1)*x_sd/sqrt(n) | x < mu0 - qt(0.975, n-1)*x_sd/sqrt(n))~ "green",
          (plot_type == type %>% str_c(" Ablehnungsbereich")) & 
            (x <= mu0 + qt(0.975, n-1)*x_sd/sqrt(n) & x >= mu0 - qt(0.975, n-1)*x_sd/sqrt(n)) ~ "red"
        )
      )
    }
    
  }
  # Create data for histograms
  histogram_data <- tibble(
    x = rep(x_means, 2),
    plot_type = rep(c("Histogram p-Wert", 
                      "Histogram Ablehnungsbereich"), 
                    each = length(x_means))
  ) %>%
    add_colors("Histogram")
  
  # Create data for density plots
  density_data <- tibble(
    x = rep(x_range, 2),
    y = dt((x - mu0) / sigma_g, n - 1) / sigma_g,
    plot_type = rep(c("Verteilung p-Wert", 
                      "Verteilung Ablehnungsbereich"), 
                    each = length(x_range))
  ) %>%
    add_colors("Verteilung")
  
  density_data %>% 
    filter(plot_type ==  "Verteilung Ablehnungsbereich")
  
  # Create text data for all plots
  text_pval <- str_c(round(100 * c(1 - p_value_emp, p_value_emp), 1), '%')
  text_sign <- c('95%', '5%')
  text_data_all <- bind_rows(
    create_text_data(
      text_pval,
      200,
      "Histogram p-Wert"
    ),
    create_text_data(
      text_sign, 
      200,
      "Histogram Ablehnungsbereich"
    ),
    create_text_data(
      round(100 *c(1-p_value_the,p_value_the),1) %>% 
        str_c('%'),
      0.25, 
      "Verteilung p-Wert"
    ),
    create_text_data(
      text_sign, 
      0.25,
      "Verteilung Ablehnungsbereich"
    )
  )
  
  custom_labeller <- as_labeller(c(
    "Histogram p-Wert" = "p-Wert",
    "Histogram Ablehnungsbereich" = "Ablehnungsbereich",
    "Verteilung p-Wert" = "p-Wert",
    "Verteilung Ablehnungsbereich" = "Ablehnungsbereich"
  ))
  
  plot_hist_curve_pval_reja <- ggplot() +
    geom_histogram(data = histogram_data,
                   aes(x = x, fill = color),
                   binwidth = 0.25) +
    geom_line(data = density_data,
              aes(x = x, y = y)) +
    geom_ribbon(data = density_data,
                aes(x = x, ymin = 0, ymax = ifelse(color == "red", y, 0)), fill = "#00BFC4") +
    geom_ribbon(data = density_data,
                aes(x = x, ymin = 0, ymax = ifelse(color == "green", y, 0)), fill = "#F8766D") +
    geom_vline(xintercept = x_mean) +
    geom_text(data = text_data_all,
              mapping = aes(x = x, y = y, label = label, colour = color)) +
    facet_wrap(~ plot_type, nrow = 2, scales = "free_y", 
               strip.position = "top",
               labeller = custom_labeller) +
    line_xlim +
    theme(
      axis.text.y = element_text(),
      axis.ticks.y = element_line(),
      axis.title.y = element_text(),
      strip.placement = "outside",
      legend.position = "none"
    ) +
    labs(x = "Alexithymie", y = "W.-dichte                              Häufigkeit")

  return(mget(ls()))
}
exm_alexithymie <- gen_exm_alexithymie()
```

Mit Gefühlsblindheit oder _Alexithymie_ (griechisch: a = ohne, lexis= lesen, sprechen, thymie = Gefühle) werden Einschränkungen bei der Fähigkeit Emotionen wahrzunehmen, zu erkennen und zu beschreiben bezeichnet. Es gibt ein online [Messinstrument](https://www.alexithymie.com/de/), welches die Alexithymie auf einer Skala von $`r exm_alexithymie$x_min`$ Punkten (kleine Gefühlsblindheit) bis $`r exm_alexithymie$x_max`$ (grosse Gefühlsblindheit) misst. Die Skala wurde so gewählt, dass die durchschnittliche Alexithymie aller Menschen bei $`r exm_alexithymie$mu0`$ liegt. Eine Psychologin interessiert sich nun dafür, ob junge Menschen unter $25$ durchschnittlich andere Alexithymie-Werte aufweisen als die Gesamtbevölkerung. Um dies zu testen, befragt sie $N = `r exm_alexithymie$n`$ unter $25$-jährige mit besagtem Messinstrument. In dieser Gruppe wurde eine durchschnittliche Alexithymie von $M = `r round(exm_alexithymie$x_mean,1)`$ Punkten festgestellt.
:::

<!-- Discuss: Was könnten gründe sein für eine tiefere, höhrere Alexithymie? -->
<!-- Es kann festgestellt werden, dass das wahrnehmen, erkennen und beschreiben von Emotionen in den letzten Jahrzehnten vermehrt in den Fokus der Früherziehung gerückt ist. -->
<!-- Discuss: Wieso ist hier ein Test nötig? -->

Der erste Schritt ist auch hier die Null- und Alternativhypothesen aufzustellen. Die Psychologin stellt die Frage, ob sich die durchschnittliche Alexithymie in der Grundgesamtheit, in der Folge mit $\mu$ bezeichnet, von $100$ unterscheidet oder nicht. Es ist zu beobachten, dass sie keine Annahme über die Richtung der Abweichung trifft (eine höhere oder eine tiefere Alexithymie wären denkbar) und es sich deshalb um eine zweiseitige Hypothesenstellung handelt. 

Die Nullhypothese beschreibt den bisherigen Informationsstand, also dass die durchschnittliche Alexithymie der Population bei $100$ Punkten liegt, oder kurz

> $H_0:\mu = 100$ Punkte. 

Die Alternativhypothese besagt das Gegenteil davon, also hier, dass die durchschnittliche Alexithymie nicht mehr bei $100$ Punkten liegt, oder kurz

> $H_1: \mu \neq 100$ Punkte. 

Um die Wahrscheinlichkeit des beobachteten arithmetischen Mittels der Stichprobe von $M = `r round(exm_alexithymie$x_mean,1)`$ Punkten zu ermitteln, gegeben, dass die Nullhypothese wahr ist, kann erneut auf eine Simulation zurückgegriffen werden. Bei diesem Gedankenexperiment wird angenommen, dass Nullhypothese wahr ist und dass das die Untersuchung $`r exm_alexithymie$n_samples`$-mal wiederholt wurde mit jeweils $`r exm_alexithymie$n`$ Beobachtungen. Von jeder dieser Stichproben kann wiederum das arithmetische Mittel berechnet werden. Die Verteilung dieser arithmetischen Mittel ist in Abbildung \@ref(fig:exm-alexithymie-plot) oben dargestellt.

```{r exm-alexithymie-plot, fig.cap="TODO:"}
exm_alexithymie$plot_hist_curve_pval_reja
```

Der $p$-Wert, also die Wahrscheinlichkeit, dass der beobachtete Wert oder ein noch extremerer Wert in Richtung der Alternativhypothese resultiert, wird hier aufgrund der zweiseitigen Hypothesenstellung auch zweiseitig ausgelegt. Extremer in Richtung der Alternativhypothese meint hier alle Werte, die weiter weg als der beobachtete Durchschnittswert $`r round(exm_alexithymie$x_mean,1)`$ vom hypothetischen Erwartungswert $\mu = `r exm_alexithymie$mu0`$ sind. Konkret sind dies alle Werte, welche kleiner als $`r round(exm_alexithymie$x_mean,1)`$, und alle Werte, welche grösser als $`r round(exm_alexithymie$x_mean_sym,1)`$ sind (roter Bereich in Abbildung \@ref(fig:exm-alexithymie-plot) oben rechts). Der Anteil der Werte, welche diese Bedinung erfüllen liegt bei $p = `r round(100*exm_alexithymie$p_value_emp,1)`\%$. Es ist demnach recht unwahrscheinlich, dass die Nullhypothese stimmt und zufällig ein Stichprobendurchschnittswert von $`r round(exm_alexithymie$x_mean,1)`$ Alexithymie-Punkten herauskommt.

Aufgrund der zweiseitigen Hypothesenstellung beinhaltet auch der Ablehnungsbereich sowohl die tiefsten $2.5\%$ und höchsten $2.5\%$, also insgesamt die $5\%$ extremen Durchschnittswerte. Dies sind alle Werte tiefer als  $`r round(exm_alexithymie$q025_x_means,2)`$ und alle Werte höher als $`r round(exm_alexithymie$q975_x_means,2)`$ (roter Bereich in Abbildung \@ref(fig:exm-alexithymie-plot) oben links). Da das arithmetische Mittel der Stichprobe $`r round(exm_alexithymie$x_mean,1)`$ im Ablehnungsbereich liegt, liegt hier ein signifikantes Resultat vor bei Signifikanzniveau $5\%$.

Auch in diesem Fall kann die Verteilung der Stichprobenmittelwerte mit dem zentralen Grenzwertsatz angenähert werden. Es ergeben sich annähernd dieselben Resultate für den $p$-Wert (roter Bereich in Abbildung \@ref(fig:exm-alexithymie-plot) unten rechts) und für den Ablehnungsbereich (roter Bereich in Abbildung \@ref(fig:exm-alexithymie-plot) unten links).

Die Psychologin kann nun wie folgt berichten:

> Die durchschnittliche Alexithymie ($M = `r round(exm_alexithymie$x_mean,1)`$ Punkte, $SD = `r round(exm_alexithymie$x_sd,1)`$, $N = `r round(exm_alexithymie$n)`$) unterscheidet sich bei den unter 25-jährigen signifikant vom Populationsdurchschnitt von $100$ Punkte, $t(`r round(exm_alexithymie$n-1)`) = `r round(exm_alexithymie$t_emp,3)`$, $p = `r round(exm_alexithymie$p_value_the,3) %>% str_sub(start = 2L)`$.


## Weicht der gefundene Durchschnitt stark vom hypothetischen Wert ab?

<!-- Discuss: Probleme (grosses n -> immer signifikant, je nach Einheit ist Erwartungswertunterschied ganz anders). -->

In einem so berichteten Testresultat sind essenziell zwei Informationen enthalten: (1) was sind die getesteten Hypothesen und (2) wie wahrscheinlich es ist, dass das gefundene Resultat eine Folge der Zufallsstichprobenziehung ist. Was hier noch fehlt ist eine Angabe darüber wie gross die praktische Relevanz dieses Testresultates ist.

Um eine solche Relevanz zu messen wurde der Begriff der Effektstärke eingeführt. Eine Effektstärke ist eine Zahl ohne Einheit (Meter, Franken, ...), welche unabhängig von der Stichprobengrösse ist und nahe bei Null liegt, wenn die Nullhypothese nicht abgelehnt wurde.

Wird im Vermögensbeispiel \@ref(exm:vermoegen) die Differenz zwischen geschätzem Erwartungswert und hypothetischem Erwartungswert 
$$\bar{x} - \mu = `r round(exm_vermoegen$x_mean)` \text{CHF} - `r exm_vermoegen$mu0` \text{CHF}  = `r round(exm_vermoegen$x_mean)-exm_vermoegen$mu0`$$
betrachtet, so fällt auf, dass dieser Wert bereits zwei der oben genannten Eigenschaften aufweist. Tatsächlich ist dieser Wert unabhängig von der Stichprobengrösse und er liegt nahe bei $0$, wenn das Testresultat nicht signifikant war. Letzteres kann beobachtet werde indem in der Formel \@ref(eq:t-emp-onesample) verschiedene Differenzen eingesetzt werden und mit der Abbildung  \@ref(fig:t-distribution) verglichen werden. 

<!-- Discuss: how? -->

Wenn jetzt ein anderer Sozialpsychologe die Auswertung wiederholen würde, aber statt in CHF in Rappen Rp rechnet, dann erhält er den Wert
$$\bar{x} - \mu = `r 100*round(exm_vermoegen$x_mean)` \text{Rp} - `r exm_vermoegen$mu0*100` \text{Rp}  = `r (round(exm_vermoegen$x_mean)-exm_vermoegen$mu0)*100`.$$
Dass mit den gleichen Zahlen je nach Einheit eine andere Effektstärke gefunden wird ist unpraktisch für den Vergleich der Testresultate. Die Lösung in diesem Fall ist diese Differenz durch die geschätzte Standardabweichung zu rechnen. Dies ergibt

- in CHF: $d = \frac{\bar{x} - \mu}{s} = \frac{`r round(exm_vermoegen$x_mean)` \text{CHF} - `r exm_vermoegen$mu0` \text{CHF}}{`r round(exm_vermoegen$x_sd)`\text{CHF}}  = `r round((round(exm_vermoegen$x_mean)-exm_vermoegen$mu0)/round(exm_vermoegen$x_sd),2)`$
- in Rp: $d = \frac{\bar{x} - \mu}{s} = \frac{`r 100*round(exm_vermoegen$x_mean)` \text{Rp} - `r exm_vermoegen$mu0*100` \text{Rp}}{`r 100*round(exm_vermoegen$x_sd)`\text{Rp}}  = `r round((round(exm_vermoegen$x_mean)-exm_vermoegen$mu0)/round(exm_vermoegen$x_sd),2)` .$

Mit dieser Formel werden für beide Einheiten derselbe Wert berechnet. Effektiv dient jetzt als Einheit die Standardabweichung: Eine grosse Differenz bei einer grossen Standardabweichung des Merkmals führt zur selben Effektstärke wie eine kleine Differenz bei kleiner Standardabweichung eines Merkmals. Da Menschen sich nicht gewohnt sind Zahlen als Standardabweichungen zu interpretieren hat [@cohen1988] ein folgende Richtwerte entwickelt:

- $|d| \approx 0.3$: schwacher Effekt
- $|d| \approx 0.5$: mittlerer Effekt
- $|d| \approx 0.8$: starker Effekt

<!-- Discuss: 0.5 bedeutet die Differenz ist eine halbe standardabweichung gross. -->

Cohen selbst hat davor gewarnt diese Werte als absolut darzustellen. Vielmehr sollte die Interpretation der Effektstärke vom Forschungsgebiet und dem Messinstrument abhängen. Um im Unterricht eine beurteilbare Praxis zu etablieren sollen folgende Regeln gelten:

- $0 < |d| \leq 0.4$: schwacher Effekt
- $0.4 < |d| \leq 0.65$: mittlerer Effekt
- $0.65 < |d|$: starker Effekt

<!-- Discuss absoluter Wert -->

Das Berichten der Testresultate wird mit der Effektstärke ergänzt:

> Das durchschnittliche Vermögen ($M = `r round(exm_vermoegen$x_mean)`$ CHF, $SD = `r round(exm_vermoegen$x_sd)`$, $N = `r round(exm_vermoegen$n)`$) ist in diesem Jahr nicht signifikant grösser als $100'000$ CHF, $t(`r round(exm_vermoegen$n-1)`) = `r round(exm_vermoegen$t_emp,3)`$, $p = `r round(exm_vermoegen$p_value_the,3) %>% str_sub(start = 2L)`, d = `r round(exm_vermoegen$effect_size,2)`$.

> Die durchschnittliche Alexithymie ($M = `r round(exm_alexithymie$x_mean,1)`$ Punkte, $SD = `r round(exm_alexithymie$x_sd,1)`$, $N = `r round(exm_alexithymie$n)`$) unterscheidet sich bei den unter 25-jährigen signifikant vom Populationsdurchschnitt von $100$ Punkte, $t(`r round(exm_alexithymie$n-1)`) = `r round(exm_alexithymie$t_emp,3)`$, $p = `r round(exm_alexithymie$p_value_the,3) %>% str_sub(start = 2L)`, d = `r round(exm_alexithymie$effect_size,2)`$.

In beiden Fällen liegt ein schwacher Effekt vor. Der Effekt bei der Alexithymie ist schwächer als der Effekt bei der Vermögensstudie. Der $p$-Wert sagt aber aus, dass der Effekt beim Vermögen durch die Zufallsstichprobe zustande gekommen ist, während es bei der Alexithymie unwahrscheinlich ist, dass der Effekt durch die Zufallsstichprobe zustande gekommen ist.

## Übungen

::: {.exercise  #vermoegen}
<!-- 
Ziel: 
- Zahlen aus den Vermögen-Beispiel mit Jamovi verknüpfen.
-->
Reproduziere das Beispiel Vermögen \@ref(exm:vermoegen) mit `Jamovi` indem folgende Teilschritte durchgeführt werden:

- Datensatz `r inline_code(exm_vermoegen$file_name)` in `Jamovi` einladen.
- Wähle `Analysen > t-Tests > t-Test mit einer Stichprobe`.
- Definiere die Hypothese wie im Beispiel und wähle die Testoptionen so, dass du alle Zahlen des Testberichts wiederfindest.

:::

:::{.solution}
```{r sol-vermoegen-input, out.width='100%', fig.cap='Jamovi Eingabe.', fig.show='hold'}
knitr::include_graphics("figures/05-exr-vermoegen-jmv-input.jpg")
```

```{r sol-vermoegen-output, out.width='100%', fig.cap='Deskriptive Statistiken.', fig.show='hold'}
knitr::include_graphics("figures/05-exr-vermoegen-jmv-output.jpg")
```  
:::

::: {.exercise  #alexithymie}
<!-- 
Ziel: 
- Zahlen aus den Alexithymie-Beispiel mit Jamovi verknüpfen.
-->
Reproduziere das Beispiel Alexithymie \@ref(exm:alexithymie) mit `Jamovi` indem folgende Teilschritte durchgeführt werden:

- Datensatz `r inline_code(exm_alexithymie$file_name)` in `Jamovi` einladen.
- Wähle `Analysen > t-Tests > t-Test mit einer Stichprobe`.
- Definiere die Hypothese wie im Beispiel und wähle die Testoptionen so, dass du alle Zahlen des Testberichts wiederfindest.
:::

:::{.solution}
```{r sol-alexithymie-input, out.width='100%', fig.cap='Jamovi Eingabe.', fig.show='hold'}
knitr::include_graphics("figures/05-exr-alexithymie-jmv-input.jpg")
```

```{r sol-alexithymie-output, out.width='100%', fig.cap='Deskriptive Statistiken.', fig.show='hold'}
knitr::include_graphics("figures/05-exr-alexithymie-jmv-output.jpg")
```  
:::


::: {.exercise  #circadian}
<!-- 
Ziel: 
- Erster eigener Test selbstständig durchführen
- Zweiseitiger Test
- Signifikanz begreifen
-->

```{r exr-circadian}
gen_exr_circadian <- function(){
  set.seed(1982)
  mu0 <- 24
  n <- 57
  
  x <- rnorm(n, 24.5, 2) 
  # x %>% summary()
  # x %>% t.test(alternative = 'two.sided',
  #              mu = mu0)
  x_mean <- x %>% mean()
  x_mean_sym <- mu0 + (mu0 - x_mean)
  x_sd <- x %>% sd()
  t_emp <- (x_mean - mu0)/(x_sd/sqrt(n))
  p_value_the <- 1-2*pt((x_mean - mu0)/ (x_sd / sqrt(n)), n-1)
  effect_size <- (x_mean - mu0) / x_sd
  
  file_name <- '05-exr-circadian.sav'
  tibble(tageslaenge = x) %>% write_sav(file_name)
  
  return(mget(ls()))
}
exr_circadian <- gen_exr_circadian()
```

Es soll überprüft werden, ob der 24-stündige Tagesrhythmus, auch _zirkadianer Rhythmus_ genannt, des Menschen auch ohne Tageslicht aufrechterhalten wird. Eine solche Untersuchung wird von @czeisler1999 berichtet. Wir gehen von folgendem fiktiven Versuch aus:  Freiwillige werden für vier Tage in einer Kellerwohnung ohne jedes Tageslicht einquartiert. Jede Versuchsperson ist während der vier Tage allein, darf die Wohnung nicht verlassen und erhält keinerlei Hinweise auf die aktuelle Tageszeit. Die Person muss unmittelbar vor dem Zu-Bett-Gehen, einen Knopf betätigen, wodurch die Uhrzeit festgehalten wird. Als Variable wird die Dauer der `tageslaenge` (in Stunden) zwischen dem Zu-Bett-Gehen am dritten Versuchstag und dem Zu-Bett-Gehen am vierten Versuchstag verwendet. Die erhobenen Daten sind in `r inline_code(exr_circadian$file_name)` abgelegt.

a) Ohne einen Test durchzuführen, haben die Proband:innen einen anderen zirkadianen Rhythmus als Menschen die nicht am Experiment teilnehmen? Weshalb es hier sinnvoll ist einen statistischen Test zu verwenden?
b) Stellen Sie mit einem Einstichproben-t-Test fest, ob der zirkadiane Rhythmus durch das Tageslicht beeinflusst wird. Stellen Sie insbesondere die Hypothesen auf und berichten Sie das Testresultat adäquat.
c) Erklären Sie alle Zahlen und Symbole im Testbericht.
:::

:::{.solution}
Für diese Übung werden die Daten in `Jamovi` wie in Abbildung \@ref(fig:sol-circadian-input) analysiert. Das Resultat der Analyse ist in Abbildung \@ref(fig:sol-circadian-output) festgehalten.

```{r sol-circadian-input, out.width='100%', fig.cap='Jamovi Eingabe.'}
knitr::include_graphics("figures/05-exr-circadian-jmv-input.jpg")
```

```{r sol-circadian-output, out.width='100%', fig.cap='Jamovi Ausgabe.'}
knitr::include_graphics("figures/05-exr-circadian-jmv-output.jpg")
``` 

a) Die Versuchpersonen haben einen durchschnittlichen zirkadianen Rhythmus von $M = `r round(exr_circadian$x_mean,1)`$ Stunden. Dies ist länger als die regulären $24$ Stunden. Es ist unklar, ob hier gerade zufällig Personen beobachtet wurden bei welche sich der zirkadiane Rhytmus verlängert. Um die Wahrscheinlichkeit dieses Zufalls zu quantifizieren wird ein statistischer Test durchgeführt.
b) Die Nullhypothese geht vom aktuell bekannten aus, also in diesem Fall, dass sich der durchschnittliche zirkadiane Rhythmus unter den Versuchsbedinungen nicht verändert. Der normale zirkadiane Rhythmus ist Sonnenbedingt $24$ Stunden lang, also wird die Nullhypothese $H_0: \mu = 24$ Stunden aufgestellt. $\mu$ ist hier die durchschnittiche Dauer des zirkadianen Rhythmus in der Population. Im Versuch geht es darum festzustellen, ob der normale zirkadiane Rhythmus gehalten wird oder nicht. Ein nicht gehaltener zirkadianer Rhythmus würde bedeuten, dass sich die Tagesdauer verkürzt oder verlängert gegenüber der Nullhypothese. Es ist hier also eine zweiseitige Hypothesenstellung und die Alternativhypothese lautet $H_1: \mu \neq 24$ Stunden.

> Die durchschnittliche Tageslänge ($M = `r round(exr_circadian$x_mean,1)`$ Stunden, $SD = `r round(exr_circadian$x_sd,1)`$, $N = `r round(exr_circadian$n)`$) unter Experimentalbedingungen unterscheidet sich signifikant von $24$ Stunden, $t(`r round(exr_circadian$n-1)`) = `r round(exr_circadian$t_emp,2)`$, $p = `r round(exr_circadian$p_value_the,3) %>% str_sub(start = 2L)`, d = `r round(exr_circadian$effect_size,3)`$.

c) $M, SD,$ und $N$ sind das arithmetische Mittel, die geschätzte Standardabweichung und die Anzahl Beobachtungen der Stichprobe. $p$ ist die Wahrscheinlichkeit, zufällig den Stichprobenmittelwert oder einen noch extremeren Wert im Sinne der Alternativehypothese zu beobachten, falls die Nullhypothese stimmt. Dieser Wert ist kleiner als $5\%$. Deswegen wird von einem signifikanten Unterschied der durchschnittlichen Tageslänge zum Erwartungswert gesprochen. $24$ Stunden ist der Vergleichswert der Nullhypothese. $t(`r round(exr_circadian$n-1)`)$ bedeutet, dass die Teststatistik $t$-verteilt ist mit `r exr_circadian$n-1` Freiheitsgraden, sofern die Nullhypothese wahr ist. Mit der aktuellen Stichprobenziehung wurde ein Wert von $`r round(exr_circadian$t_emp,2)`$ realisiert. Dieser Wert ist mit der $t$-Verteilung in Abbildung \@ref(fig:t-distribution) zu vergleichen. Der Wert entspricht einer eher unwahrscheinlichen Beobachtung dieser Verteilung. $d = `r round(exr_circadian$effect_size,3)`$, schliesslich, bezieht sich auf die Effektstärke. Das Testresultat entspricht einem mittleren Effekt.
 
:::

::: {.exercise  #schwimmen}
<!-- 
Ziel: 
- Gerichtete Hypothese kleiner als ein Wert
-->

```{r exr-schwimmen}
gen_exr_schwimmen <- function(){
  set.seed(1982)
  mu0 <- 1.58
  n <- 13
  
  x <- rnorm(n, 1.50, 0.8) 
  x %>% summary()
  x %>% t.test(alternative = 'less',
               mu = mu0)
  x_mean <- x %>% mean()
  x_mean_sym <- mu0 + (mu0 - x_mean)
  x_sd <- x %>% sd()
  t_emp <- (x_mean - mu0)/(x_sd/sqrt(n))
  p_value_the <- pt(t_emp, n-1)
  effect_size <- (x_mean - mu0) / x_sd
  
  file_name <- '05-exr-schwimmen.sav'
  dd <- tibble(kraul_zeit = x) 
  dd %>% write_sav(file_name)
  jmv_res <- (dd %>% 
    jmv::ttestOneS(vars = 'kraul_zeit', 
                   testValue = 1.58, 
                   hypothesis = 'lt', desc = TRUE,
                   effectSize = TRUE))
  jmv_res_test <- jmv_res$ttest$asDF %>% 
    rename_with(~ .x %>% str_remove('\\[stud\\]'))
  jmv_res_desc <- jmv_res$descriptives$asDF
  
  return(mget(ls()))
}
exr_schwimmen <- gen_exr_schwimmen()
```

Im Schwimmclub Neustadt erreichen neue Schwimmer nach einem Jahr Training eine Kraul-Schwimmzeit von durchschnittlich $`r exr_schwimmen$mu0`$ Minuten für $100$ Meter. Eine Sportstudentin will eine neue Trainingsmethode ausprobieren und herausfinden, ob die Methode bessere Ergebnisse erzielt. Dazu trainiert neue Schwimmer ein Jahr lang mit dieser Methode und misst anschliessend deren Kraul-Schwimmzeit über $100$ Meter. Die Daten sind in `r inline_code(exr_schwimmen$file_name)` abgelegt.

a) Wie viele Schwimmer hat die Sportstudentin trainiert?
b) Ist die neue Trainingsmethode besser als die bisherige? Erklären Sie die Signifikanz und Relevanz des Experimentresultats.
:::

:::{.solution}
Für diese Übung werden die Daten in `Jamovi` wie in Abbildung \@ref(fig:sol-schwimmen-input) analysiert. Das Resultat der Analyse ist in Abbildung \@ref(fig:sol-schwimmen-output) festgehalten.

```{r sol-schwimmen-input, out.width='100%', fig.cap='Jamovi Eingabe.'}
knitr::include_graphics("figures/05-exr-schwimmen-jmv-input.jpg")
```

```{r sol-schwimmen-output, out.width='100%', fig.cap='Jamovi Ausgabe.'}
knitr::include_graphics("figures/05-exr-schwimmen-jmv-output.jpg")
```

a) Die Sportstudentin hat $N = `r exr_schwimmen$jmv_res_desc$num`$ Schwimmer trainiert.
b) Die Forschungsfrage ist hier, ob die neue Trainingsmethode besser ist. Besser meint hier, dass die mit dieser Trainingsmethode trianierten Schwimmer nach dem Training durchschnittlich schneller schwimmen als die anderen. Die Alternativhypothese ist also $H_1: \mu < `r exr_schwimmen$mu0`$. Die Nullhypothese sagt genau das Gegenteil davon aus, nämlich, dass die durchschnittliche Schimmzeit mit der neuen Methode gleich bleibt oder sogar noch länger wird $H_0: \mu \geq `r exr_schwimmen$mu0`$. Das Testresultat lässt sich wie folgt berichten:

> Die durchschnittliche Schwimmzeit ($M = `r round(exr_schwimmen$jmv_res_desc$mean,2)`$ Minuten, $SD = `r round(exr_schwimmen$jmv_res_desc$sd,2)`$, $N = `r exr_schwimmen$jmv_res_desc$num`$) mit der neuen Trainingsmethode ist nicht signifikant tiefer als $`r exr_schwimmen$mu0`$ Minuten, $t(`r exr_schwimmen$jmv_res_test$df`) = `r round(exr_schwimmen$jmv_res_test$stat,2)`$, $p = `r round(exr_schwimmen$jmv_res_test$p,3) %>% str_sub(start = 2L)`, d = `r round(exr_schwimmen$jmv_res_test$es,3)`$.

Das Testresultat ist nicht signifikant, da der $p$-Wert grösser als $5\%$ ist. Tatsächlich bedeutet $p = `r round(exr_schwimmen$jmv_res_test$p,3) %>% str_sub(start = 2L)`$, dass, wenn die Nullhypothese wahr ist, das gefundene Testresultat oder dass die Schwimmer noch schneller sind in $`r round(100*exr_schwimmen$jmv_res_test$p,1)`\%$ zufällig durch die Zufallsstichprobenziehung zustande kommt. Kurz gesagt, das Resulat könnt auch Zufall sein.

Die gefundene Effektstärke ist mittel. Wenn das Resultat nicht zufällig wäre, dann würde die Trainingsmethode immerhin einen mittleren Effekt erzielen. Wenn es tatsächlich einen mittleren Effekt gibt, dann könnte die Sportstudentin das Experiment nochmal mit mehr Probanden wiederholen, um den Effekt auch als statistisch signifikan nachweisen zu können. Falls der gefundene Effekt nur zufällig zustande gekommen ist und er nicht exisitiert, wird auch eine Experimentwiederholung mit mehr Probandinnen immernoch kein signifikantes Testergebnis liefern. 
:::

<!--chapter:end:src/05-1-durchschnitt_testen.Rmd-->

# (PART) Gruppenvergleich einer intervallskalierten Variable {-}

# Gruppenvergleich einer intervallskalierten Variable

## Zwei Gruppen vergleichen 

:::{.example #breakup name="Trennungsschmerz"}

```{r exm-breakup}
gen_exm_breakup <- function(){
  # x ~ chisq(df)
  # a * x ~ a chisq(df)
  # E(a*x) ~ a E(chisq(df)) = a df
  # Var(a*x) ~ a^2 Var(x) = a^2 2k / n
  mu1 <- 6.84
  s1 <- 2.52
  n1 <- 2695
  mu2 <- 6.58
  s2 <- 2.58
  n2 <- 1409

  set.seed(61)
  x_min <- 1
  x_max <- 10
  x1 <- rnorm(n1, mu1, s1) %>% 
    crop(x_min, x_max)
  x2 <- rnorm(n2, mu2, s2) %>% 
    crop(x_min, x_max)
  
  
  # x <- scale_factor * rchisq(n, df)
  # scores_hover <- x / 1000 # hovering with K CHF in scale
  # x_mean <- x %>% mean()
  # x_sd <- x %>% sd()
  # t_emp <- (x_mean - mu0)/(x_sd/sqrt(n))
  # p_value_the <- 1-pt((x_mean - 100000)/ (x_sd / sqrt(n)), n-1)
  # effect_size <- (x_mean - mu0) / x_sd

  file_name <- '06-exm-breakup.sav'
  dd <- tibble(emotional_response = c(x1,x2),
         sex = c(rep( 'male',n1), rep('female', n2))) %>% 
    write_sav(file_name)
  
  jmv_res <- dd %>%
    jmv::ttestIS(vars = c("emotional_response"), 
                 group = "sex",
                 welchs = TRUE, 
                 mann = TRUE, 
                 effectSize = TRUE)
  
  scores_hover1 <- rnorm(20, 3, s1) %>% 
      crop(x_min, x_max)
  scores_hover2 <- rnorm(20, 7, s1) %>% 
      crop(x_min, x_max)
  plot_ball_bag_different <- plot_ball_bag_two_samples(
    scores_bag1 = rnorm(200, 3, s1) %>% 
      crop(x_min, x_max),
    scores_bag2 = rnorm(200, 7, s2) %>% 
      crop(x_min, x_max),
    scores_hover1 = scores_hover1,
    scores_hover2 = scores_hover2,
    score_name = "Anxiety",
    no_legend = TRUE
  )
  
  plot_ball_bag_same <- plot_ball_bag_two_samples(
    scores_bag1 = rnorm(200, 5, s1) %>% 
      crop(x_min, x_max),
    scores_bag2 = rnorm(200, 5, s2) %>% 
      crop(x_min, x_max),
    scores_hover1 = scores_hover1,
    scores_hover2 = scores_hover2,
    score_name = "Anxiety",
    no_separation_line = TRUE
  )

  # # distribution if H_0 were true
  # n_samples <- 3000L
  # x_means <- 1:n_samples %>% 
  #   map_dbl(~ mean(scale_factor*rchisq(n, df)))
  # q95_x_means <- x_means %>% quantile(c(0.95)) %>% unlist() %>% unname()
  # p_value_emp <- mean(x_means > x_mean)
  # 
  # plot sampling bag
  # n_bag <- 200L
  # scores_bag <- list(40*rchisq(n_bag,df),
  #                  60*rchisq(n_bag,df))
  # plots <- list()
  # for (i in 1:length(scores_bag)) {
  #   plots[[i]] <- plot_ball_bag(
  #     scores_bag = scores_bag[[i]],
  #     scores_hover = scores_hover,
  #     score_name = "1000 CHF",
  #     seed = 123+i,
  #     no_legend = c(TRUE, FALSE)[i],
  #     limit_scores = c(0, 800)
  #   )
  # }
  
  # plot histogram of sample means
  # plot_hist_density <- plot_hist_denstiy_expected_value(
  #   x_means, 
  #   scale_factor*df, 
  #   sqrt((scale_factor)^2*2*df), 
  #   n,
  #   "Vermögen CHF",
  #   5000)
  # 
  # line_xlim <- xlim(c(40000, 180000))
  # sigma_g <- x_sd / sqrt(n)
  # x_range <- seq(mu0-3*sigma_g, mu0+3*sigma_g, length.out = 1000)
  # 
  # # Function to create text data
  # create_text_data <- function(labels, y_value, plot_type) {
  #   tibble(
  #     label = labels,
  #     x = c(60000, 160000),
  #     y = rep(y_value, 2),
  #     color = c("red", "green"),
  #     plot_type = plot_type
  #   )
  # }
  # 
  # 
  # add_colors <- function(x, type){
  #   x %>% 
  #     mutate(
  #     color = case_when(
  #       plot_type == type %>% str_c(" p-Wert") & x > x_mean ~ "green",
  #       plot_type == type %>% str_c(" p-Wert") & x <= x_mean ~ "red",
  #       plot_type == type %>% str_c(" Ablehnungsbereich") & x > q95_x_means ~ "green",
  #       plot_type == type %>% str_c(" Ablehnungsbereich") & x <= q95_x_means ~ "red"
  #     )
  #   )
  # }
  # # Create data for histograms
  # histogram_data <- tibble(
  #   x = rep(x_means, 2),
  #   plot_type = rep(c("Histogram p-Wert", 
  #                     "Histogram Ablehnungsbereich"), 
  #                   each = length(x_means))
  # ) %>%
  #   add_colors("Histogram")
  # 
  # # Create data for density plots
  # density_data <- tibble(
  #   x = rep(x_range, 2),
  #   y = dt((x - mu0) / sigma_g, n - 1) / sigma_g,
  #   plot_type = rep(c("Verteilung p-Wert", 
  #                     "Verteilung Ablehnungsbereich"), 
  #                   each = length(x_range))
  # ) %>%
  #   add_colors("Verteilung")
  # 
  # # Create text data for all plots
  # text_pval <- str_c(round(100 * c(1 - p_value_emp, p_value_emp), 1), '%')
  # text_sign <- c('95%', '5%')
  # text_data_all <- bind_rows(
  #   create_text_data(
  #     text_pval,
  #     200,
  #     "Histogram p-Wert"
  #   ),
  #   create_text_data(
  #     text_sign, 
  #     200,
  #     "Histogram Ablehnungsbereich"
  #   ),
  #   create_text_data(
  #     round(100 *c(1-p_value_the,p_value_the),1) %>% 
  #       str_c('%'),
  #     0.000015, 
  #     "Verteilung p-Wert"
  #   ),
  #   create_text_data(
  #     text_sign, 
  #     0.000015,
  #     "Verteilung Ablehnungsbereich"
  #   )
  # )
  # 
  # custom_labeller <- as_labeller(c(
  #   "Histogram p-Wert" = "p-Wert",
  #   "Histogram Ablehnungsbereich" = "Ablehnungsbereich",
  #   "Verteilung p-Wert" = "p-Wert",
  #   "Verteilung Ablehnungsbereich" = "Ablehnungsbereich"
  # ))
  
  # plot_hist_curve_pval_reja <- ggplot() +
  #   geom_histogram(data = histogram_data,
  #                  aes(x = x, fill = color),
  #                  binwidth = 4300) +
  #   geom_line(data = density_data,
  #             aes(x = x, y = y, colour = color)) +
  #   geom_area(data = density_data,
  #             aes(x = x, y = y, fill = color)) +
  #   geom_vline(xintercept = x_mean) +
  #   geom_text(data = text_data_all,
  #             mapping = aes(x = x, y = y, label = label, colour = color)) +
  #   facet_wrap(~ plot_type, nrow = 2, scales = "free_y", 
  #              strip.position = "top",
  #              labeller = custom_labeller) +
  #   line_xlim +
  #   theme(
  #     axis.text.y = element_text(),
  #     axis.ticks.y = element_line(),
  #     axis.title.y = element_text(),
  #     strip.placement = "outside",
  #     legend.position = "none"
  #   ) +
  #   labs(x = "Vermögen", y = "W.-dichte                              Häufigkeit")

  return(mget(ls()))
}
exm_breakup <- gen_exm_breakup()
grid.arrange(exm_breakup$plot_ball_bag_different,
             exm_breakup$plot_ball_bag_same, 
             ncol = 2)
```

Trennung [@morris2015]
<!-- Eine Sozialpolitikberatungsfirma will herausfinden, ob das durchschnittliche Vermögen der in der Schweiz lebenden Personen im letzten Jahr gestiegen ist. Sie stellen dazu basierend auf dem aktuellen Wissensstand die Nullhypothese auf, dass das durchschnittliche Vermögen nicht gestiegen ist, und die Alternativhypothese, dass das durchschnittliche Vermögen gestiegen ist: -->

> $H_0: \mu_\text{Frau} = \mu_\text{Mann}$

> $H_1: \mu_\text{Frau} \neq \mu_\text{Mann}$

<!-- Um die Hypothesen auf einer Datengrundlage zu evaluieren, erfragt es das Vermögen von $n=`r exm_vermoegen$n`$ zufällig ausgewählten Personen und findet ein durchschnittliches Vermögen von $M=`r round(mean(exm_vermoegen$x))`$ CHF. -->

:::

## Was ist das Problem der Stichprobenziehung?

## Wie kann man Aussagen über die Grundgesamtheit machen?

## Übungen

<!--chapter:end:src/06-2-gruppenvergleich_intervallskalierte_variablen.Rmd-->

# Welch-Test

## Zwei Gruppen vergleichen 

## Sind die Durchschnitte der beiden Gruppen in der Grundgesamtheit gleich?

## Wie stark unterscheiden sich die Durchschnitte?

## Übungen

<!--chapter:end:src/07-2-welch_test.Rmd-->

# Begriffsverzeichnis {-}

- [Alternativhypothese](#customdef-alternativhypothese)
- [Erwartungswert](#customdef-erwartungswert)
- [Freiheitsgrade](#customdef-freiheitsgrade)
- [Grundgesamtheit](#customdef-grundgesamtheit)
- [Hypothese](#customdef-hypothese)
- [Interquartilabstand](#customdef-iqr)
- [Intervalles](#customdef-interval)
- [Konfidenzintervall](#customdef-confidence-interval)
- [Median](#customdef-median)
- [Modus](#customdef-modus)
- [Normalverteilung](#customdef-normalverteilung)
- [Nullhypothese](#customdef-nullhypothese)
- [Perzentil](#customdef-perzentil)
- [Population](#customdef-population)
- [Spannweite](#customdef-spannweite)
- [Standardabweichung](#customdef-std)
- [Stichprobe](#customdef-stichprobe)
- [Stichprobenziehung](#customdef-stichprobenziehung)
- [Student-$t$-Verteilung](#customdef-student-verteilung)
- [Zentraler Grenzwertsatz](#customdef-zentraler-grenzwertsatz)
- [Zufallsstichprobe](#customdef-zufallsstichprobe)
- [arithmetische Mittel](#customdef-arithmetisches-mittel)
- [intervallskaliert](#customdef-intervallskaliert)
- [zweiseitige Hypothese](#customdef-zweiseitige-hypothese)

<!--chapter:end:src/98-glossary.Rmd-->

